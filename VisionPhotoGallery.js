!function(t,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==typeof exports?exports.VisionPhotoGallery=o():t.VisionPhotoGallery=o()}(this,(function(){return function(){"use strict";var t={352:function(t,o,e){function n(t,o){for(var e=0;e<o.length;e++){var n=o[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,o,e){return o in t?Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[o]=e,t}e.d(o,{default:function(){return i}});var i=function(){function t(o){var e=o.root,n=o.personId,r=o.token;if(function(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this,t),!e)throw new Error("Не указан ID корневого элемента для галереи!");var i=document.getElementById(e);if(!i)throw new Error("Проверьте указанный ID корневого элемента для галереи!");if(this.constructor.rootElement=i,!n)throw new Error("Не указан ID пользователя на портале Vision");this.personId=n,this.token=r,this.constructor.draw()}var o,e,r;return o=t,r=[{key:"request",value:function(t){var o=t.requestPath,e=t.requestBody,n={method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":this.token},body:JSON.stringify(e)};return fetch("/api/v2/vision/".concat(o,"/"),n)}},{key:"getPhotos",value:function(){return this.request({requestPath:"get_photos",requestBody:{person_id:this.personId,masterAlbum:!0}})}},{key:"addPhoto",value:function(t){return this.request({requestPath:"add_photo",requestBody:{person_id:this.personId,image:t}})}},{key:"deletePhoto",value:function(t){return this.request({requestPath:"delete_photo",requestBody:{person_id:this.personId,photo_ids:[t],masterAlbum:!0}})}},{key:"updatePhoto",value:function(t){return this.request({requestPath:"delete_photo",requestBody:{person_id:this.personId,photo_id:t,masterAlbum:!0}})}},{key:"draw",value:function(){var t=this,o=this.rootElement;o.innerHTML='\n            <div class="vision-photo-gallery">\n                <input type="file" class="vision-photo-gallery__file-field" tabindex="-1">\n                <div class="vision-photo-gallery__item vision-photo-gallery__item--main">\n                    <h4 class="vision-photo-gallery__title">Основная фотография</h4>\n                    <div class="vg-main-photo"></div>\n                </div>\n                <div class="vision-photo-gallery__item">\n                    <h4 class="vision-photo-gallery__title">Галерея</h4>\n                    <div class="vg-gallery"></div>\n                </div>\n            </div>\n        ';var e=o.querySelector(".vg-main-photo"),n=o.querySelector(".vg-gallery");this.getPhotos().then((function(o){if(e.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null}),n.innerHTML=t.createPhotoElement({main:!1,empty:!0,photoId:null}),o.ok)return o.json();e.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null})})).then((function(o){var r=o.find((function(t){return!0===t.main})),i=o.filter((function(t){return!0!==t.main}));if(r?e.innerHTML=t.createPhotoElement(r):e.parentElement.classList.add("hidden"),i.length){var a="";i.forEach((function(o){return a+=t.createPhotoElement(o)})),n.innerHTML=a}t.initEvents()})).catch((function(t){console.log(t)}))}},{key:"createPhotoElement",value:function(t){var o=t.photoId,e=t.main,n=t.empty,r=t.path,i=t.avatarUrl,a="",u="",s="",c="";return r&&(s='style="background-image: url('.concat(r,')"')),i&&(s='style="background-image: url('.concat(i,')"')),e&&(c='data-main="'.concat(e,'"')),e&&!n||e&&n?(u="vg-photo vg-photo--main",a='\n                <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n            '):!e&&n?(u="vg-gallery__item vg-photo vg-photo--upload",a='\n                <button class="vg-photo__button vg-button vg-button--upload" data-action="upload-photo">&#43;</button>\n            '):(u="vg-gallery__item vg-photo",a='\n                <button class="vg-photo__button vg-button vg-button--green" data-action="choose-photo">Выбрать</button>\n                <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n            '),'\n            <div class="'.concat(u,'"\n                ').concat(s,'\n                data-photo-id="').concat(o,'"\n                ').concat(c,">\n                ").concat(a,"\n            </div>\n        ")}},{key:"initEvents",value:function(){var t=this;this.rootElement.querySelectorAll("button").forEach((function(o){o.addEventListener("click",t.router[o.dataset.action],!1)}))}}],(e=[{key:"personId",get:function(){return this.constructor.personId},set:function(t){t&&(this.constructor.personId=t)}},{key:"rootElement",get:function(){return this.constructor.rootElement}},{key:"token",get:function(){return this.constructor.token},set:function(t){t&&(this.constructor.token=t)}}])&&n(o.prototype,e),r&&n(o,r),t}();r(i,"personId",null),r(i,"rootElement",null),r(i,"token",null),r(i,"router",{"upload-photo":function(t){var o=i.rootElement.querySelector('input[type="file"]');o.addEventListener("change",i.router["file-input-changed"]),o.click()},"file-input-changed":function(t){var o=t.target.files[0],e=new FileReader;e.readAsDataURL(o),e.onload=function(){i.addPhoto(e.result).then((function(t){t.ok&&i.draw()})).catch((function(t){console.log(t)}))},e.onerror=function(){throw new Error("Ошибка загрузки фотографии (-ий): ".concat(e.error))}},"remove-photo":function(t){var o=t.target.closest(".vg-photo").dataset.photoId;o&&i.deletePhoto(o).then((function(t){t.ok&&i.draw()}))},"update-photo":function(t){var o=t.target.closest(".vg-photo").dataset.photoId;o&&i.updatePhoto(o).then((function(t){t.ok&&i.draw()})).catch((function(t){console.log(t)}))}})}},o={};function e(n){if(o[n])return o[n].exports;var r=o[n]={exports:{}};return t[n](r,r.exports,e),r.exports}return e.d=function(t,o){for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},e.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},e(352)}().default}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vVmlzaW9uUGhvdG9HYWxsZXJ5L3dlYnBhY2svc3RhcnR1cCIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInRoaXMiLCJWaXNpb25QaG90b0dhbGxlcnkiLCJwZXJzb25JZCIsInRva2VuIiwiRXJyb3IiLCJyb290RWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjb25zdHJ1Y3RvciIsImRyYXciLCJyZXF1ZXN0UGF0aCIsInJlcXVlc3RCb2R5IiwicmVxdWVzdERlZmF1bHRzIiwibWV0aG9kIiwibW9kZSIsImNyZWRlbnRpYWxzIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZmV0Y2giLCJyZXF1ZXN0IiwicGVyc29uX2lkIiwibWFzdGVyQWxidW0iLCJpbWFnZSIsInBob3RvSWQiLCJwaG90b19pZHMiLCJwaG90b19pZCIsImlubmVySFRNTCIsIm1haW5QaG90b0NvbnRhaW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJnYWxsZXJ5IiwiZ2V0UGhvdG9zIiwidGhlbiIsInJlc3BvbnNlIiwiY3JlYXRlUGhvdG9FbGVtZW50IiwibWFpbiIsImVtcHR5Iiwib2siLCJqc29uIiwicmVzcG9uc2VKc29uIiwibWFpblBob3RvRGF0YSIsImZpbmQiLCJnYWxsZXJ5UGhvdG9zRGF0YSIsImZpbHRlciIsInBhcmVudEVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJsZW5ndGgiLCJnYWxsZXJ5UGhvdG9zSHRtbCIsImZvckVhY2giLCJwaG90b0RhdGEiLCJpbml0RXZlbnRzIiwiY2F0Y2giLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJwYXJhbXMiLCJwYXRoIiwiYXZhdGFyVXJsIiwiYnV0dG9ucyIsImVsZW1lbnRDbGFzc2VzIiwiYmFja2dyb3VuZEltYWdlIiwibWFpbkF0dHJpYnV0ZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwicm91dGVyIiwiZGF0YXNldCIsImFjdGlvbiIsImUiLCJmaWxlSW5wdXQiLCJjbGljayIsImZpbGUiLCJ0YXJnZXQiLCJmaWxlcyIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJyZWFkQXNEYXRhVVJMIiwib25sb2FkIiwiYWRkUGhvdG8iLCJyZXN1bHQiLCJvbmVycm9yIiwiY2xvc2VzdCIsImRlbGV0ZVBob3RvIiwidXBkYXRlUGhvdG8iLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiZCIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBMkNBLEVBQU1DLEdBQzFCLGlCQUFaQyxTQUEwQyxpQkFBWEMsT0FDeENBLE9BQU9ELFFBQVVELElBQ1EsbUJBQVhHLFFBQXlCQSxPQUFPQyxJQUM5Q0QsT0FBTyxHQUFJSCxHQUNlLGlCQUFaQyxRQUNkQSxRQUE0QixtQkFBSUQsSUFFaENELEVBQXlCLG1CQUFJQyxJQVIvQixDQVNHSyxNQUFN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Iiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW10sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiVmlzaW9uUGhvdG9HYWxsZXJ5XCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIlZpc2lvblBob3RvR2FsbGVyeVwiXSA9IGZhY3RvcnkoKTtcbn0pKHRoaXMsIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0ICcuL2FwcC5zY3NzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmlzaW9uUGhvdG9HYWxsZXJ5IHtcbiAgICBzdGF0aWMgcGVyc29uSWQgPSBudWxsO1xuICAgIHN0YXRpYyByb290RWxlbWVudCA9IG51bGw7XG4gICAgc3RhdGljIHRva2VuID0gbnVsbDtcblxuICAgIGNvbnN0cnVjdG9yKHtyb290LCBwZXJzb25JZCwgdG9rZW59KSB7XG4gICAgICAgIGlmICghcm9vdCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfQndC1INGD0LrQsNC30LDQvSBJRCDQutC+0YDQvdC10LLQvtCz0L4g0Y3Qu9C10LzQtdC90YLQsCDQtNC70Y8g0LPQsNC70LXRgNC10LghJyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByb290RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJvb3QpO1xuXG4gICAgICAgIGlmICghIXJvb3RFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLmNvbnN0cnVjdG9yLnJvb3RFbGVtZW50ID0gcm9vdEVsZW1lbnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ9Cf0YDQvtCy0LXRgNGM0YLQtSDRg9C60LDQt9Cw0L3QvdGL0LkgSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAg0LTQu9GPINCz0LDQu9C10YDQtdC4IScpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFwZXJzb25JZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfQndC1INGD0LrQsNC30LDQvSBJRCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8g0L3QsCDQv9C+0YDRgtCw0LvQtSBWaXNpb24nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucGVyc29uSWQgPSBwZXJzb25JZDtcbiAgICAgICAgdGhpcy50b2tlbiA9IHRva2VuO1xuXG4gICAgICAgIHRoaXMuY29uc3RydWN0b3IuZHJhdygpO1xuICAgIH1cblxuICAgIGdldCBwZXJzb25JZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IucGVyc29uSWQ7XG4gICAgfVxuXG4gICAgc2V0IHBlcnNvbklkKHBlcnNvbklkKSB7XG4gICAgICAgIGlmIChwZXJzb25JZCkge1xuICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5wZXJzb25JZCA9IHBlcnNvbklkO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHJvb3RFbGVtZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci5yb290RWxlbWVudDtcbiAgICB9XG5cbiAgICBnZXQgdG9rZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRva2VuO1xuICAgIH1cblxuICAgIHNldCB0b2tlbih0b2tlbikge1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IudG9rZW4gPSB0b2tlbjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqINCe0LHRkdGA0YLQutCwINC00LvRjyDQt9Cw0L/RgNC+0YHQvtCyINC6IEFQSS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGF0aCB7c3RyaW5nfSDQndCw0LfQstCw0L3QuNC1INC80LXRgtC+0LTQsCBBUEkuXG4gICAgICogQHBhcmFtIHJlcXVlc3RCb2R5IHtvYmplY3R9INCf0LDRgNCw0LzQtdGC0YDRiyDQt9Cw0L/RgNC+0YHQsC5cbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDQt9Cw0L/RgNC+0YHQsC5cbiAgICAgKi9cbiAgICBzdGF0aWMgcmVxdWVzdCh7cmVxdWVzdFBhdGgsIHJlcXVlc3RCb2R5fSkge1xuICAgICAgICBjb25zdCByZXF1ZXN0RGVmYXVsdHMgPSB7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIG1vZGU6ICdzYW1lLW9yaWdpbicsXG4gICAgICAgICAgICBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJyxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgICAgICdYLUNTUkZUb2tlbic6IHRoaXMudG9rZW4sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpLFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBmZXRjaChgL2FwaS92Mi92aXNpb24vJHtyZXF1ZXN0UGF0aH0vYCwgcmVxdWVzdERlZmF1bHRzKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0UGhvdG9zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgICAgICAgIHJlcXVlc3RQYXRoOiAnZ2V0X3Bob3RvcycsXG4gICAgICAgICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICAgICAgICAgIHBlcnNvbl9pZDogdGhpcy5wZXJzb25JZCxcbiAgICAgICAgICAgICAgICBtYXN0ZXJBbGJ1bTogdHJ1ZSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGFkZFBob3RvKGltYWdlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgICAgICAgcmVxdWVzdFBhdGg6ICdhZGRfcGhvdG8nLFxuICAgICAgICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgICAgICAgICBwZXJzb25faWQ6IHRoaXMucGVyc29uSWQsXG4gICAgICAgICAgICAgICAgaW1hZ2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZGVsZXRlUGhvdG8ocGhvdG9JZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgICAgICAgIHJlcXVlc3RQYXRoOiAnZGVsZXRlX3Bob3RvJyxcbiAgICAgICAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgICAgICAgICAgcGVyc29uX2lkOiB0aGlzLnBlcnNvbklkLFxuICAgICAgICAgICAgICAgIHBob3RvX2lkczogW3Bob3RvSWRdLFxuICAgICAgICAgICAgICAgIG1hc3RlckFsYnVtOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICBzdGF0aWMgdXBkYXRlUGhvdG8ocGhvdG9JZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgICAgICAgIHJlcXVlc3RQYXRoOiAnZGVsZXRlX3Bob3RvJyxcbiAgICAgICAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgICAgICAgICAgcGVyc29uX2lkOiB0aGlzLnBlcnNvbklkLFxuICAgICAgICAgICAgICAgIHBob3RvX2lkOiBwaG90b0lkLFxuICAgICAgICAgICAgICAgIG1hc3RlckFsYnVtOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGRyYXcoKSB7XG4gICAgICAgIGNvbnN0IHJvb3RFbGVtZW50ID0gdGhpcy5yb290RWxlbWVudDtcblxuICAgICAgICByb290RWxlbWVudC5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlcIj5cbiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cImZpbGVcIiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X19maWxlLWZpZWxkXCIgdGFiaW5kZXg9XCItMVwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9faXRlbSB2aXNpb24tcGhvdG8tZ2FsbGVyeV9faXRlbS0tbWFpblwiPlxuICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9fdGl0bGVcIj7QntGB0L3QvtCy0L3QsNGPINGE0L7RgtC+0LPRgNCw0YTQuNGPPC9oND5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInZnLW1haW4tcGhvdG9cIj48L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX2l0ZW1cIj5cbiAgICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX3RpdGxlXCI+0JPQsNC70LXRgNC10Y88L2g0PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidmctZ2FsbGVyeVwiPjwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG5cbiAgICAgICAgY29uc3QgbWFpblBob3RvQ29udGFpbmVyID0gcm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcignLnZnLW1haW4tcGhvdG8nKTtcbiAgICAgICAgY29uc3QgZ2FsbGVyeSA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy52Zy1nYWxsZXJ5Jyk7XG5cblxuICAgICAgICB0aGlzLmdldFBob3RvcygpLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHtcbiAgICAgICAgICAgICAgICBtYWluOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVtcHR5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHBob3RvSWQ6IG51bGxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBnYWxsZXJ5LmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHtcbiAgICAgICAgICAgICAgICBtYWluOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbXB0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwaG90b0lkOiBudWxsLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudCh7bWFpbjogdHJ1ZSwgZW1wdHk6IHRydWUsIHBob3RvSWQ6IG51bGx9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkudGhlbihyZXNwb25zZUpzb24gPT4ge1xuICAgICAgICAgICAgY29uc3QgbWFpblBob3RvRGF0YSA9IHJlc3BvbnNlSnNvbi5maW5kKCh7bWFpbn0pID0+IG1haW4gPT09IHRydWUpO1xuICAgICAgICAgICAgY29uc3QgZ2FsbGVyeVBob3Rvc0RhdGEgPSByZXNwb25zZUpzb24uZmlsdGVyKCh7bWFpbn0pID0+IG1haW4gIT09IHRydWUpO1xuXG4gICAgICAgICAgICBpZiAobWFpblBob3RvRGF0YSkge1xuICAgICAgICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudChtYWluUGhvdG9EYXRhKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChnYWxsZXJ5UGhvdG9zRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBsZXQgZ2FsbGVyeVBob3Rvc0h0bWwgPSAnJztcblxuICAgICAgICAgICAgICAgIGdhbGxlcnlQaG90b3NEYXRhLmZvckVhY2goKHBob3RvRGF0YSkgPT4gZ2FsbGVyeVBob3Rvc0h0bWwgKz0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQocGhvdG9EYXRhKSk7XG4gICAgICAgICAgICAgICAgZ2FsbGVyeS5pbm5lckhUTUwgPSBnYWxsZXJ5UGhvdG9zSHRtbFxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgY3JlYXRlUGhvdG9FbGVtZW50KHBhcmFtcykge1xuICAgICAgICBjb25zdCB7cGhvdG9JZCwgbWFpbiwgZW1wdHksIHBhdGgsIGF2YXRhclVybH0gPSBwYXJhbXM7XG4gICAgICAgIGxldCBidXR0b25zID0gJyc7XG4gICAgICAgIGxldCBlbGVtZW50Q2xhc3NlcyA9ICcnO1xuICAgICAgICBsZXQgYmFja2dyb3VuZEltYWdlID0gJyc7XG4gICAgICAgIGxldCBtYWluQXR0cmlidXRlID0gJyc7XG5cbiAgICAgICAgaWYgKHBhdGgpIHtcbiAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZSA9IGBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgke3BhdGh9KVwiYDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhdmF0YXJVcmwpIHtcbiAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZSA9IGBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgke2F2YXRhclVybH0pXCJgO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1haW4pIHtcbiAgICAgICAgICAgIG1haW5BdHRyaWJ1dGUgPSBgZGF0YS1tYWluPVwiJHttYWlufVwiYDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtYWluICYmICFlbXB0eSkge1xuICAgICAgICAgICAgZWxlbWVudENsYXNzZXMgPSAndmctcGhvdG8gdmctcGhvdG8tLW1haW4nO1xuICAgICAgICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS1yZWRcIiBkYXRhLWFjdGlvbj1cInJlbW92ZS1waG90b1wiPtCj0LTQsNC70LjRgtGMPC9idXR0b24+XG4gICAgICAgICAgICBgO1xuICAgICAgICB9IGVsc2UgaWYgKG1haW4gJiYgZW1wdHkpIHtcbiAgICAgICAgICAgIGVsZW1lbnRDbGFzc2VzID0gJ3ZnLXBob3RvIHZnLXBob3RvLS1tYWluJztcbiAgICAgICAgICAgIGJ1dHRvbnMgPSBgXG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uIHZnLWJ1dHRvbi0tcmVkXCIgZGF0YS1hY3Rpb249XCJyZW1vdmUtcGhvdG9cIj7Qo9C00LDQu9C40YLRjDwvYnV0dG9uPlxuICAgICAgICAgICAgYDtcbiAgICAgICAgfSBlbHNlIGlmICghbWFpbiAmJiBlbXB0eSkge1xuICAgICAgICAgICAgZWxlbWVudENsYXNzZXMgPSAndmctZ2FsbGVyeV9faXRlbSB2Zy1waG90byB2Zy1waG90by0tdXBsb2FkJztcbiAgICAgICAgICAgIGJ1dHRvbnMgPSBgXG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uIHZnLWJ1dHRvbi0tdXBsb2FkXCIgZGF0YS1hY3Rpb249XCJ1cGxvYWQtcGhvdG9cIj4mIzQzOzwvYnV0dG9uPlxuICAgICAgICAgICAgYDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVsZW1lbnRDbGFzc2VzID0gJ3ZnLWdhbGxlcnlfX2l0ZW0gdmctcGhvdG8nO1xuICAgICAgICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS1ncmVlblwiIGRhdGEtYWN0aW9uPVwiY2hvb3NlLXBob3RvXCI+0JLRi9Cx0YDQsNGC0Yw8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS1yZWRcIiBkYXRhLWFjdGlvbj1cInJlbW92ZS1waG90b1wiPtCj0LTQsNC70LjRgtGMPC9idXR0b24+XG4gICAgICAgICAgICBgO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCIke2VsZW1lbnRDbGFzc2VzfVwiXG4gICAgICAgICAgICAgICAgJHtiYWNrZ3JvdW5kSW1hZ2V9XG4gICAgICAgICAgICAgICAgZGF0YS1waG90by1pZD1cIiR7cGhvdG9JZH1cIlxuICAgICAgICAgICAgICAgICR7bWFpbkF0dHJpYnV0ZX0+XG4gICAgICAgICAgICAgICAgJHtidXR0b25zfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG4gICAgfVxuXG4gICAgc3RhdGljIGluaXRFdmVudHMoKSB7XG4gICAgICAgIGNvbnN0IHtyb290RWxlbWVudH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBidXR0b25zID0gcm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJyk7XG5cbiAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnJvdXRlcltidXR0b24uZGF0YXNldC5hY3Rpb25dLCBmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyByb3V0ZXIgPSB7XG4gICAgICAgICd1cGxvYWQtcGhvdG8nOiAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmlsZUlucHV0ID0gdGhpcy5yb290RWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFt0eXBlPVwiZmlsZVwiXScpO1xuXG4gICAgICAgICAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5yb3V0ZXJbJ2ZpbGUtaW5wdXQtY2hhbmdlZCddKTtcbiAgICAgICAgICAgIGZpbGVJbnB1dC5jbGljaygpO1xuICAgICAgICB9LFxuICAgICAgICAnZmlsZS1pbnB1dC1jaGFuZ2VkJzogKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBlLnRhcmdldC5maWxlc1swXTtcbiAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuXG4gICAgICAgICAgICByZWFkZXIub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkUGhvdG8ocmVhZGVyLnJlc3VsdClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZWFkZXIub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYNCe0YjQuNCx0LrQsCDQt9Cw0LPRgNGD0LfQutC4INGE0L7RgtC+0LPRgNCw0YTQuNC4ICgt0LjQuSk6ICR7cmVhZGVyLmVycm9yfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAncmVtb3ZlLXBob3RvJzogKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHBob3RvRWxlbWVudCA9IGUudGFyZ2V0LmNsb3Nlc3QoJy52Zy1waG90bycpO1xuICAgICAgICAgICAgY29uc3Qge3Bob3RvSWR9ID0gcGhvdG9FbGVtZW50LmRhdGFzZXQ7XG5cbiAgICAgICAgICAgIGlmICghIXBob3RvSWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZVBob3RvKHBob3RvSWQpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgJ3VwZGF0ZS1waG90byc6IChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwaG90b0VsZW1lbnQgPSBlLnRhcmdldC5jbG9zZXN0KCcudmctcGhvdG8nKTtcbiAgICAgICAgICAgIGNvbnN0IHtwaG90b0lkfSA9IHBob3RvRWxlbWVudC5kYXRhc2V0O1xuXG4gICAgICAgICAgICBpZiAoISFwaG90b0lkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQaG90byhwaG90b0lkKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgfVxufSIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdGlmKF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0pIHtcblx0XHRyZXR1cm4gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gbW9kdWxlIGV4cG9ydHMgbXVzdCBiZSByZXR1cm5lZCBmcm9tIHJ1bnRpbWUgc28gZW50cnkgaW5saW5pbmcgaXMgZGlzYWJsZWRcbi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xucmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMzUyKTtcbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIGRlZmluaXRpb24pIHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqLCBwcm9wKSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsgfSJdLCJzb3VyY2VSb290IjoiIn0=