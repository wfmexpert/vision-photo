var VisionPhotoGallery;VisionPhotoGallery=function(){"use strict";var t={352:function(t,e,o){var n,r;function i(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}(t=o.hmd(t)).exports=(r=n=function(){function t(e){var o=e.root,n=e.personId,r=e.token;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!o)throw new Error("Не указан ID корневого элемента для галереи!");var i=document.getElementById(o);if(!i)throw new Error("Проверьте указанный ID корневого элемента для галереи!");if(this.constructor.rootElement=i,!n)throw new Error("Не указан ID пользователя на портале Vision");this.personId=n,this.token=r,this.constructor.draw()}var e,o,n;return e=t,n=[{key:"request",value:function(t){var e=t.requestPath,o=t.requestBody,n={method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":this.token},body:JSON.stringify(o)};return fetch("/api/v2/vision/".concat(e,"/"),n)}},{key:"getPhotos",value:function(){return this.request({requestPath:"get_photos",requestBody:{person_id:this.personId,masterAlbum:!0}})}},{key:"addPhoto",value:function(t){return this.request({requestPath:"add_photo",requestBody:{person_id:this.personId,image:t}})}},{key:"deletePhoto",value:function(t){return this.request({requestPath:"delete_photo",requestBody:{person_id:this.personId,photo_ids:[t],masterAlbum:!0}})}},{key:"updatePhoto",value:function(t){return this.request({requestPath:"delete_photo",requestBody:{person_id:this.personId,photo_id:t,masterAlbum:!0}})}},{key:"draw",value:function(){var t=this,e=this.rootElement;e.innerHTML='\n            <div class="vision-photo-gallery">\n                <input type="file" class="vision-photo-gallery__file-field" tabindex="-1">\n                <div class="vision-photo-gallery__item vision-photo-gallery__item--main">\n                    <h4 class="vision-photo-gallery__title">Основная фотография</h4>\n                    <div class="vg-main-photo"></div>\n                </div>\n                <div class="vision-photo-gallery__item">\n                    <h4 class="vision-photo-gallery__title">Галерея</h4>\n                    <div class="vg-gallery"></div>\n                </div>\n            </div>\n        ';var o=e.querySelector(".vg-main-photo"),n=e.querySelector(".vg-gallery");this.getPhotos().then((function(e){if(o.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null}),n.innerHTML=t.createPhotoElement({main:!1,empty:!0,photoId:null}),e.ok)return e.json();o.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null})})).then((function(e){var r=e.find((function(t){return!0===t.main})),i=e.filter((function(t){return!0!==t.main}));if(r?o.innerHTML=t.createPhotoElement(r):o.parentElement.classList.add("hidden"),i.length){var a="";i.forEach((function(e){return a+=t.createPhotoElement(e)})),n.innerHTML=a}t.initEvents()})).catch((function(t){console.log(t)}))}},{key:"createPhotoElement",value:function(t){var e=t.photoId,o=t.main,n=t.empty,r=t.path,i=t.avatarUrl,a="",s="",u="",c="";return r&&(u='style="background-image: url('.concat(r,')"')),i&&(u='style="background-image: url('.concat(i,')"')),o&&(c='data-main="'.concat(o,'"')),o&&!n||o&&n?(s="vg-photo vg-photo--main",a='\n                <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n            '):!o&&n?(s="vg-gallery__item vg-photo vg-photo--upload",a='\n                <button class="vg-photo__button vg-button vg-button--upload" data-action="upload-photo">&#43;</button>\n            '):(s="vg-gallery__item vg-photo",a='\n                <button class="vg-photo__button vg-button vg-button--green" data-action="choose-photo">Выбрать</button>\n                <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n            '),'\n            <div class="'.concat(s,'"\n                ').concat(u,'\n                data-photo-id="').concat(e,'"\n                ').concat(c,">\n                ").concat(a,"\n            </div>\n        ")}},{key:"initEvents",value:function(){var t=this;this.rootElement.querySelectorAll("button").forEach((function(e){e.addEventListener("click",t.router[e.dataset.action],!1)}))}}],(o=[{key:"personId",get:function(){return this.constructor.personId},set:function(t){t&&(this.constructor.personId=t)}},{key:"rootElement",get:function(){return this.constructor.rootElement}},{key:"token",get:function(){return this.constructor.token},set:function(t){t&&(this.constructor.token=t)}}])&&i(e.prototype,o),n&&i(e,n),t}(),a(n,"personId",null),a(n,"rootElement",null),a(n,"token",null),a(n,"router",{"upload-photo":function(t){var e=n.rootElement.querySelector('input[type="file"]');e.addEventListener("change",n.router["file-input-changed"]),e.click()},"file-input-changed":function(t){var e=t.target.files[0],o=new FileReader;o.readAsDataURL(e),o.onload=function(){n.addPhoto(o.result).then((function(t){t.ok&&n.draw()})).catch((function(t){console.log(t)}))},o.onerror=function(){throw new Error("Ошибка загрузки фотографии (-ий): ".concat(o.error))}},"remove-photo":function(t){var e=t.target.closest(".vg-photo").dataset.photoId;e&&n.deletePhoto(e).then((function(t){t.ok&&n.draw()}))},"update-photo":function(t){var e=t.target.closest(".vg-photo").dataset.photoId;e&&n.updatePhoto(e).then((function(t){t.ok&&n.draw()})).catch((function(t){console.log(t)}))}}),r)}},e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={id:n,loaded:!1,exports:{}};return t[n](r,r.exports,o),r.loaded=!0,r.exports}return o.hmd=function(t){return(t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t},o(352)}().default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vVmlzaW9uUGhvdG9HYWxsZXJ5L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL3N0YXJ0dXAiLCJ3ZWJwYWNrOi8vVmlzaW9uUGhvdG9HYWxsZXJ5L3dlYnBhY2svcnVudGltZS9oYXJtb255IG1vZHVsZSBkZWNvcmF0b3IiXSwibmFtZXMiOlsiZXhwb3J0cyIsInJvb3QiLCJwZXJzb25JZCIsInRva2VuIiwiRXJyb3IiLCJyb290RWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ0aGlzIiwiY29uc3RydWN0b3IiLCJkcmF3IiwicmVxdWVzdFBhdGgiLCJyZXF1ZXN0Qm9keSIsInJlcXVlc3REZWZhdWx0cyIsIm1ldGhvZCIsIm1vZGUiLCJjcmVkZW50aWFscyIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImZldGNoIiwicmVxdWVzdCIsInBlcnNvbl9pZCIsIm1hc3RlckFsYnVtIiwiaW1hZ2UiLCJwaG90b0lkIiwicGhvdG9faWRzIiwicGhvdG9faWQiLCJpbm5lckhUTUwiLCJtYWluUGhvdG9Db250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiZ2FsbGVyeSIsImdldFBob3RvcyIsInRoZW4iLCJyZXNwb25zZSIsImNyZWF0ZVBob3RvRWxlbWVudCIsIm1haW4iLCJlbXB0eSIsIm9rIiwianNvbiIsInJlc3BvbnNlSnNvbiIsIm1haW5QaG90b0RhdGEiLCJmaW5kIiwiZ2FsbGVyeVBob3Rvc0RhdGEiLCJmaWx0ZXIiLCJwYXJlbnRFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwibGVuZ3RoIiwiZ2FsbGVyeVBob3Rvc0h0bWwiLCJmb3JFYWNoIiwicGhvdG9EYXRhIiwiaW5pdEV2ZW50cyIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwicGFyYW1zIiwicGF0aCIsImF2YXRhclVybCIsImJ1dHRvbnMiLCJlbGVtZW50Q2xhc3NlcyIsImJhY2tncm91bmRJbWFnZSIsIm1haW5BdHRyaWJ1dGUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiYnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJvdXRlciIsImRhdGFzZXQiLCJhY3Rpb24iLCJlIiwiZmlsZUlucHV0IiwiY2xpY2siLCJmaWxlIiwidGFyZ2V0IiwiZmlsZXMiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwicmVhZEFzRGF0YVVSTCIsIm9ubG9hZCIsImFkZFBob3RvIiwicmVzdWx0Iiwib25lcnJvciIsImNsb3Nlc3QiLCJkZWxldGVQaG90byIsInVwZGF0ZVBob3RvIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwibW9kdWxlIiwiaWQiLCJsb2FkZWQiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiaG1kIiwiT2JqZWN0IiwiY3JlYXRlIiwiY2hpbGRyZW4iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJzZXQiXSwibWFwcGluZ3MiOiJnWkFJT0EsU0FBUCxlQUtJLGNBQXFDLElBQXhCQyxFQUF3QixFQUF4QkEsS0FBTUMsRUFBa0IsRUFBbEJBLFNBQVVDLEVBQVEsRUFBUkEsTUFDekIsRyw0RkFEaUMsVUFDNUJGLEVBQ0QsTUFBTSxJQUFJRyxNQUFNLGdEQUdwQixJQUFNQyxFQUFjQyxTQUFTQyxlQUFlTixHQUU1QyxJQUFNSSxFQUdGLE1BQU0sSUFBSUQsTUFBTSwwREFHcEIsR0FMSUksS0FBS0MsWUFBWUosWUFBY0EsR0FLOUJILEVBQ0QsTUFBTSxJQUFJRSxNQUFNLCtDQUdwQkksS0FBS04sU0FBV0EsRUFDaEJNLEtBQUtMLE1BQVFBLEVBRWJLLEtBQUtDLFlBQVlDLE8sVUF6QnpCLE8sRUFBQSxFLEVBQUEsa0NBMkQrQyxJQUEzQkMsRUFBMkIsRUFBM0JBLFlBQWFDLEVBQWMsRUFBZEEsWUFDbkJDLEVBQWtCLENBQ3BCQyxP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QUssU0FBQUMsR0FDRUEsRUFBU0ksSUFDVCxFQUFLN0IsVUFHWjRDLE9BQU0sU0FBQUMsR0FDSEMsUUFBUUMsSUFBSUYsU0F0U3BDLEtDSElnQyxFQUEyQixHQUcvQixTQUFTQyxFQUFvQkMsR0FFNUIsR0FBR0YsRUFBeUJFLEdBQzNCLE9BQU9GLEVBQXlCRSxHQUFVekYsUUFHM0MsSUFBSTBGLEVBQVNILEVBQXlCRSxHQUFZLENBQ2pERSxHQUFJRixFQUNKRyxRQUFRLEVBQ1I1RixRQUFTLElBVVYsT0FOQTZGLEVBQW9CSixHQUFVQyxFQUFRQSxFQUFPMUYsUUFBU3dGLEdBR3RERSxFQUFPRSxRQUFTLEVBR1RGLEVBQU8xRixRQ3BCZixPQ0hBd0YsRUFBb0JNLElBQU0sU0FBU0osR0FTbEMsT0FSQUEsRUFBU0ssT0FBT0MsT0FBT04sSUFDWE8sV0FBVVAsRUFBT08sU0FBVyxJQUN4Q0YsT0FBT0csZUFBZVIsRUFBUSxVQUFXLENBQ3hDUyxZQUFZLEVBQ1pDLElBQUssV0FDSixNQUFNLElBQUloRyxNQUFNLDBGQUE0RnNGLEVBQU9DLE9BRzlHRCxHRE5ERixFQUFvQixLIiwiZmlsZSI6IlZpc2lvblBob3RvR2FsbGVyeS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0ICcuL2FwcC5zY3NzJztcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBWaXNpb25QaG90b0dhbGxlcnkge1xuICAgIHN0YXRpYyBwZXJzb25JZCA9IG51bGw7XG4gICAgc3RhdGljIHJvb3RFbGVtZW50ID0gbnVsbDtcbiAgICBzdGF0aWMgdG9rZW4gPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3Ioe3Jvb3QsIHBlcnNvbklkLCB0b2tlbn0pIHtcbiAgICAgICAgaWYgKCFyb290KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ9Cd0LUg0YPQutCw0LfQsNC9IElEINC60L7RgNC90LXQstC+0LPQviDRjdC70LXQvNC10L3RgtCwINC00LvRjyDQs9Cw0LvQtdGA0LXQuCEnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHJvb3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocm9vdCk7XG5cbiAgICAgICAgaWYgKCEhcm9vdEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3Iucm9vdEVsZW1lbnQgPSByb290RWxlbWVudDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcign0J/RgNC+0LLQtdGA0YzRgtC1INGD0LrQsNC30LDQvdC90YvQuSBJRCDQutC+0YDQvdC10LLQvtCz0L4g0Y3Qu9C10LzQtdC90YLQsCDQtNC70Y8g0LPQsNC70LXRgNC10LghJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXBlcnNvbklkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ9Cd0LUg0YPQutCw0LfQsNC9IElEINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjyDQvdCwINC/0L7RgNGC0LDQu9C1IFZpc2lvbicpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5wZXJzb25JZCA9IHBlcnNvbklkO1xuICAgICAgICB0aGlzLnRva2VuID0gdG9rZW47XG5cbiAgICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5kcmF3KCk7XG4gICAgfVxuXG4gICAgZ2V0IHBlcnNvbklkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci5wZXJzb25JZDtcbiAgICB9XG5cbiAgICBzZXQgcGVyc29uSWQocGVyc29uSWQpIHtcbiAgICAgICAgaWYgKHBlcnNvbklkKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnN0cnVjdG9yLnBlcnNvbklkID0gcGVyc29uSWQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgcm9vdEVsZW1lbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnJvb3RFbGVtZW50O1xuICAgIH1cblxuICAgIGdldCB0b2tlbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9rZW47XG4gICAgfVxuXG4gICAgc2V0IHRva2VuKHRva2VuKSB7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3Rvci50b2tlbiA9IHRva2VuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog0J7QsdGR0YDRgtC60LAg0LTQu9GPINC30LDQv9GA0L7RgdC+0LIg0LogQVBJLlxuICAgICAqXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXRoIHtzdHJpbmd9INCd0LDQt9Cy0LDQvdC40LUg0LzQtdGC0L7QtNCwIEFQSS5cbiAgICAgKiBAcGFyYW0gcmVxdWVzdEJvZHkge29iamVjdH0g0J/QsNGA0LDQvNC10YLRgNGLINC30LDQv9GA0L7RgdCwLlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINC30LDQv9GA0L7RgdCwLlxuICAgICAqL1xuICAgIHN0YXRpYyByZXF1ZXN0KHtyZXF1ZXN0UGF0aCwgcmVxdWVzdEJvZHl9KSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3REZWZhdWx0cyA9IHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgbW9kZTogJ3NhbWUtb3JpZ2luJyxcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzOiAnc2FtZS1vcmlnaW4nLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgJ1gtQ1NSRlRva2VuJzogdGhpcy50b2tlbixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSksXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGZldGNoKGAvYXBpL3YyL3Zpc2lvbi8ke3JlcXVlc3RQYXRofS9gLCByZXF1ZXN0RGVmYXVsdHMpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRQaG90b3MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgICAgICAgcmVxdWVzdFBhdGg6ICdnZXRfcGhvdG9zJyxcbiAgICAgICAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgICAgICAgICAgcGVyc29uX2lkOiB0aGlzLnBlcnNvbklkLFxuICAgICAgICAgICAgICAgIG1hc3RlckFsYnVtOiB0cnVlLFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgYWRkUGhvdG8oaW1hZ2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCh7XG4gICAgICAgICAgICByZXF1ZXN0UGF0aDogJ2FkZF9waG90bycsXG4gICAgICAgICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICAgICAgICAgIHBlcnNvbl9pZDogdGhpcy5wZXJzb25JZCxcbiAgICAgICAgICAgICAgICBpbWFnZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyBkZWxldGVQaG90byhwaG90b0lkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgICAgICAgcmVxdWVzdFBhdGg6ICdkZWxldGVfcGhvdG8nLFxuICAgICAgICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgICAgICAgICBwZXJzb25faWQ6IHRoaXMucGVyc29uSWQsXG4gICAgICAgICAgICAgICAgcGhvdG9faWRzOiBbcGhvdG9JZF0sXG4gICAgICAgICAgICAgICAgbWFzdGVyQWxidW06IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIHN0YXRpYyB1cGRhdGVQaG90byhwaG90b0lkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgICAgICAgcmVxdWVzdFBhdGg6ICdkZWxldGVfcGhvdG8nLFxuICAgICAgICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgICAgICAgICBwZXJzb25faWQ6IHRoaXMucGVyc29uSWQsXG4gICAgICAgICAgICAgICAgcGhvdG9faWQ6IHBob3RvSWQsXG4gICAgICAgICAgICAgICAgbWFzdGVyQWxidW06IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZHJhdygpIHtcbiAgICAgICAgY29uc3Qgcm9vdEVsZW1lbnQgPSB0aGlzLnJvb3RFbGVtZW50O1xuXG4gICAgICAgIHJvb3RFbGVtZW50LmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeVwiPlxuICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiZmlsZVwiIGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX2ZpbGUtZmllbGRcIiB0YWJpbmRleD1cIi0xXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X19pdGVtIHZpc2lvbi1waG90by1nYWxsZXJ5X19pdGVtLS1tYWluXCI+XG4gICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X190aXRsZVwiPtCe0YHQvdC+0LLQvdCw0Y8g0YTQvtGC0L7Qs9GA0LDRhNC40Y88L2g0PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidmctbWFpbi1waG90b1wiPjwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9faXRlbVwiPlxuICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9fdGl0bGVcIj7Qk9Cw0LvQtdGA0LXRjzwvaDQ+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2Zy1nYWxsZXJ5XCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcblxuICAgICAgICBjb25zdCBtYWluUGhvdG9Db250YWluZXIgPSByb290RWxlbWVudC5xdWVyeVNlbGVjdG9yKCcudmctbWFpbi1waG90bycpO1xuICAgICAgICBjb25zdCBnYWxsZXJ5ID0gcm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcignLnZnLWdhbGxlcnknKTtcblxuXG4gICAgICAgIHRoaXMuZ2V0UGhvdG9zKCkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBtYWluUGhvdG9Db250YWluZXIuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQoe1xuICAgICAgICAgICAgICAgIG1haW46IHRydWUsXG4gICAgICAgICAgICAgICAgZW1wdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgcGhvdG9JZDogbnVsbFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGdhbGxlcnkuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQoe1xuICAgICAgICAgICAgICAgIG1haW46IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVtcHR5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHBob3RvSWQ6IG51bGwsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHttYWluOiB0cnVlLCBlbXB0eTogdHJ1ZSwgcGhvdG9JZDogbnVsbH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KS50aGVuKHJlc3BvbnNlSnNvbiA9PiB7XG4gICAgICAgICAgICBjb25zdCBtYWluUGhvdG9EYXRhID0gcmVzcG9uc2VKc29uLmZpbmQoKHttYWlufSkgPT4gbWFpbiA9PT0gdHJ1ZSk7XG4gICAgICAgICAgICBjb25zdCBnYWxsZXJ5UGhvdG9zRGF0YSA9IHJlc3BvbnNlSnNvbi5maWx0ZXIoKHttYWlufSkgPT4gbWFpbiAhPT0gdHJ1ZSk7XG5cbiAgICAgICAgICAgIGlmIChtYWluUGhvdG9EYXRhKSB7XG4gICAgICAgICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KG1haW5QaG90b0RhdGEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtYWluUGhvdG9Db250YWluZXIucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGdhbGxlcnlQaG90b3NEYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGxldCBnYWxsZXJ5UGhvdG9zSHRtbCA9ICcnO1xuXG4gICAgICAgICAgICAgICAgZ2FsbGVyeVBob3Rvc0RhdGEuZm9yRWFjaCgocGhvdG9EYXRhKSA9PiBnYWxsZXJ5UGhvdG9zSHRtbCArPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudChwaG90b0RhdGEpKTtcbiAgICAgICAgICAgICAgICBnYWxsZXJ5LmlubmVySFRNTCA9IGdhbGxlcnlQaG90b3NIdG1sXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHN0YXRpYyBjcmVhdGVQaG90b0VsZW1lbnQocGFyYW1zKSB7XG4gICAgICAgIGNvbnN0IHtwaG90b0lkLCBtYWluLCBlbXB0eSwgcGF0aCwgYXZhdGFyVXJsfSA9IHBhcmFtcztcbiAgICAgICAgbGV0IGJ1dHRvbnMgPSAnJztcbiAgICAgICAgbGV0IGVsZW1lbnRDbGFzc2VzID0gJyc7XG4gICAgICAgIGxldCBiYWNrZ3JvdW5kSW1hZ2UgPSAnJztcbiAgICAgICAgbGV0IG1haW5BdHRyaWJ1dGUgPSAnJztcblxuICAgICAgICBpZiAocGF0aCkge1xuICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlID0gYHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7cGF0aH0pXCJgO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGF2YXRhclVybCkge1xuICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlID0gYHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7YXZhdGFyVXJsfSlcImA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobWFpbikge1xuICAgICAgICAgICAgbWFpbkF0dHJpYnV0ZSA9IGBkYXRhLW1haW49XCIke21haW59XCJgO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1haW4gJiYgIWVtcHR5KSB7XG4gICAgICAgICAgICBlbGVtZW50Q2xhc3NlcyA9ICd2Zy1waG90byB2Zy1waG90by0tbWFpbic7XG4gICAgICAgICAgICBidXR0b25zID0gYFxuICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvbiB2Zy1idXR0b24tLXJlZFwiIGRhdGEtYWN0aW9uPVwicmVtb3ZlLXBob3RvXCI+0KPQtNCw0LvQuNGC0Yw8L2J1dHRvbj5cbiAgICAgICAgICAgIGA7XG4gICAgICAgIH0gZWxzZSBpZiAobWFpbiAmJiBlbXB0eSkge1xuICAgICAgICAgICAgZWxlbWVudENsYXNzZXMgPSAndmctcGhvdG8gdmctcGhvdG8tLW1haW4nO1xuICAgICAgICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS1yZWRcIiBkYXRhLWFjdGlvbj1cInJlbW92ZS1waG90b1wiPtCj0LTQsNC70LjRgtGMPC9idXR0b24+XG4gICAgICAgICAgICBgO1xuICAgICAgICB9IGVsc2UgaWYgKCFtYWluICYmIGVtcHR5KSB7XG4gICAgICAgICAgICBlbGVtZW50Q2xhc3NlcyA9ICd2Zy1nYWxsZXJ5X19pdGVtIHZnLXBob3RvIHZnLXBob3RvLS11cGxvYWQnO1xuICAgICAgICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS11cGxvYWRcIiBkYXRhLWFjdGlvbj1cInVwbG9hZC1waG90b1wiPiYjNDM7PC9idXR0b24+XG4gICAgICAgICAgICBgO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudENsYXNzZXMgPSAndmctZ2FsbGVyeV9faXRlbSB2Zy1waG90byc7XG4gICAgICAgICAgICBidXR0b25zID0gYFxuICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvbiB2Zy1idXR0b24tLWdyZWVuXCIgZGF0YS1hY3Rpb249XCJjaG9vc2UtcGhvdG9cIj7QktGL0LHRgNCw0YLRjDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvbiB2Zy1idXR0b24tLXJlZFwiIGRhdGEtYWN0aW9uPVwicmVtb3ZlLXBob3RvXCI+0KPQtNCw0LvQuNGC0Yw8L2J1dHRvbj5cbiAgICAgICAgICAgIGA7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIiR7ZWxlbWVudENsYXNzZXN9XCJcbiAgICAgICAgICAgICAgICAke2JhY2tncm91bmRJbWFnZX1cbiAgICAgICAgICAgICAgICBkYXRhLXBob3RvLWlkPVwiJHtwaG90b0lkfVwiXG4gICAgICAgICAgICAgICAgJHttYWluQXR0cmlidXRlfT5cbiAgICAgICAgICAgICAgICAke2J1dHRvbnN9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICB9XG5cbiAgICBzdGF0aWMgaW5pdEV2ZW50cygpIHtcbiAgICAgICAgY29uc3Qge3Jvb3RFbGVtZW50fSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGJ1dHRvbnMgPSByb290RWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24nKTtcblxuICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMucm91dGVyW2J1dHRvbi5kYXRhc2V0LmFjdGlvbl0sIGZhbHNlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc3RhdGljIHJvdXRlciA9IHtcbiAgICAgICAgJ3VwbG9hZC1waG90byc6IChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBmaWxlSW5wdXQgPSB0aGlzLnJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3R5cGU9XCJmaWxlXCJdJyk7XG5cbiAgICAgICAgICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB0aGlzLnJvdXRlclsnZmlsZS1pbnB1dC1jaGFuZ2VkJ10pO1xuICAgICAgICAgICAgZmlsZUlucHV0LmNsaWNrKCk7XG4gICAgICAgIH0sXG4gICAgICAgICdmaWxlLWlucHV0LWNoYW5nZWQnOiAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdO1xuICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG5cbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRQaG90byhyZWFkZXIucmVzdWx0KVxuICAgICAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg0J7RiNC40LHQutCwINC30LDQs9GA0YPQt9C60Lgg0YTQvtGC0L7Qs9GA0LDRhNC40LggKC3QuNC5KTogJHtyZWFkZXIuZXJyb3J9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgICdyZW1vdmUtcGhvdG8nOiAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGhvdG9FbGVtZW50ID0gZS50YXJnZXQuY2xvc2VzdCgnLnZnLXBob3RvJyk7XG4gICAgICAgICAgICBjb25zdCB7cGhvdG9JZH0gPSBwaG90b0VsZW1lbnQuZGF0YXNldDtcblxuICAgICAgICAgICAgaWYgKCEhcGhvdG9JZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlUGhvdG8ocGhvdG9JZClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAndXBkYXRlLXBob3RvJzogKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHBob3RvRWxlbWVudCA9IGUudGFyZ2V0LmNsb3Nlc3QoJy52Zy1waG90bycpO1xuICAgICAgICAgICAgY29uc3Qge3Bob3RvSWR9ID0gcGhvdG9FbGVtZW50LmRhdGFzZXQ7XG5cbiAgICAgICAgICAgIGlmICghIXBob3RvSWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVBob3RvKHBob3RvSWQpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICB9XG59IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0aWYoX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSkge1xuXHRcdHJldHVybiBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0aWQ6IG1vZHVsZUlkLFxuXHRcdGxvYWRlZDogZmFsc2UsXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuXHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIG1vZHVsZSBleHBvcnRzIG11c3QgYmUgcmV0dXJuZWQgZnJvbSBydW50aW1lIHNvIGVudHJ5IGlubGluaW5nIGlzIGRpc2FibGVkXG4vLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbnJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDM1Mik7XG4iLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmhtZCA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuXHRtb2R1bGUgPSBPYmplY3QuY3JlYXRlKG1vZHVsZSk7XG5cdGlmICghbW9kdWxlLmNoaWxkcmVuKSBtb2R1bGUuY2hpbGRyZW4gPSBbXTtcblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgJ2V4cG9ydHMnLCB7XG5cdFx0ZW51bWVyYWJsZTogdHJ1ZSxcblx0XHRzZXQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdFUyBNb2R1bGVzIG1heSBub3QgYXNzaWduIG1vZHVsZS5leHBvcnRzIG9yIGV4cG9ydHMuKiwgVXNlIEVTTSBleHBvcnQgc3ludGF4LCBpbnN0ZWFkOiAnICsgbW9kdWxlLmlkKTtcblx0XHR9XG5cdH0pO1xuXHRyZXR1cm4gbW9kdWxlO1xufTsiXSwic291cmNlUm9vdCI6IiJ9