!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VisionPhotoGallery=e():t.VisionPhotoGallery=e()}(this,(function(){return function(){"use strict";var t={946:function(t,e,o){function n(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function r(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(Object(o),!0).forEach((function(e){s(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}o.d(e,{default:function(){return l}});var l=function(){function t(e){var o=e.root,n=e.employeeId,r=e.visionPersonId,i=e.token,a=e.disableControls,s=void 0!==a&&a;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!o)throw new Error("Не указан ID корневого элемента для галереи!");var l=document.getElementById(o);if(!l)throw new Error("Проверьте указанный ID корневого элемента для галереи!");if(t.rootElement=l,!n&&!r)throw new Error("Не указан ID пользователя на портале Vision");this.employeeId=n,this.visionPersonId=r,this.token=i,this.disableControls=s,t.draw()}var e,o,n;return e=t,n=[{key:"update",value:function(t){var e=t.employeeId,o=t.token;this.employeeId=e,this.token=o,this.draw()}},{key:"handleError",value:function(t){var e=t.message,o=t.blockingErrorMessage;if(this.errorFunction){var n="";"object"===i(e)&&(e.faultstring?n=e.faultstring:Object.keys(e).reverse().forEach((function(t){n+="".concat(e[t],"<br/>")})));var r=n.length?n:JSON.stringify(e);this.errorFunction(r,"Ошибка")}else{if(o)throw new Error(o);console.log(e)}}},{key:"request",value:function(t){var e=t.requestPath,o=t.requestBody,n={method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":this.token},body:JSON.stringify(o)};return fetch("/api/v2/vision/".concat(e,"/"),n)}},{key:"getPhotos",value:function(){var t={};return this.employeeId&&!this.visionPersonId?t.employeeId=this.employeeId:this.visionPersonId&&(t.vision_person_id=this.visionPersonId),this.request({requestPath:"get_photos",requestBody:r(r({},t),{},{masterAlbum:!0})})}},{key:"addPhoto",value:function(t){return this.request({requestPath:"add_photo",requestBody:{employeeId:this.employeeId,image:t}})}},{key:"deletePhoto",value:function(t){return this.request({requestPath:"delete_photo",requestBody:{photo_id:t}})}},{key:"updatePhoto",value:function(t){return this.request({requestPath:"update_photo",requestBody:{employeeId:this.employeeId,photo_id:t}})}},{key:"draw",value:function(){var t=this,e=this.rootElement;e.innerHTML='\n      <div class="vision-photo-gallery vision-photo-gallery--message" data-message="Загрузка...">\n        <input type="file" class="vision-photo-gallery__file-field" tabindex="-1">\n        <div class="vision-photo-gallery__item vision-photo-gallery__item--main">\n          <h4 class="vision-photo-gallery__title">Основная фотография</h4>\n          <div class="vg-main-photo"></div>\n        </div>\n        <div class="vision-photo-gallery__item">\n          <h4 class="vision-photo-gallery__title">Галерея</h4>\n          <div class="vg-gallery"></div>\n        </div>\n      </div>\n    ';var o=document.querySelector(".vision-photo-gallery"),n=e.querySelector(".vg-main-photo"),r=e.querySelector(".vg-gallery"),i=this.disableControls;this.getPhotos().then((function(e){if(n.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null}),r.innerHTML=t.createPhotoElement({main:!1,empty:!0,photoId:null}),e.ok)return e.json();n.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null}),t.initEvents()}),(function(e){t.handleError({message:e}),t.initEvents()})).then((function(e){if(e){var a=e.find((function(t){return t.main})),s=e.filter((function(t){return!t.main}));if(a?n.innerHTML=t.createPhotoElement(a):n.parentElement.classList.add("hidden"),s.length){var l="";s.forEach((function(e){return l+=t.createPhotoElement(e)})),i||(l+=t.createPhotoElement({main:!1,empty:!0,photoId:null})),r.innerHTML=l}t.initEvents(),o.classList.remove("vision-photo-gallery--message")}}),(function(e){t.handleError({message:e}),t.initEvents()})),this.initEvents()}},{key:"createPhotoElement",value:function(t){var e=t.photoId,o=t.main,n=t.empty,r=t.path,i=t.avatarUrl,a=this.disableControls,s="",l="",u="",c="";return r&&(u='style="background-image: url('.concat(r,')"')),i&&(u='style="background-image: url('.concat(i,')"')),o&&(c='data-main="'.concat(o,'"')),o&&!n?(l="vg-photo vg-photo--main",s='\n        <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n      '):o&&n?(l="vg-photo vg-photo--main",s='\n        <button class="vg-photo__button vg-button" data-action="upload-photo">Загрузить</button>\n      '):!o&&n?(l="vg-gallery__item vg-photo vg-photo--upload",s='\n        <button class="vg-photo__button vg-button vg-button--upload" data-action="upload-photo">&#43;</button>\n      '):(l="vg-gallery__item vg-photo",s='\n        <button class="vg-photo__button vg-button vg-button--green" data-action="update-photo">Выбрать</button>\n        <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n      '),'\n      <div class="'.concat(l,'"\n        ').concat(u,'\n        data-photo-id="').concat(e,'"\n        ').concat(c,">\n        ").concat(a?"":s,"\n        </div>\n      ")}},{key:"initEvents",value:function(){var t=this;this.rootElement.querySelectorAll("button").forEach((function(e){e.addEventListener("click",t.router[e.dataset.action],!1)}))}}],(o=[{key:"errorFunction",get:function(){return t.errorFunction},set:function(e){e&&(t.errorFunction=e)}},{key:"employeeId",get:function(){return t.employeeId},set:function(e){e&&(t.employeeId=e)}},{key:"visionPersonId",get:function(){return t.employeeId},set:function(e){e&&(t.visionPersonId=e)}},{key:"rootElement",get:function(){return t.rootElement}},{key:"token",get:function(){return t.token},set:function(e){e&&(t.token=e)}},{key:"disableControls",get:function(){return t.disableControls},set:function(e){e&&(t.disableControls=e)}}])&&a(e.prototype,o),n&&a(e,n),t}();s(l,"employeeId",null),s(l,"visionPersonId",null),s(l,"rootElement",null),s(l,"token",null),s(l,"disableControls",!1),s(l,"errorFunction",null),s(l,"router",{"upload-photo":function(t){var e=l.rootElement.querySelector('input[type="file"]');e.addEventListener("change",l.router["file-input-changed"]),e.click()},"file-input-changed":function(t){var e=t.target.files[0],o=new FileReader;o.readAsDataURL(e),o.onload=function(){l.addPhoto(o.result).then((function(t){if(t.ok)l.draw();else if(200!==t.status)return t.json()}),(function(t){l.handleError({message:t})}))},o.onerror=function(){l.handleError({message:o.error,blockingErrorMessage:"Ошибка загрузки фотографии (-ий): ".concat(o.error)})}},"remove-photo":function(t){var e=t.target.closest(".vg-photo").dataset.photoId;e&&l.deletePhoto(+e).then((function(t){if(t.ok)l.draw();else if(200!==t.status)return t.json()}),(function(t){l.handleError({message:t})}))},"update-photo":function(t){var e=t.target.closest(".vg-photo").dataset.photoId;e&&l.updatePhoto(+e).then((function(t){if(t.ok)l.draw();else if(200!==t.status)return t.json()}),(function(t){l.handleError({message:t})}))}})}},e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={exports:{}};return t[n](r,r.exports,o),r.exports}return o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o(946)}().default}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS8uL1Zpc2lvblBob3RvR2FsbGVyeS9pbmRleC5qcyIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vVmlzaW9uUGhvdG9HYWxsZXJ5L3dlYnBhY2svc3RhcnR1cCIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInRoaXMiLCJWaXNpb25QaG90b0dhbGxlcnkiLCJlbXBsb3llZUlkIiwidmlzaW9uUGVyc29uSWQiLCJ0b2tlbiIsImRpc2FibGVDb250cm9scyIsIkVycm9yIiwicm9vdEVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZHJhdyIsInBhcmFtcyIsIm1lc3NhZ2UiLCJibG9ja2luZ0Vycm9yTWVzc2FnZSIsImVycm9yRnVuY3Rpb24iLCJtZXNzYWdlU3RyaW5nIiwiZmF1bHRzdHJpbmciLCJPYmplY3QiLCJrZXlzIiwicmV2ZXJzZSIsImZvckVhY2giLCJrZXkiLCJlcnJvck1lc3NhZ2UiLCJsZW5ndGgiLCJKU09OIiwic3RyaW5naWZ5IiwiY29uc29sZSIsImxvZyIsInJlcXVlc3RQYXRoIiwicmVxdWVzdEJvZHkiLCJyZXF1ZXN0RGVmYXVsdHMiLCJtZXRob2QiLCJtb2RlIiwiY3JlZGVudGlhbHMiLCJoZWFkZXJzIiwiYm9keSIsImZldGNoIiwiZW1wbG95ZWUiLCJ2aXNpb25fcGVyc29uX2lkIiwicmVxdWVzdCIsIm1hc3RlckFsYnVtIiwiaW1hZ2UiLCJwaG90b0lkIiwicGhvdG9faWQiLCJpbm5lckhUTUwiLCJnYWxsZXJ5Q29udGFpbmVyIiwicXVlcnlTZWxlY3RvciIsIm1haW5QaG90b0NvbnRhaW5lciIsImdhbGxlcnkiLCJpc0NvbnRyb2xzRGlzYWJsZWQiLCJnZXRQaG90b3MiLCJ0aGVuIiwicmVzcG9uc2UiLCJjcmVhdGVQaG90b0VsZW1lbnQiLCJtYWluIiwiZW1wdHkiLCJvayIsImpzb24iLCJpbml0RXZlbnRzIiwiZXJyb3IiLCJoYW5kbGVFcnJvciIsInJlc3BvbnNlSnNvbiIsIm1haW5QaG90b0RhdGEiLCJmaW5kIiwiZ2FsbGVyeVBob3Rvc0RhdGEiLCJmaWx0ZXIiLCJwYXJlbnRFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiZ2FsbGVyeVBob3Rvc0h0bWwiLCJwaG90b0RhdGEiLCJyZW1vdmUiLCJwYXRoIiwiYXZhdGFyVXJsIiwiYnV0dG9ucyIsImVsZW1lbnRDbGFzc2VzIiwiYmFja2dyb3VuZEltYWdlIiwibWFpbkF0dHJpYnV0ZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwicm91dGVyIiwiZGF0YXNldCIsImFjdGlvbiIsInZhbHVlIiwiZSIsImZpbGVJbnB1dCIsImNsaWNrIiwiZmlsZSIsInRhcmdldCIsImZpbGVzIiwicmVhZGVyIiwiRmlsZVJlYWRlciIsInJlYWRBc0RhdGFVUkwiLCJvbmxvYWQiLCJhZGRQaG90byIsInJlc3VsdCIsInN0YXR1cyIsIm9uZXJyb3IiLCJjbG9zZXN0IiwiZGVsZXRlUGhvdG8iLCJ1cGRhdGVQaG90byIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsIl9fd2VicGFja19tb2R1bGVzX18iLCJkIiwiZGVmaW5pdGlvbiIsIm8iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJw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RUFBRUksT0FBT1UsUUFBUSxhQUNMakIsUUFBekJ4QyxRQUVGQSxHQTFpQlN6QyxFQTJpQlJvRyxhQUFhM0QsR0FBU1MsTUFDekIsU0FBQUMsR0FDRSxHQUFJQSxFQUFTSSxHQTdpQkp2RCxFQThpQkZTLFlBQ0EsR0FBd0IsTUFBcEIwQyxFQUFTNkMsT0FDbEIsT0FBTzdDLEVBQVNLLFVBR3BCLFNBQUFFLEdBbmpCVzFELEVBb2pCSjJELFlBQVksQ0FDZmhELFFBQVMrQyxZQzNqQm5CMkMsRUFBMkIsR0FHL0IsU0FBU0MsRUFBb0JDLEdBRTVCLEdBQUdGLEVBQXlCRSxHQUMzQixPQUFPRixFQUF5QkUsR0FBVTVHLFFBRzNDLElBQUlDLEVBQVN5RyxFQUF5QkUsR0FBWSxDQUdqRDVHLFFBQVMsSUFPVixPQUhBNkcsRUFBb0JELEdBQVUzRyxFQUFRQSxFQUFPRCxRQUFTMkcsR0FHL0MxRyxFQUFPRCxRQ2pCZixPQ0ZBMkcsRUFBb0JHLEVBQUksU0FBUzlHLEVBQVMrRyxHQUN6QyxJQUFJLElBQUl0RixLQUFPc0YsRUFDWEosRUFBb0JLLEVBQUVELEVBQVl0RixLQUFTa0YsRUFBb0JLLEVBQUVoSCxFQUFTeUIsSUFDNUVKLE9BQU80RixlQUFlakgsRUFBU3lCLEVBQUssQ0FBRXlGLFlBQVksRUFBTUMsSUFBS0osRUFBV3RGLE1DSjNFa0YsRUFBb0JLLEVBQUksU0FBU0ksRUFBS0MsR0FBUSxPQUFPaEcsT0FBT2lHLFVBQVVDLGVBQWVDLEtBQUtKLEVBQUtDLElGR3hGVixFQUFvQixLIiwiZmlsZSI6IlZpc2lvblBob3RvR2FsbGVyeS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIlZpc2lvblBob3RvR2FsbGVyeVwiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJWaXNpb25QaG90b0dhbGxlcnlcIl0gPSBmYWN0b3J5KCk7XG59KSh0aGlzLCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFwiLi9hcHAuc2Nzc1wiO1xuXG4vKipcbiAqINCa0LvQsNGB0YEg0LPQsNC70LXRgNC10LguXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZpc2lvblBob3RvR2FsbGVyeSB7XG4gIHN0YXRpYyBlbXBsb3llZUlkID0gbnVsbDtcbiAgc3RhdGljIHZpc2lvblBlcnNvbklkID0gbnVsbDtcbiAgc3RhdGljIHJvb3RFbGVtZW50ID0gbnVsbDtcbiAgc3RhdGljIHRva2VuID0gbnVsbDtcbiAgc3RhdGljIGRpc2FibGVDb250cm9scyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiDQmtC+0L3RgdGC0YDRg9C60YLQvtGAINGN0LrQt9C10LzQv9C70Y/RgNCwINC60LvQsNGB0YHQsCDQs9Cw0LvQtdGA0LXQuC5cbiAgICogQHBhcmFtIHJvb3Qge3N0cmluZ30gSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAsINC60YPQtNCwINCx0YPQtNC10YIg0YDQtdC90LTQtdGA0LjRgtGM0YHRjyDQs9Cw0LvQtdGA0LXRjy5cbiAgICogQHBhcmFtIGVtcGxveWVlSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcGFyYW0gdmlzaW9uUGVyc29uSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKiBAcGFyYW0gdG9rZW4ge3N0cmluZ30gQ1NSRi3RgtC+0LrQtdC9INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICogQHBhcmFtIGRpc2FibGVDb250cm9scyB7Ym9vbGVhbn0g0J7RgtC60LvRjtGH0LjRgtGMINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0LfQsNCz0YDRg9C30LrQuCwg0L7QsdC90L7QstC70LXQvdC40Y8g0Lgg0YPQtNCw0LvQtdC90LjRjyDRhNC+0YLQvtCz0YDQsNGE0LjQuS5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHtcbiAgICByb290LFxuICAgIGVtcGxveWVlSWQsXG4gICAgdmlzaW9uUGVyc29uSWQsXG4gICAgdG9rZW4sXG4gICAgZGlzYWJsZUNvbnRyb2xzID0gZmFsc2VcbiAgfSkge1xuICAgIGlmICghcm9vdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwi0J3QtSDRg9C60LDQt9Cw0L0gSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAg0LTQu9GPINCz0LDQu9C10YDQtdC4IVwiKTtcbiAgICB9XG5cbiAgICBjb25zdCByb290RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJvb3QpO1xuXG4gICAgaWYgKCEhcm9vdEVsZW1lbnQpIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS5yb290RWxlbWVudCA9IHJvb3RFbGVtZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCLQn9GA0L7QstC10YDRjNGC0LUg0YPQutCw0LfQsNC90L3Ri9C5IElEINC60L7RgNC90LXQstC+0LPQviDRjdC70LXQvNC10L3RgtCwINC00LvRjyDQs9Cw0LvQtdGA0LXQuCFcIik7XG4gICAgfVxuXG4gICAgaWYgKCFlbXBsb3llZUlkICYmICF2aXNpb25QZXJzb25JZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwi0J3QtSDRg9C60LDQt9Cw0L0gSUQg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uXCIpO1xuICAgIH1cblxuICAgIHRoaXMuZW1wbG95ZWVJZCA9IGVtcGxveWVlSWQ7XG4gICAgdGhpcy52aXNpb25QZXJzb25JZCA9IHZpc2lvblBlcnNvbklkO1xuICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcbiAgICB0aGlzLmRpc2FibGVDb250cm9scyA9IGRpc2FibGVDb250cm9scztcblxuICAgIFZpc2lvblBob3RvR2FsbGVyeS5kcmF3KCk7XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LDQtdC80YvQuSDQvNC10YLQvtC0INC00LvRjyDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICogQHR5cGUge251bGx8RnVuY3Rpb259INCk0YPQvdC60YbQuNGPINC+0LHRgNCw0LHQvtGC0YfQuNC6INC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKi9cbiAgc3RhdGljIGVycm9yRnVuY3Rpb24gPSBudWxsO1xuICAvKipcbiAgICog0J/QvtC70YPRh9C10L3QuNC1INC80LXRgtC+0LTQsCDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqIEB0eXBlIHtudWxsfEZ1bmN0aW9ufSDQpNGD0L3QutGG0LjRjyDQvtCx0YDQsNCx0L7RgtGH0LjQuiDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICovXG4gIGdldCBlcnJvckZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZXJyb3JGdW5jdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDQvNC10YLQvtC00LAg0LTQu9GPINC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKiBAcGFyYW0gZXJyb3JGdW5jdGlvbiB7bnVsbHxGdW5jdGlvbn0g0KTRg9C90LrRhtC40Y8g0L7QsdGA0LDQsdC+0YLRh9C40Log0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqL1xuICBzZXQgZXJyb3JGdW5jdGlvbihlcnJvckZ1bmN0aW9uKSB7XG4gICAgaWYgKGVycm9yRnVuY3Rpb24pIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS5lcnJvckZ1bmN0aW9uID0gZXJyb3JGdW5jdGlvbjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J7QsdC90L7QstC70LXQvdC40LUg0L/QsNGA0LDQvNC10YLRgNC+0LIg0LPQsNC70LXRgNC10LguXG4gICAqIEBwYXJhbSBlbXBsb3llZUlkIHtudW1iZXJ8bnVtYmVyfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIHRva2VuIHtzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICovXG4gIHN0YXRpYyB1cGRhdGUoeyBlbXBsb3llZUlkLCB0b2tlbiB9KSB7XG4gICAgdGhpcy5lbXBsb3llZUlkID0gZW1wbG95ZWVJZDtcbiAgICB0aGlzLnRva2VuID0gdG9rZW47XG5cbiAgICB0aGlzLmRyYXcoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LjRgtGMIElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICovXG4gIGdldCBlbXBsb3llZUlkKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZW1wbG95ZWVJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDRjdC60LfQtdC80L/Qu9GP0YDRgyDQs9Cw0LvQtdGA0LXQuCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIGVtcGxveWVlSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKi9cbiAgc2V0IGVtcGxveWVlSWQoZW1wbG95ZWVJZCkge1xuICAgIGlmIChlbXBsb3llZUlkKSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkuZW1wbG95ZWVJZCA9IGVtcGxveWVlSWQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0YwgSUQg0YHQvtGC0YDRg9C00L3QuNC60LAg0LDRg9GC0YHQvtGA0YHQtdGA0LAuXG4gICAqIEByZXR1cm4ge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKi9cbiAgZ2V0IHZpc2lvblBlcnNvbklkKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZW1wbG95ZWVJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDRjdC60LfQtdC80L/Qu9GP0YDRgyDQs9Cw0LvQtdGA0LXQuCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICogQHBhcmFtIHZpc2lvblBlcnNvbklkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICovXG4gIHNldCB2aXNpb25QZXJzb25JZCh2aXNpb25QZXJzb25JZCkge1xuICAgIGlmICh2aXNpb25QZXJzb25JZCkge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LnZpc2lvblBlcnNvbklkID0gdmlzaW9uUGVyc29uSWQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCa0L7RgNC90LXQstC+0Lkg0Y3Qu9C10LzQtdC90YIsINCyINC60L7RgtC+0YDRi9C5INCx0YPQtNC10YIg0YDQtdC90LTQtdGA0LjRgtGM0YHRjyDQs9Cw0LvQtdGA0LXRjy5cbiAgICogQHJldHVybiB7bnVsbHxFbGVtZW50fSDQmtC+0YDQvdC10LLQvtC5INGN0LvQtdC80LXQvdGCINC00LvRjyDRgNC10L3QtNC10YDQsC5cbiAgICovXG4gIGdldCByb290RWxlbWVudCgpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LnJvb3RFbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0YwgQ1NSRi3RgtC+0LrQtdC9INGB0LXRgdGB0LjQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8uXG4gICAqIEByZXR1cm4ge251bGx8c3RyaW5nfSBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICovXG4gIGdldCB0b2tlbigpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LnRva2VuO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C40YLRjCBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICogQHBhcmFtIHRva2VuIHtzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC40Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPLlxuICAgKi9cbiAgc2V0IHRva2VuKHRva2VuKSB7XG4gICAgaWYgKHRva2VuKSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkudG9rZW4gPSB0b2tlbjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J/QvtC70YPRh9C40YLRjCDQt9C90LDRh9C10L3QuNC1INGB0L7RgdGC0L7Rj9C90LjRjyDQutC+0L3RgtGA0L7Qu9C+0LIuXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59INCh0L7RgdGC0L7Rj9C90LjQtSDQutC+0L3RgtGA0L7Qu9C+0LIuXG4gICAqL1xuICBnZXQgZGlzYWJsZUNvbnRyb2xzKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZGlzYWJsZUNvbnRyb2xzO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C40YLRjCBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICogQHBhcmFtIHZhbHVlIHtib29sZWFufSDQktC60LvRjtGH0LjRgtGML9C+0YLQutC70Y7Rh9C40YLRjCDQutC+0L3RgtGA0L7Qu9GLLlxuICAgKi9cbiAgc2V0IGRpc2FibGVDb250cm9scyh2YWx1ZSkge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LmRpc2FibGVDb250cm9scyA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQntCx0YDQsNCx0L7RgtGH0LjQuiDQvtGI0LjQsdC+0LouXG4gICAqIEBwYXJhbSBwYXJhbXMubWVzc2FnZSB7c3RyaW5nfSDQodC+0L7QsdGJ0LXQvdC40LUg0L7QsSDQvtGI0LjQsdC60LUuXG4gICAqIEBwYXJhbSBwYXJhbXMuYmxvY2tpbmdFcnJvck1lc3NhZ2Uge3N0cmluZ30g0JHQu9C+0LrQuNGA0YPRjtGJ0LXQtSDQv9C+0YLQvtC6INGB0L7QvtCx0YnQtdC90LjQtSDQvtCxINC+0YjQuNCx0LrQtS5cbiAgICovXG4gIHN0YXRpYyBoYW5kbGVFcnJvcihwYXJhbXMpIHtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIGJsb2NraW5nRXJyb3JNZXNzYWdlIH0gPSBwYXJhbXM7XG5cbiAgICBpZiAodGhpcy5lcnJvckZ1bmN0aW9uKSB7XG4gICAgICBsZXQgbWVzc2FnZVN0cmluZyA9IFwiXCI7XG5cbiAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICBpZiAobWVzc2FnZS5mYXVsdHN0cmluZykge1xuICAgICAgICAgIG1lc3NhZ2VTdHJpbmcgPSBtZXNzYWdlLmZhdWx0c3RyaW5nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIE9iamVjdC5rZXlzKG1lc3NhZ2UpXG4gICAgICAgICAgICAucmV2ZXJzZSgpXG4gICAgICAgICAgICAuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgICBtZXNzYWdlU3RyaW5nICs9IGAke21lc3NhZ2Vba2V5XX08YnIvPmA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBtZXNzYWdlU3RyaW5nLmxlbmd0aFxuICAgICAgICA/IG1lc3NhZ2VTdHJpbmdcbiAgICAgICAgOiBKU09OLnN0cmluZ2lmeShtZXNzYWdlKTtcblxuICAgICAgdGhpcy5lcnJvckZ1bmN0aW9uKGVycm9yTWVzc2FnZSwgXCLQntGI0LjQsdC60LBcIik7XG4gICAgfSBlbHNlIGlmIChibG9ja2luZ0Vycm9yTWVzc2FnZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGJsb2NraW5nRXJyb3JNZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCe0LHRkdGA0YLQutCwINC00LvRjyDQt9Cw0L/RgNC+0YHQvtCyINC6IEFQSS5cbiAgICogQHBhcmFtIHJlcXVlc3RQYXRoIHtzdHJpbmd9INCd0LDQt9Cy0LDQvdC40LUg0LzQtdGC0L7QtNCwIEFQSS5cbiAgICogQHBhcmFtIHJlcXVlc3RCb2R5IHtvYmplY3R9INCf0LDRgNCw0LzQtdGC0YDRiyDQt9Cw0L/RgNC+0YHQsC5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgcmVxdWVzdCh7IHJlcXVlc3RQYXRoLCByZXF1ZXN0Qm9keSB9KSB7XG4gICAgY29uc3QgcmVxdWVzdERlZmF1bHRzID0ge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIG1vZGU6IFwic2FtZS1vcmlnaW5cIixcbiAgICAgIGNyZWRlbnRpYWxzOiBcInNhbWUtb3JpZ2luXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBcIlgtQ1NSRlRva2VuXCI6IHRoaXMudG9rZW5cbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSlcbiAgICB9O1xuXG4gICAgcmV0dXJuIGZldGNoKGAvYXBpL3YyL3Zpc2lvbi8ke3JlcXVlc3RQYXRofS9gLCByZXF1ZXN0RGVmYXVsdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqINCS0YvQs9GA0YPQt9C60LAg0LLRgdC10YUg0YTQvtGC0L7Qs9GA0LDRhNC40Lkg0YEg0L/QvtGA0YLQsNC70LAgVmlzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIGdldFBob3RvcygpIHtcbiAgICBjb25zdCBlbXBsb3llZSA9IHt9O1xuXG4gICAgaWYgKHRoaXMuZW1wbG95ZWVJZCAmJiAhdGhpcy52aXNpb25QZXJzb25JZCkge1xuICAgICAgZW1wbG95ZWUuZW1wbG95ZWVJZCA9IHRoaXMuZW1wbG95ZWVJZDtcbiAgICB9IGVsc2UgaWYgKHRoaXMudmlzaW9uUGVyc29uSWQpIHtcbiAgICAgIGVtcGxveWVlLnZpc2lvbl9wZXJzb25faWQgPSB0aGlzLnZpc2lvblBlcnNvbklkO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgcmVxdWVzdFBhdGg6IFwiZ2V0X3Bob3Rvc1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgLi4uZW1wbG95ZWUsXG4gICAgICAgIG1hc3RlckFsYnVtOiB0cnVlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0JfQsNC/0YDQvtGBINC90LAg0LTQvtCx0LDQstC70LXQvdC40LUgKNC30LDQs9GA0YPQt9C60YMpINGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gaW1hZ2Uge0J1ZmZlckVuY29kaW5nfSDQpNC+0YLQvtCz0YDQsNGE0LjQuCDQsiDRhNC+0YDQvNCw0YLQtSBCYXNlNjQuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINGBINGA0LXQt9GD0LvRjNGC0LDRgtC+0Lwg0LLRi9C/0L7Qu9C90LXQvdC40Y8g0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgYWRkUGhvdG8oaW1hZ2UpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiBcImFkZF9waG90b1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgZW1wbG95ZWVJZDogdGhpcy5lbXBsb3llZUlkLFxuICAgICAgICBpbWFnZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCX0LDQv9GA0L7RgSDQvdCwINGD0LTQsNC70LXQvdC40LUg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwaG90b0lkIHtOdW1iZXJ9IElEINGE0L7RgtC+0LPRgNCw0YTQuNC4INC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIGRlbGV0ZVBob3RvKHBob3RvSWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiBcImRlbGV0ZV9waG90b1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgcGhvdG9faWQ6IHBob3RvSWRcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDQvtCx0L3QvtCy0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHBhcmFtIHBob3RvSWQge051bWJlcn0gSUQg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0L3QsCDQv9C+0YDRgtCw0LvQtSBWaXNpb24uXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINGBINGA0LXQt9GD0LvRjNGC0LDRgtC+0Lwg0LLRi9C/0L7Qu9C90LXQvdC40Y8g0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgdXBkYXRlUGhvdG8ocGhvdG9JZCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgcmVxdWVzdFBhdGg6IFwidXBkYXRlX3Bob3RvXCIsXG4gICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICBlbXBsb3llZUlkOiB0aGlzLmVtcGxveWVlSWQsXG4gICAgICAgIHBob3RvX2lkOiBwaG90b0lkXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0J7RgtGA0LjRgdC+0LLQutCwIERPTSDQs9Cw0LvQtdGA0LXQuNC4LlxuICAgKi9cbiAgc3RhdGljIGRyYXcoKSB7XG4gICAgY29uc3Qgcm9vdEVsZW1lbnQgPSB0aGlzLnJvb3RFbGVtZW50O1xuXG4gICAgcm9vdEVsZW1lbnQuaW5uZXJIVE1MID0gYFxuICAgICAgPGRpdiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5IHZpc2lvbi1waG90by1nYWxsZXJ5LS1tZXNzYWdlXCIgZGF0YS1tZXNzYWdlPVwi0JfQsNCz0YDRg9C30LrQsC4uLlwiPlxuICAgICAgICA8aW5wdXQgdHlwZT1cImZpbGVcIiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X19maWxlLWZpZWxkXCIgdGFiaW5kZXg9XCItMVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX2l0ZW0gdmlzaW9uLXBob3RvLWdhbGxlcnlfX2l0ZW0tLW1haW5cIj5cbiAgICAgICAgICA8aDQgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9fdGl0bGVcIj7QntGB0L3QvtCy0L3QsNGPINGE0L7RgtC+0LPRgNCw0YTQuNGPPC9oND5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidmctbWFpbi1waG90b1wiPjwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X19pdGVtXCI+XG4gICAgICAgICAgPGg0IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX3RpdGxlXCI+0JPQsNC70LXRgNC10Y88L2g0PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2Zy1nYWxsZXJ5XCI+PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgYDtcblxuICAgIGNvbnN0IGdhbGxlcnlDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnZpc2lvbi1waG90by1nYWxsZXJ5XCIpO1xuICAgIGNvbnN0IG1haW5QaG90b0NvbnRhaW5lciA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmctbWFpbi1waG90b1wiKTtcbiAgICBjb25zdCBnYWxsZXJ5ID0gcm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi52Zy1nYWxsZXJ5XCIpO1xuICAgIGNvbnN0IHsgZGlzYWJsZUNvbnRyb2xzOiBpc0NvbnRyb2xzRGlzYWJsZWQgfSA9IHRoaXM7XG5cbiAgICB0aGlzLmdldFBob3RvcygpXG4gICAgICAudGhlbihcbiAgICAgICAgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudCh7XG4gICAgICAgICAgICBtYWluOiB0cnVlLFxuICAgICAgICAgICAgZW1wdHk6IHRydWUsXG4gICAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBnYWxsZXJ5LmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHtcbiAgICAgICAgICAgIG1haW46IGZhbHNlLFxuICAgICAgICAgICAgZW1wdHk6IHRydWUsXG4gICAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudCh7XG4gICAgICAgICAgICAgIG1haW46IHRydWUsXG4gICAgICAgICAgICAgIGVtcHR5OiB0cnVlLFxuICAgICAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgICB9XG4gICAgICApXG4gICAgICAudGhlbihcbiAgICAgICAgcmVzcG9uc2VKc29uID0+IHtcbiAgICAgICAgICBpZiAoIXJlc3BvbnNlSnNvbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IG1haW5QaG90b0RhdGEgPSByZXNwb25zZUpzb24uZmluZCgoeyBtYWluIH0pID0+IG1haW4pO1xuICAgICAgICAgIGNvbnN0IGdhbGxlcnlQaG90b3NEYXRhID0gcmVzcG9uc2VKc29uLmZpbHRlcigoeyBtYWluIH0pID0+ICFtYWluKTtcblxuICAgICAgICAgIGlmICghIW1haW5QaG90b0RhdGEpIHtcbiAgICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudChcbiAgICAgICAgICAgICAgbWFpblBob3RvRGF0YVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoZ2FsbGVyeVBob3Rvc0RhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICBsZXQgZ2FsbGVyeVBob3Rvc0h0bWwgPSBcIlwiO1xuXG4gICAgICAgICAgICBnYWxsZXJ5UGhvdG9zRGF0YS5mb3JFYWNoKFxuICAgICAgICAgICAgICBwaG90b0RhdGEgPT5cbiAgICAgICAgICAgICAgICAoZ2FsbGVyeVBob3Rvc0h0bWwgKz0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQocGhvdG9EYXRhKSlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmICghaXNDb250cm9sc0Rpc2FibGVkKSB7XG4gICAgICAgICAgICAgIGdhbGxlcnlQaG90b3NIdG1sICs9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHtcbiAgICAgICAgICAgICAgICBtYWluOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbXB0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBnYWxsZXJ5LmlubmVySFRNTCA9IGdhbGxlcnlQaG90b3NIdG1sO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgICAgIGdhbGxlcnlDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcInZpc2lvbi1waG90by1nYWxsZXJ5LS1tZXNzYWdlXCIpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7XG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQo9C90LjQstC10YDRgdCw0LvRjNC90YvQuSDQvNC10YLQvtC0INC00LvRjyDRgdC+0LfQtNCw0L3QuNGPINGN0LvQtdC80LXQvdGC0LAg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwYXJhbXMucGhvdG9JZCB7bnVtYmVyfSBJRCDRhNC+0YLQvtCz0YDQsNGE0LjQuCDQvdCwINC/0L7RgNGC0LDQu9C1IFZpc2lvbi5cbiAgICogQHBhcmFtIHBhcmFtcy5tYWluIHtib29sZWFufSAg0KTQu9Cw0LMg0L7RgdC90L7QstC90L7Qs9C+INGE0L7RgtC+LlxuICAgKiBAcGFyYW0gcGFyYW1zLmVtcHR5IHtib29sZWFufSDQpNC70LDQsyBcItC/0YPRgdGC0L7Qs9C+XCIg0YTQvtGC0L4sINC40YHQv9C+0LvRjNC30YPQtdGC0YHRjyDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQutC90L7Qv9C60Lgg0LfQsNCz0YDRg9C30LrQuC5cbiAgICogQHBhcmFtIHBhcmFtcy5wYXRoIHtzdHJpbmd9INCf0YPRgtGMINC6INGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gcGFyYW1zLmF2YXRhclVybCB7c3RyaW5nfSDQn9GD0YLRjCDQuiDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHJldHVybnMge3N0cmluZ30g0K3Qu9C10LzQtdC90YIg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0LIg0LLQuNC00LUg0YHRgtGA0L7QutC4LlxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZVBob3RvRWxlbWVudChwYXJhbXMpIHtcbiAgICBjb25zdCB7IHBob3RvSWQsIG1haW4sIGVtcHR5LCBwYXRoLCBhdmF0YXJVcmwgfSA9IHBhcmFtcztcbiAgICBjb25zdCB7IGRpc2FibGVDb250cm9sczogaXNDb250cm9sc0Rpc2FibGVkIH0gPSB0aGlzO1xuICAgIGxldCBidXR0b25zID0gXCJcIjtcbiAgICBsZXQgZWxlbWVudENsYXNzZXMgPSBcIlwiO1xuICAgIGxldCBiYWNrZ3JvdW5kSW1hZ2UgPSBcIlwiO1xuICAgIGxldCBtYWluQXR0cmlidXRlID0gXCJcIjtcblxuICAgIGlmIChwYXRoKSB7XG4gICAgICBiYWNrZ3JvdW5kSW1hZ2UgPSBgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHtwYXRofSlcImA7XG4gICAgfVxuXG4gICAgaWYgKGF2YXRhclVybCkge1xuICAgICAgYmFja2dyb3VuZEltYWdlID0gYHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7YXZhdGFyVXJsfSlcImA7XG4gICAgfVxuXG4gICAgaWYgKG1haW4pIHtcbiAgICAgIG1haW5BdHRyaWJ1dGUgPSBgZGF0YS1tYWluPVwiJHttYWlufVwiYDtcbiAgICB9XG5cbiAgICBpZiAobWFpbiAmJiAhZW1wdHkpIHtcbiAgICAgIGVsZW1lbnRDbGFzc2VzID0gXCJ2Zy1waG90byB2Zy1waG90by0tbWFpblwiO1xuICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uIHZnLWJ1dHRvbi0tcmVkXCIgZGF0YS1hY3Rpb249XCJyZW1vdmUtcGhvdG9cIj7Qo9C00LDQu9C40YLRjDwvYnV0dG9uPlxuICAgICAgYDtcbiAgICB9IGVsc2UgaWYgKG1haW4gJiYgZW1wdHkpIHtcbiAgICAgIGVsZW1lbnRDbGFzc2VzID0gXCJ2Zy1waG90byB2Zy1waG90by0tbWFpblwiO1xuICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uXCIgZGF0YS1hY3Rpb249XCJ1cGxvYWQtcGhvdG9cIj7Ql9Cw0LPRgNGD0LfQuNGC0Yw8L2J1dHRvbj5cbiAgICAgIGA7XG4gICAgfSBlbHNlIGlmICghbWFpbiAmJiBlbXB0eSkge1xuICAgICAgZWxlbWVudENsYXNzZXMgPSBcInZnLWdhbGxlcnlfX2l0ZW0gdmctcGhvdG8gdmctcGhvdG8tLXVwbG9hZFwiO1xuICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uIHZnLWJ1dHRvbi0tdXBsb2FkXCIgZGF0YS1hY3Rpb249XCJ1cGxvYWQtcGhvdG9cIj4mIzQzOzwvYnV0dG9uPlxuICAgICAgYDtcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbWVudENsYXNzZXMgPSBcInZnLWdhbGxlcnlfX2l0ZW0gdmctcGhvdG9cIjtcbiAgICAgIGJ1dHRvbnMgPSBgXG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvbiB2Zy1idXR0b24tLWdyZWVuXCIgZGF0YS1hY3Rpb249XCJ1cGRhdGUtcGhvdG9cIj7QktGL0LHRgNCw0YLRjDwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS1yZWRcIiBkYXRhLWFjdGlvbj1cInJlbW92ZS1waG90b1wiPtCj0LTQsNC70LjRgtGMPC9idXR0b24+XG4gICAgICBgO1xuICAgIH1cblxuICAgIHJldHVybiBgXG4gICAgICA8ZGl2IGNsYXNzPVwiJHtlbGVtZW50Q2xhc3Nlc31cIlxuICAgICAgICAke2JhY2tncm91bmRJbWFnZX1cbiAgICAgICAgZGF0YS1waG90by1pZD1cIiR7cGhvdG9JZH1cIlxuICAgICAgICAke21haW5BdHRyaWJ1dGV9PlxuICAgICAgICAke2lzQ29udHJvbHNEaXNhYmxlZCA/IFwiXCIgOiBidXR0b25zfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIGA7XG4gIH1cblxuICAvKipcbiAgICog0JjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0YHQvtCx0YvRgtC40Lkg0LTQu9GPINC60L3QvtC/0L7QuiDQs9Cw0LvQtdGA0LXQuC5cbiAgICovXG4gIHN0YXRpYyBpbml0RXZlbnRzKCkge1xuICAgIGNvbnN0IHsgcm9vdEVsZW1lbnQgfSA9IHRoaXM7XG4gICAgY29uc3QgYnV0dG9ucyA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJidXR0b25cIik7XG5cbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICBcImNsaWNrXCIsXG4gICAgICAgIHRoaXMucm91dGVyW2J1dHRvbi5kYXRhc2V0LmFjdGlvbl0sXG4gICAgICAgIGZhbHNlXG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCg0L7Rg9GC0LXRgC5cbiAgICogQHR5cGUge3tcInJlbW92ZS1waG90b1wiOiBmdW5jdGlvbigqKTogdm9pZCwgXCJmaWxlLWlucHV0LWNoYW5nZWRcIjogZnVuY3Rpb24oKik6IHZvaWQsIFwidXBsb2FkLXBob3RvXCI6IGZ1bmN0aW9uKCopOiB2b2lkLCBcInVwZGF0ZS1waG90b1wiOiBmdW5jdGlvbigqKTogdm9pZH19XG4gICAqL1xuICBzdGF0aWMgcm91dGVyID0ge1xuICAgIC8qKlxuICAgICAqINCX0LDQs9GA0YPQt9C60LAg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAgICogQHBhcmFtIGUge0V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICBcInVwbG9hZC1waG90b1wiOiBlID0+IHtcbiAgICAgIGNvbnN0IGZpbGVJbnB1dCA9IHRoaXMucm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1cImZpbGVcIl0nKTtcblxuICAgICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgdGhpcy5yb3V0ZXJbXCJmaWxlLWlucHV0LWNoYW5nZWRcIl0pO1xuICAgICAgZmlsZUlucHV0LmNsaWNrKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDQodC70YPRiNCw0YLQtdC70Ywg0YHQvtCx0YvRgtC40Y8g0LjQt9C80LXQvdC10L3QuNGPINGE0LDQudC70L7QstC+0LPQviDQv9C+0LvRjyDQstCy0L7QtNCwLlxuICAgICAqIEBwYXJhbSBlIHtldmVudH0g0KHQvtCx0YvRgtC40LUuXG4gICAgICovXG4gICAgXCJmaWxlLWlucHV0LWNoYW5nZWRcIjogZSA9PiB7XG4gICAgICBjb25zdCBmaWxlID0gZS50YXJnZXQuZmlsZXNbMF07XG4gICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcblxuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5hZGRQaG90byhyZWFkZXIucmVzdWx0KS50aGVuKFxuICAgICAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfTtcblxuICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgIG1lc3NhZ2U6IHJlYWRlci5lcnJvcixcbiAgICAgICAgICBibG9ja2luZ0Vycm9yTWVzc2FnZTogYNCe0YjQuNCx0LrQsCDQt9Cw0LPRgNGD0LfQutC4INGE0L7RgtC+0LPRgNCw0YTQuNC4ICgt0LjQuSk6ICR7cmVhZGVyLmVycm9yfWBcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH0sXG4gICAgLyoqXG4gICAgICog0JfQsNC/0YDQvtGBINC90LAg0YPQtNCw0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICAgKiBAcGFyYW0gZSB7RXZlbnR9INCh0L7QsdGL0YLQuNC1LlxuICAgICAqL1xuICAgIFwicmVtb3ZlLXBob3RvXCI6IGUgPT4ge1xuICAgICAgY29uc3QgcGhvdG9FbGVtZW50ID0gZS50YXJnZXQuY2xvc2VzdChcIi52Zy1waG90b1wiKTtcbiAgICAgIGNvbnN0IHsgcGhvdG9JZCB9ID0gcGhvdG9FbGVtZW50LmRhdGFzZXQ7XG5cbiAgICAgIGlmICghIXBob3RvSWQpIHtcbiAgICAgICAgdGhpcy5kZWxldGVQaG90bygrcGhvdG9JZCkudGhlbihcbiAgICAgICAgICByZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICAqINCX0LDQv9GA0L7RgSDQvdCwINC+0LHQvdC+0LLQu9C10L3QuNC1INGE0L7RgtC+0LPRgNCw0YTQuNC4INGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgICAqIEBwYXJhbSBlIHtFdmVudH0g0KHQvtCx0YvRgtC40LUuXG4gICAgICovXG4gICAgXCJ1cGRhdGUtcGhvdG9cIjogZSA9PiB7XG4gICAgICBjb25zdCBwaG90b0VsZW1lbnQgPSBlLnRhcmdldC5jbG9zZXN0KFwiLnZnLXBob3RvXCIpO1xuICAgICAgY29uc3QgeyBwaG90b0lkIH0gPSBwaG90b0VsZW1lbnQuZGF0YXNldDtcblxuICAgICAgaWYgKCEhcGhvdG9JZCkge1xuICAgICAgICB0aGlzLnVwZGF0ZVBob3RvKCtwaG90b0lkKS50aGVuKFxuICAgICAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn1cbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdGlmKF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0pIHtcblx0XHRyZXR1cm4gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gbW9kdWxlIGV4cG9ydHMgbXVzdCBiZSByZXR1cm5lZCBmcm9tIHJ1bnRpbWUgc28gZW50cnkgaW5saW5pbmcgaXMgZGlzYWJsZWRcbi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xucmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oOTQ2KTtcbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIGRlZmluaXRpb24pIHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqLCBwcm9wKSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsgfSJdLCJzb3VyY2VSb290IjoiIn0=