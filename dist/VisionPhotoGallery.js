!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VisionPhotoGallery=t():e.VisionPhotoGallery=t()}(this,(function(){return function(){"use strict";var e={d:function(t,o){for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}e.d(t,{default:function(){return a}});var a=function(){function e(t){var o=t.root,n=t.employeeId,r=t.visionPersonId,i=t.personId,s=t.token,a=t.controls,u=t.masterAlbum,l=void 0===u||u;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!o)throw new Error("Не указан ID корневого элемента для галереи!");var c=document.getElementById(o);if(!c)throw new Error("Проверьте указанный ID корневого элемента для галереи!");if(e.rootElement=c,!n&&!r&&!i)throw new Error("Не указан ID пользователя на портале Vision");this.employeeId=n,this.visionPersonId=r,this.personId=i,this.token=s,this.controls=a,this.masterAlbum=l,e.draw()}var t,n,s;return t=e,s=[{key:"update",value:function(e){var t=e.employeeId,o=e.token;this.employeeId=t,this.token=o,this.draw()}},{key:"handleError",value:function(e){var t=e.message,n=e.blockingErrorMessage;if(this.errorFunction){var r="";"object"===o(t)&&(t.faultstring?r=t.faultstring:Object.keys(t).reverse().forEach((function(e){r+="".concat(t[e],"<br/>")})));var i=r.length?r:JSON.stringify(t);this.errorFunction(i,"Ошибка")}else{if(n)throw new Error(n);console.log(t)}}},{key:"request",value:function(e){var t=e.requestPath,o=e.requestBody,n={method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":this.token},body:JSON.stringify(o)};return fetch("/api/v2/vision/".concat(t,"/"),n)}},{key:"getPhotos",value:function(){var e={};return this.employeeId&&!this.visionPersonId?e.employeeId=this.employeeId:this.visionPersonId?e.vision_person_id=this.visionPersonId:this.personId&&(e.personId=this.personId),this.request({requestPath:"get_photos",requestBody:r(r({},e),{},{masterAlbum:this.masterAlbum})})}},{key:"addPhoto",value:function(e){return this.request({requestPath:"add_photo",requestBody:{employeeId:this.employeeId,image:e}})}},{key:"deletePhoto",value:function(e){return this.request({requestPath:"delete_photo",requestBody:{photo_id:e}})}},{key:"updatePhoto",value:function(e){return this.request({requestPath:"update_photo",requestBody:{employeeId:this.employeeId,photo_id:e}})}},{key:"setAsMainPhoto",value:function(e){return this.request({requestPath:"set_main_photo",requestBody:{employeeId:this.employeeId,photoId:e}})}},{key:"draw",value:function(){var e=this,t=this.rootElement;t.innerHTML='\n      <div class="vision-photo-gallery vision-photo-gallery--message" data-message="Загрузка...">\n        <input type="file" class="vision-photo-gallery__file-field" tabindex="-1">\n        <div class="vision-photo-gallery__item vision-photo-gallery__item--main">\n          <div class="vg-main-photo"></div>\n        </div>\n        <div class="vision-photo-gallery__item">\n          <div class="vg-gallery"></div>\n        </div>\n      </div>\n    ';var o=document.querySelector(".vision-photo-gallery"),n=t.querySelector(".vg-main-photo"),r=t.querySelector(".vg-gallery"),i=this.controls.upload;this.getPhotos().then((function(t){if(n.innerHTML=e.createPhotoElement({main:!0,empty:!0,photoId:null}),i&&(r.innerHTML=e.createPhotoElement({main:!1,empty:!0,photoId:null})),t.ok)return t.json();n.innerHTML=e.createNoPhotoElement(),o.classList.remove("vision-photo-gallery--message"),e.initEvents()}),(function(t){e.handleError({message:t}),e.initEvents()})).then((function(t){if(!t||!t.length)return n.innerHTML=e.createNoPhotoElement(),r.parentElement.classList.add("hidden"),void o.classList.remove("vision-photo-gallery--message");var s=t.find((function(e){return e.main})),a=t.filter((function(e){return!e.main}));if(s?n.innerHTML=e.createPhotoElement(s):n.parentElement.classList.add("hidden"),a.length){var u="";a.forEach((function(t){return u+=e.createPhotoElement(t)})),i&&(u+=e.createPhotoElement({main:!1,empty:!0,photoId:null})),r.innerHTML=u}else i||r.parentElement.classList.add("hidden");e.initEvents(),o.classList.remove("vision-photo-gallery--message")}),(function(t){e.handleError({message:t}),e.initEvents()})).catch((function(t){e.handleError({message:t}),e.initEvents()})),this.initEvents()}},{key:"createPhotoElement",value:function(t){var o=t.photoId,n=t.main,r=t.empty,i=t.path,s=t.avatarUrl,a=this.controls,u=a.disableAll,l=a.upload,c=a.update,d=a.remove,h="",p="",f="",v="";return!s&&i&&(f='style="background-image: url('.concat(i,')"')),s&&(f='style="background-image: url('.concat(s,')"')),n?(v='data-main="'.concat(n,'"'),r?(p="vg-photo vg-photo--main",h=e.getPhotoButtons({upload:l})):(p="vg-photo vg-photo--main",h=e.getPhotoButtons({remove:d}))):r?(p="vg-gallery__item vg-photo vg-photo--upload",h=e.getPhotoButtons({uploadIcon:l})):(p="vg-gallery__item vg-photo",h=e.getPhotoButtons({update:c,remove:d})),'\n      <div class="'.concat(p,'"\n        ').concat(f,'\n        data-photo-id="').concat(o,'"\n        ').concat(v,">\n        ").concat(u?"":h,"\n        </div>\n      ")}},{key:"createNoPhotoElement",value:function(){return'\n      <div class="vg-photo vg-photo--main">\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="-256 -256 1024 1024">\n          <path fill="#4a5266"\n            d="M437 310.8c-28.4-28.4-62.2-49.2-99.1-61.7 34.1-25.2 56.2-65.6 56.2-111.1C394.1 61.9 332.1 0 256 0S117.9 61.9 117.9 138.1c0 45.5 22.1 85.9 56.2 111.1 -36.9 12.4-70.8 33.3-99.1 61.7C26.6 359.2 0 423.5 0 491.8 0 503 9 512 20.2 512h471.7c11.1 0 20.2-9 20.2-20.2C512 423.5 485.4 359.2 437 310.8zM158.2 138.1c0-53.9 43.9-97.8 97.8-97.8 53.9 0 97.8 43.9 97.8 97.8 0 53.9-43.9 97.8-97.8 97.8C202.1 235.8 158.2 192 158.2 138.1zM41.2 471.7C51.4 362.2 143.9 276.2 256 276.2s204.6 86 214.8 195.5H41.2z"/>\n        </svg>\n      </div>\n    '}},{key:"getPhotoButtons",value:function(e){if(e.disableAll)return"";var t={remove:'<button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>',upload:'<button class="vg-photo__button vg-button" data-action="upload-photo">Загрузить</button>',uploadIcon:'<button class="vg-photo__button vg-button vg-button--upload" data-action="upload-photo">&#43;</button>',update:'<button class="vg-photo__button vg-button vg-button--green" data-action="update-photo">Выбрать</button>'};return Object.keys(e).reduce((function(o,n){return e[n]&&(o+=t[n]),o}),"")}},{key:"initEvents",value:function(){var e=this;this.rootElement.querySelectorAll("button").forEach((function(t){t.addEventListener("click",e.router[t.dataset.action],!1)}))}}],(n=[{key:"errorFunction",get:function(){return e.errorFunction},set:function(t){t&&(e.errorFunction=t)}},{key:"employeeId",get:function(){return e.employeeId},set:function(t){t&&(e.employeeId=t)}},{key:"visionPersonId",get:function(){return e.visionPersonId},set:function(t){t&&(e.visionPersonId=t)}},{key:"personId",get:function(){return e.personId},set:function(t){t&&(e.personId=t)}},{key:"rootElement",get:function(){return e.rootElement}},{key:"token",get:function(){return e.token},set:function(t){t&&(e.token=t)}},{key:"controls",get:function(){return e.controls},set:function(t){e.controls=r(r({},e.controls),t)}},{key:"masterAlbum",get:function(){return e.masterAlbum},set:function(t){e.masterAlbum=t}}])&&i(t.prototype,n),s&&i(t,s),e}();return s(a,"employeeId",null),s(a,"visionPersonId",null),s(a,"rootElement",null),s(a,"token",null),s(a,"controls",{disableAll:!1,update:!0,upload:!0,remove:!0}),s(a,"masterAlbum",!0),s(a,"errorFunction",null),s(a,"router",{"upload-photo":function(e){var t=a.rootElement.querySelector('input[type="file"]');t.addEventListener("change",a.router["file-input-changed"]),t.click()},"file-input-changed":function(e){var t=e.target.files[0],o=new FileReader;o.readAsDataURL(t),o.onload=function(){a.addPhoto(o.result).then((function(e){if(e.ok)a.draw();else if(200!==e.status)return e.json()}),(function(e){a.handleError({message:e})}))},o.onerror=function(){a.handleError({message:o.error,blockingErrorMessage:"Ошибка загрузки фотографии (-ий): ".concat(o.error)})}},"remove-photo":function(e){var t=e.target.closest(".vg-photo").dataset.photoId;t&&a.deletePhoto(+t).then((function(e){if(e.ok)a.draw();else if(200!==e.status)return e.json()}),(function(e){a.handleError({message:e})}))},"update-photo":function(e){var t=e.target.closest(".vg-photo").dataset.photoId;t&&a.setAsMainPhoto(+t).then((function(e){if(e.ok)a.draw();else if(200!==e.status)return e.json()}),(function(e){a.handleError({message:e})}))}}),t.default}()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS8uL1Zpc2lvblBob3RvR2FsbGVyeS9pbmRleC5qcyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJ0aGlzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIlZpc2lvblBob3RvR2FsbGVyeSIsImVtcGxveWVlSWQiLCJ2aXNpb25QZXJzb25JZCIsInBlcnNvbklkIiwidG9rZW4iLCJjb250cm9scyIsIm1hc3RlckFsYnVtIiwiRXJyb3IiLCJyb290RWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJkcmF3IiwicGFyYW1zIiwibWVzc2FnZSIsImJsb2NraW5nRXJyb3JNZXNzYWdlIiwiZXJyb3JGdW5jdGlvbiIsIm1lc3NhZ2VTdHJpbmciLCJmYXVsdHN0cmluZyIsImtleXMiLCJyZXZlcnNlIiwiZm9yRWFjaCIsImVycm9yTWVzc2FnZSIsImxlbmd0aCIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb25zb2xlIiwibG9nIiwicmVxdWVzdFBhdGgiLCJyZXF1ZXN0Qm9keSIsInJlcXVlc3REZWZhdWx0cyIsIm1ldGhvZCIsIm1vZGUiLCJjcmVkZW50aWFscyIsImhlYWRlcnMiLCJib2R5IiwiZmV0Y2giLCJlbXBsb3llZSIsInZpc2lvbl9wZXJzb25faWQiLCJyZXF1ZXN0IiwiaW1hZ2UiLCJwaG90b0lkIiwicGhvdG9faWQiLCJpbm5lckhUTUwiLCJnYWxsZXJ5Q29udGFpbmVyIiwicXVlcnlTZWxlY3RvciIsIm1haW5QaG90b0NvbnRhaW5lciIsImdhbGxlcnkiLCJ1cGxvYWQiLCJnZXRQaG90b3MiLCJ0aGVuIiwicmVzcG9uc2UiLCJjcmVhdGVQaG90b0VsZW1lbnQiLCJtYWluIiwiZW1wdHkiLCJvayIsImpzb24iLCJjcmVhdGVOb1Bob3RvRWxlbWVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImluaXRFdmVudHMiLCJlcnJvciIsImhhbmRsZUVycm9yIiwicmVzcG9uc2VKc29uIiwicGFyZW50RWxlbWVudCIsImFkZCIsIm1haW5QaG90b0RhdGEiLCJmaW5kIiwiZ2FsbGVyeVBob3Rvc0RhdGEiLCJmaWx0ZXIiLCJnYWxsZXJ5UGhvdG9zSHRtbCIsInBob3RvRGF0YSIsImNhdGNoIiwicGF0aCIsImF2YXRhclVybCIsImRpc2FibGVBbGwiLCJ1cGRhdGUiLCJidXR0b25zIiwiZWxlbWVudENsYXNzZXMiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJtYWluQXR0cmlidXRlIiwiZ2V0UGhvdG9CdXR0b25zIiwidXBsb2FkSWNvbiIsInJlZHVjZSIsImJ1dHRvbnNTdHJpbmciLCJxdWVyeVNlbGVjdG9yQWxsIiwiYnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJvdXRlciIsImRhdGFzZXQiLCJhY3Rpb24iLCJ2YWx1ZSIsImUiLCJmaWxlSW5wdXQiLCJjbGljayIsImZpbGUiLCJ0YXJnZXQiLCJmaWxlcyIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJyZWFkQXNEYXRhVVJMIiwib25sb2FkIiwiYWRkUGhvdG8iLCJyZXN1bHQiLCJzdGF0dXMiLCJvbmVycm9yIiwiY2xvc2Vz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M0IsU0FBQUMsR0FDRSxHQUFJQSxFQUFTSSxHQTVtQkp0RCxFQTZtQkZXLFlBQ0EsR0FBd0IsTUFBcEJ1QyxFQUFTcUQsT0FDbEIsT0FBT3JELEVBQVNLLFVBR3BCLFNBQUFLLEdBbG5CVzVELEVBbW5CSjZELFlBQVksQ0FDZmhELFFBQVMrQyxRQU1qQnFDLEVBQU9PLFFBQVUsV0ExbkJGeEcsRUEybkJSNkQsWUFBWSxDQUNmaEQsUUFBU29GLEVBQU9yQyxNQUNoQjlDLHFCQUFzQixxQ0FBRixPQUF1Q21GLEVBQU9yQyxXQVF4RSxlQUFnQixTQUFBK0IsR0FDZCxJQUNRbkQsRUFEYW1ELEVBQUVJLE9BQU9VLFFBQVEsYUFDTGpCLFFBQXpCaEQsUUFFRkEsR0F6b0JTeEMsRUEwb0JSMEcsYUFBYWxFLEdBQVNTLE1BQ3pCLFNBQUFDLEdBQ0UsR0FBSUEsRUFBU0ksR0E1b0JKdEQsRUE2b0JGVyxZQUNBLEdBQXdCLE1BQXBCdUMsRUFBU3FELE9BQ2xCLE9BQU9yRCxFQUFTSyxVQUdwQixTQUFBSyxHQWxwQlc1RCxFQW1wQko2RCxZQUFZLENBQ2ZoRCxRQUFTK0MsUUFVbkIsZUFBZ0IsU0FBQStCLEdBQ2QsSUFDUW5ELEVBRGFtRCxFQUFFSSxPQUFPVSxRQUFRLGFBQ0xqQixRQUF6QmhELFFBRUZBLEdBbHFCU3hDLEVBbXFCUjJHLGdCQUFnQm5FLEdBQVNTLE1BQzVCLFNBQUFDLEdBQ0UsR0FBSUEsRUFBU0ksR0FycUJKdEQsRUFzcUJGVyxZQUNBLEdBQXdCLE1BQXBCdUMsRUFBU3FELE9BQ2xCLE9BQU9yRCxFQUFTSyxVQUdwQixTQUFBSyxHQTNxQlc1RCxFQTRxQko2RCxZQUFZLENBQ2ZoRCxRQUFTK0MsVSIsImZpbGUiOiJWaXNpb25QaG90b0dhbGxlcnkuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJWaXNpb25QaG90b0dhbGxlcnlcIl0gPSBmYWN0b3J5KCk7XG5cdGVsc2Vcblx0XHRyb290W1wiVmlzaW9uUGhvdG9HYWxsZXJ5XCJdID0gZmFjdG9yeSgpO1xufSkodGhpcywgZnVuY3Rpb24oKSB7XG5yZXR1cm4gIiwiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIGRlZmluaXRpb24pIHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqLCBwcm9wKSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsgfSIsIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgXCIuL2FwcC5zY3NzXCI7XG5cbi8qKlxuICog0JrQu9Cw0YHRgSDQs9Cw0LvQtdGA0LXQuC5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmlzaW9uUGhvdG9HYWxsZXJ5IHtcbiAgc3RhdGljIGVtcGxveWVlSWQgPSBudWxsO1xuICBzdGF0aWMgdmlzaW9uUGVyc29uSWQgPSBudWxsO1xuICBzdGF0aWMgcm9vdEVsZW1lbnQgPSBudWxsO1xuICBzdGF0aWMgdG9rZW4gPSBudWxsO1xuICBzdGF0aWMgY29udHJvbHMgPSB7XG4gICAgZGlzYWJsZUFsbDogZmFsc2UsXG4gICAgdXBkYXRlOiB0cnVlLFxuICAgIHVwbG9hZDogdHJ1ZSxcbiAgICByZW1vdmU6IHRydWVcbiAgfTtcbiAgc3RhdGljIG1hc3RlckFsYnVtID0gdHJ1ZTtcblxuICAvKipcbiAgICog0JrQvtC90YHRgtGA0YPQutGC0L7RgCDRjdC60LfQtdC80L/Qu9GP0YDQsCDQutC70LDRgdGB0LAg0LPQsNC70LXRgNC10LguXG4gICAqIEBwYXJhbSByb290IHtzdHJpbmd9IElEINC60L7RgNC90LXQstC+0LPQviDRjdC70LXQvNC10L3RgtCwLCDQutGD0LTQsCDQsdGD0LTQtdGCINGA0LXQvdC00LXRgNC40YLRjNGB0Y8g0LPQsNC70LXRgNC10Y8uXG4gICAqIEBwYXJhbSBlbXBsb3llZUlkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIHZpc2lvblBlcnNvbklkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICogQHBhcmFtIHBlcnNvbklkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICogQHBhcmFtIHRva2VuIHtzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8uXG4gICAqIEBwYXJhbSBjb250cm9scyB7b2JqZWN0fSDQndCw0YHRgtGA0L7QudC60LAg0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDRjdC70LXQvNC10L3RgtC+0LIg0YPQv9GA0LDQstC70LXQvdC40Y8uXG4gICAqIEBwYXJhbSBjb250cm9scy5kaXNhYmxlQWxsIHtib29sZWFufSDQntGC0LrQu9GO0YfQuNGC0Ywg0LLRgdC1INGN0LvQtdC80LXQvdGC0Ysg0YPQv9GA0LDQstC70LXQvdC40Y8uXG4gICAqIEBwYXJhbSBjb250cm9scy51cGRhdGUge2Jvb2xlYW59INCe0YLQvtCx0YDQsNC20LXQvdC40LUg0LrQvdC+0L/QutC4INC+0LHQvdC+0LLQu9C10L3QuNGPINGE0L7RgtC+0LPRgNCw0YTQuNC4ICjRg9GB0YLQsNC90L7QstC60LAg0L7RgdC90L7QstC90L7QuSkuXG4gICAqIEBwYXJhbSBjb250cm9scy51cGxvYWQge2Jvb2xlYW59INCe0YLQvtCx0YDQsNC20LXQvdC40LUg0LrQvdC+0L/QutC4INC30LDQs9GA0YPQt9C60Lgg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBjb250cm9scy5yZW1vdmUge2Jvb2xlYW59INCe0YLQvtCx0YDQsNC20LXQvdC40LUg0LrQvdC+0L/QutC4INGD0LTQsNC70LXQvdC40Y8g0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBtYXN0ZXJBbGJ1bSB7Ym9vbGVhbn0g0JfQsNCz0YDRg9C30LrQsCDRhNC+0YLQvtCz0YDQsNGE0LjQuSDQuNC3INC80LDRgdGC0LXRgC3QsNC70LHQvtC80LAuXG4gICAqL1xuICBjb25zdHJ1Y3Rvcih7XG4gICAgcm9vdCxcbiAgICBlbXBsb3llZUlkLFxuICAgIHZpc2lvblBlcnNvbklkLFxuICAgIHBlcnNvbklkLFxuICAgIHRva2VuLFxuICAgIGNvbnRyb2xzLFxuICAgIG1hc3RlckFsYnVtID0gdHJ1ZVxuICB9KSB7XG4gICAgaWYgKCFyb290KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCLQndC1INGD0LrQsNC30LDQvSBJRCDQutC+0YDQvdC10LLQvtCz0L4g0Y3Qu9C10LzQtdC90YLQsCDQtNC70Y8g0LPQsNC70LXRgNC10LghXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IHJvb3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocm9vdCk7XG5cbiAgICBpZiAoISFyb290RWxlbWVudCkge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LnJvb3RFbGVtZW50ID0gcm9vdEVsZW1lbnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcItCf0YDQvtCy0LXRgNGM0YLQtSDRg9C60LDQt9Cw0L3QvdGL0LkgSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAg0LTQu9GPINCz0LDQu9C10YDQtdC4IVwiKTtcbiAgICB9XG5cbiAgICBpZiAoIWVtcGxveWVlSWQgJiYgIXZpc2lvblBlcnNvbklkICYmICFwZXJzb25JZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwi0J3QtSDRg9C60LDQt9Cw0L0gSUQg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uXCIpO1xuICAgIH1cblxuICAgIHRoaXMuZW1wbG95ZWVJZCA9IGVtcGxveWVlSWQ7XG4gICAgdGhpcy52aXNpb25QZXJzb25JZCA9IHZpc2lvblBlcnNvbklkO1xuICAgIHRoaXMucGVyc29uSWQgPSBwZXJzb25JZDtcbiAgICB0aGlzLnRva2VuID0gdG9rZW47XG4gICAgdGhpcy5jb250cm9scyA9IGNvbnRyb2xzO1xuICAgIHRoaXMubWFzdGVyQWxidW0gPSBtYXN0ZXJBbGJ1bTtcblxuICAgIFZpc2lvblBob3RvR2FsbGVyeS5kcmF3KCk7XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LDQtdC80YvQuSDQvNC10YLQvtC0INC00LvRjyDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICogQHR5cGUge251bGx8RnVuY3Rpb259INCk0YPQvdC60YbQuNGPINC+0LHRgNCw0LHQvtGC0YfQuNC6INC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKi9cbiAgc3RhdGljIGVycm9yRnVuY3Rpb24gPSBudWxsO1xuICAvKipcbiAgICog0J/QvtC70YPRh9C10L3QuNC1INC80LXRgtC+0LTQsCDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqIEB0eXBlIHtudWxsfEZ1bmN0aW9ufSDQpNGD0L3QutGG0LjRjyDQvtCx0YDQsNCx0L7RgtGH0LjQuiDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICovXG4gIGdldCBlcnJvckZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZXJyb3JGdW5jdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDQvNC10YLQvtC00LAg0LTQu9GPINC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKiBAcGFyYW0gZXJyb3JGdW5jdGlvbiB7bnVsbHxGdW5jdGlvbn0g0KTRg9C90LrRhtC40Y8g0L7QsdGA0LDQsdC+0YLRh9C40Log0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqL1xuICBzZXQgZXJyb3JGdW5jdGlvbihlcnJvckZ1bmN0aW9uKSB7XG4gICAgaWYgKGVycm9yRnVuY3Rpb24pIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS5lcnJvckZ1bmN0aW9uID0gZXJyb3JGdW5jdGlvbjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J7QsdC90L7QstC70LXQvdC40LUg0L/QsNGA0LDQvNC10YLRgNC+0LIg0LPQsNC70LXRgNC10LguXG4gICAqIEBwYXJhbSBlbXBsb3llZUlkIHtudW1iZXJ8bnVtYmVyfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIHRva2VuIHtzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICovXG4gIHN0YXRpYyB1cGRhdGUoeyBlbXBsb3llZUlkLCB0b2tlbiB9KSB7XG4gICAgdGhpcy5lbXBsb3llZUlkID0gZW1wbG95ZWVJZDtcbiAgICB0aGlzLnRva2VuID0gdG9rZW47XG5cbiAgICB0aGlzLmRyYXcoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LjRgtGMIElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICovXG4gIGdldCBlbXBsb3llZUlkKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZW1wbG95ZWVJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDRjdC60LfQtdC80L/Qu9GP0YDRgyDQs9Cw0LvQtdGA0LXQuCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIGVtcGxveWVlSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKi9cbiAgc2V0IGVtcGxveWVlSWQoZW1wbG95ZWVJZCkge1xuICAgIGlmIChlbXBsb3llZUlkKSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkuZW1wbG95ZWVJZCA9IGVtcGxveWVlSWQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0YwgSUQg0YHQvtGC0YDRg9C00L3QuNC60LAg0LDRg9GC0YHQvtGA0YHQtdGA0LAuXG4gICAqIEByZXR1cm4ge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKi9cbiAgZ2V0IHZpc2lvblBlcnNvbklkKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkudmlzaW9uUGVyc29uSWQ7XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LXQvdC40LUg0Y3QutC30LXQvNC/0LvRj9GA0YMg0LPQsNC70LXRgNC10LggSUQg0YHQvtGC0YDRg9C00L3QuNC60LAg0LDRg9GC0YHQvtGA0YHQtdGA0LAuXG4gICAqIEBwYXJhbSB2aXNpb25QZXJzb25JZCB7bnVtYmVyfHN0cmluZ30gSUQg0YHQvtGC0YDRg9C00L3QuNC60LAg0LDRg9GC0YHQvtGA0YHQtdGA0LAuXG4gICAqL1xuICBzZXQgdmlzaW9uUGVyc29uSWQodmlzaW9uUGVyc29uSWQpIHtcbiAgICBpZiAodmlzaW9uUGVyc29uSWQpIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS52aXNpb25QZXJzb25JZCA9IHZpc2lvblBlcnNvbklkO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LjRgtGMIElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICovXG4gIGdldCBwZXJzb25JZCgpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LnBlcnNvbklkO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C10L3QuNC1INGN0LrQt9C10LzQv9C70Y/RgNGDINCz0LDQu9C10YDQtdC4IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKiBAcGFyYW0gcGVyc29uSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKi9cbiAgc2V0IHBlcnNvbklkKHBlcnNvbklkKSB7XG4gICAgaWYgKHBlcnNvbklkKSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkucGVyc29uSWQgPSBwZXJzb25JZDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0JrQvtGA0L3QtdCy0L7QuSDRjdC70LXQvNC10L3Rgiwg0LIg0LrQvtGC0L7RgNGL0Lkg0LHRg9C00LXRgiDRgNC10L3QtNC10YDQuNGC0YzRgdGPINCz0LDQu9C10YDQtdGPLlxuICAgKiBAcmV0dXJuIHtudWxsfEVsZW1lbnR9INCa0L7RgNC90LXQstC+0Lkg0Y3Qu9C10LzQtdC90YIg0LTQu9GPINGA0LXQvdC00LXRgNCwLlxuICAgKi9cbiAgZ2V0IHJvb3RFbGVtZW50KCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkucm9vdEVsZW1lbnQ7XG4gIH1cblxuICAvKipcbiAgICog0J/QvtC70YPRh9C40YLRjCBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICogQHJldHVybiB7bnVsbHxzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC40Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPLlxuICAgKi9cbiAgZ2V0IHRva2VuKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkudG9rZW47XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LjRgtGMIENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC40Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPLlxuICAgKiBAcGFyYW0gdG9rZW4ge3N0cmluZ30gQ1NSRi3RgtC+0LrQtdC9INGB0LXRgdGB0LjQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8uXG4gICAqL1xuICBzZXQgdG9rZW4odG9rZW4pIHtcbiAgICBpZiAodG9rZW4pIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS50b2tlbiA9IHRva2VuO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LjRgtGMINC30L3QsNGH0LXQvdC40LUg0YHQvtGB0YLQvtGP0L3QuNGPINC60L7QvdGC0YDQvtC70L7Qsi5cbiAgICogQHJldHVybiB7Ym9vbGVhbn0g0KHQvtGB0YLQvtGP0L3QuNC1INC60L7QvdGC0YDQvtC70L7Qsi5cbiAgICovXG4gIGdldCBjb250cm9scygpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LmNvbnRyb2xzO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C40YLRjCDQt9C90LDRh9C10L3QuNC1INGB0L7RgdGC0L7Rj9C90LjRjyDQutC+0L3RgtGA0L7Qu9C+0LIuXG4gICAqIEBwYXJhbSB2YWx1ZSB7Ym9vbGVhbn0g0JLQutC70Y7Rh9C40YLRjC/QvtGC0LrQu9GO0YfQuNGC0Ywg0LrQvtC90YLRgNC+0LvRiy5cbiAgICovXG4gIHNldCBjb250cm9scyh2YWx1ZSkge1xuICAgIFZpc2lvblBob3RvR2FsbGVyeS5jb250cm9scyA9IHtcbiAgICAgIC4uLlZpc2lvblBob3RvR2FsbGVyeS5jb250cm9scyxcbiAgICAgIC4uLnZhbHVlXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LjRgtGMINGE0LvQsNCzINC30LDQs9GA0YPQt9C60Lgg0YTQvtGC0L7Qs9GA0LDRhNC40Lkg0LjQtyDQvNCw0YHRgtC10YAt0LDQu9GM0LHQvtC80LAuXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59INCh0L7RgdGC0L7Rj9C90LjQtSDRhNC70LDQs9CwINC30LDQs9GA0YPQt9C60Lgg0YTQvtGC0L7Qs9GA0LDRhNC40Lkg0LjQtyDQvNCw0YHRgtC10YAt0LDQu9GM0LHQvtC80LAuXG4gICAqL1xuICBnZXQgbWFzdGVyQWxidW0oKSB7XG4gICAgcmV0dXJuIFZpc2lvblBob3RvR2FsbGVyeS5tYXN0ZXJBbGJ1bTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQuNGC0Ywg0YTQu9Cw0LMg0LfQsNCz0YDRg9C30LrQuCDRhNC+0YLQvtCz0YDQsNGE0LjQuSDQuNC3INC80LDRgdGC0LXRgC3QsNC70YzQsdC+0LzQsC5cbiAgICogQHBhcmFtIHZhbHVlIHtib29sZWFufSDQktC60LvRjtGH0LjRgtGML9Cy0YvQutC70Y7Rh9C40YLRjCDQt9Cw0LPRgNGD0LfQutGDINC40Lcg0LzQsNGB0YLQtdGALdCw0LvRjNCx0L7QvNCwLlxuICAgKi9cbiAgc2V0IG1hc3RlckFsYnVtKHZhbHVlKSB7XG4gICAgVmlzaW9uUGhvdG9HYWxsZXJ5Lm1hc3RlckFsYnVtID0gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICog0J7QsdGA0LDQsdC+0YLRh9C40Log0L7RiNC40LHQvtC6LlxuICAgKiBAcGFyYW0gcGFyYW1zLm1lc3NhZ2Uge3N0cmluZ30g0KHQvtC+0LHRidC10L3QuNC1INC+0LEg0L7RiNC40LHQutC1LlxuICAgKiBAcGFyYW0gcGFyYW1zLmJsb2NraW5nRXJyb3JNZXNzYWdlIHtzdHJpbmd9INCR0LvQvtC60LjRgNGD0Y7RidC10LUg0L/QvtGC0L7QuiDRgdC+0L7QsdGJ0LXQvdC40LUg0L7QsSDQvtGI0LjQsdC60LUuXG4gICAqL1xuICBzdGF0aWMgaGFuZGxlRXJyb3IocGFyYW1zKSB7XG4gICAgY29uc3QgeyBtZXNzYWdlLCBibG9ja2luZ0Vycm9yTWVzc2FnZSB9ID0gcGFyYW1zO1xuXG4gICAgaWYgKHRoaXMuZXJyb3JGdW5jdGlvbikge1xuICAgICAgbGV0IG1lc3NhZ2VTdHJpbmcgPSBcIlwiO1xuXG4gICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgaWYgKG1lc3NhZ2UuZmF1bHRzdHJpbmcpIHtcbiAgICAgICAgICBtZXNzYWdlU3RyaW5nID0gbWVzc2FnZS5mYXVsdHN0cmluZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBPYmplY3Qua2V5cyhtZXNzYWdlKVxuICAgICAgICAgICAgLnJldmVyc2UoKVxuICAgICAgICAgICAgLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgbWVzc2FnZVN0cmluZyArPSBgJHttZXNzYWdlW2tleV19PGJyLz5gO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gbWVzc2FnZVN0cmluZy5sZW5ndGhcbiAgICAgICAgPyBtZXNzYWdlU3RyaW5nXG4gICAgICAgIDogSlNPTi5zdHJpbmdpZnkobWVzc2FnZSk7XG5cbiAgICAgIHRoaXMuZXJyb3JGdW5jdGlvbihlcnJvck1lc3NhZ2UsIFwi0J7RiNC40LHQutCwXCIpO1xuICAgIH0gZWxzZSBpZiAoYmxvY2tpbmdFcnJvck1lc3NhZ2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihibG9ja2luZ0Vycm9yTWVzc2FnZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQntCx0ZHRgNGC0LrQsCDQtNC70Y8g0LfQsNC/0YDQvtGB0L7QsiDQuiBBUEkuXG4gICAqIEBwYXJhbSByZXF1ZXN0UGF0aCB7c3RyaW5nfSDQndCw0LfQstCw0L3QuNC1INC80LXRgtC+0LTQsCBBUEkuXG4gICAqIEBwYXJhbSByZXF1ZXN0Qm9keSB7b2JqZWN0fSDQn9Cw0YDQsNC80LXRgtGA0Ysg0LfQsNC/0YDQvtGB0LAuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIHJlcXVlc3QoeyByZXF1ZXN0UGF0aCwgcmVxdWVzdEJvZHkgfSkge1xuICAgIGNvbnN0IHJlcXVlc3REZWZhdWx0cyA9IHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBtb2RlOiBcInNhbWUtb3JpZ2luXCIsXG4gICAgICBjcmVkZW50aWFsczogXCJzYW1lLW9yaWdpblwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgXCJYLUNTUkZUb2tlblwiOiB0aGlzLnRva2VuXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpXG4gICAgfTtcblxuICAgIHJldHVybiBmZXRjaChgL2FwaS92Mi92aXNpb24vJHtyZXF1ZXN0UGF0aH0vYCwgcmVxdWVzdERlZmF1bHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQktGL0LPRgNGD0LfQutCwINCy0YHQtdGFINGE0L7RgtC+0LPRgNCw0YTQuNC5INGBINC/0L7RgNGC0LDQu9CwIFZpc2lvbi5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0YEg0YDQtdC30YPQu9GM0YLQsNGC0L7QvCDQstGL0L/QvtC70L3QtdC90LjRjyDQt9Cw0L/RgNC+0YHQsC5cbiAgICovXG4gIHN0YXRpYyBnZXRQaG90b3MoKSB7XG4gICAgY29uc3QgZW1wbG95ZWUgPSB7fTtcblxuICAgIGlmICh0aGlzLmVtcGxveWVlSWQgJiYgIXRoaXMudmlzaW9uUGVyc29uSWQpIHtcbiAgICAgIGVtcGxveWVlLmVtcGxveWVlSWQgPSB0aGlzLmVtcGxveWVlSWQ7XG4gICAgfSBlbHNlIGlmICh0aGlzLnZpc2lvblBlcnNvbklkKSB7XG4gICAgICBlbXBsb3llZS52aXNpb25fcGVyc29uX2lkID0gdGhpcy52aXNpb25QZXJzb25JZDtcbiAgICB9IGVsc2UgaWYgKHRoaXMucGVyc29uSWQpIHtcbiAgICAgIGVtcGxveWVlLnBlcnNvbklkID0gdGhpcy5wZXJzb25JZDtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiBcImdldF9waG90b3NcIixcbiAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgIC4uLmVtcGxveWVlLFxuICAgICAgICBtYXN0ZXJBbGJ1bTogdGhpcy5tYXN0ZXJBbGJ1bVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCX0LDQv9GA0L7RgSDQvdCwINC00L7QsdCw0LLQu9C10L3QuNC1ICjQt9Cw0LPRgNGD0LfQutGDKSDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHBhcmFtIGltYWdlIHtCdWZmZXJFbmNvZGluZ30g0KTQvtGC0L7Qs9GA0LDRhNC40Lgg0LIg0YTQvtGA0LzQsNGC0LUgQmFzZTY0LlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIGFkZFBob3RvKGltYWdlKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh7XG4gICAgICByZXF1ZXN0UGF0aDogXCJhZGRfcGhvdG9cIixcbiAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgIGVtcGxveWVlSWQ6IHRoaXMuZW1wbG95ZWVJZCxcbiAgICAgICAgaW1hZ2VcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDRg9C00LDQu9C10L3QuNC1INGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gcGhvdG9JZCB7TnVtYmVyfSBJRCDRhNC+0YLQvtCz0YDQsNGE0LjQuCDQvdCwINC/0L7RgNGC0LDQu9C1IFZpc2lvbi5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0YEg0YDQtdC30YPQu9GM0YLQsNGC0L7QvCDQstGL0L/QvtC70L3QtdC90LjRjyDQt9Cw0L/RgNC+0YHQsC5cbiAgICovXG4gIHN0YXRpYyBkZWxldGVQaG90byhwaG90b0lkKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh7XG4gICAgICByZXF1ZXN0UGF0aDogXCJkZWxldGVfcGhvdG9cIixcbiAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgIHBob3RvX2lkOiBwaG90b0lkXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0JfQsNC/0YDQvtGBINC90LAg0L7QsdC90L7QstC70LXQvdC40LUg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwaG90b0lkIHtOdW1iZXJ9IElEINGE0L7RgtC+0LPRgNCw0YTQuNC4INC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIHVwZGF0ZVBob3RvKHBob3RvSWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiBcInVwZGF0ZV9waG90b1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgZW1wbG95ZWVJZDogdGhpcy5lbXBsb3llZUlkLFxuICAgICAgICBwaG90b19pZDogcGhvdG9JZFxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCX0LDQv9GA0L7RgSDQvdCwINGD0YHRgtCw0L3QvtCy0LrRgyDRhNC+0YLQvtCz0YDQsNGE0LjQuCDQutCw0Log0L7RgdC90L7QstC90L7QuSDQtNC70Y8g0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAqIEBwYXJhbSBwaG90b0lkIHtOdW1iZXJ9IElEINGE0L7RgtC+0LPRgNCw0YTQuNC4INC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIHNldEFzTWFpblBob3RvKHBob3RvSWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiBcInNldF9tYWluX3Bob3RvXCIsXG4gICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICBlbXBsb3llZUlkOiB0aGlzLmVtcGxveWVlSWQsXG4gICAgICAgIHBob3RvSWQ6IHBob3RvSWRcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQntGC0YDQuNGB0L7QstC60LAgRE9NINCz0LDQu9C10YDQtdC40LguXG4gICAqL1xuICBzdGF0aWMgZHJhdygpIHtcbiAgICBjb25zdCByb290RWxlbWVudCA9IHRoaXMucm9vdEVsZW1lbnQ7XG5cbiAgICByb290RWxlbWVudC5pbm5lckhUTUwgPSBgXG4gICAgICA8ZGl2IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnkgdmlzaW9uLXBob3RvLWdhbGxlcnktLW1lc3NhZ2VcIiBkYXRhLW1lc3NhZ2U9XCLQl9Cw0LPRgNGD0LfQutCwLi4uXCI+XG4gICAgICAgIDxpbnB1dCB0eXBlPVwiZmlsZVwiIGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX2ZpbGUtZmllbGRcIiB0YWJpbmRleD1cIi0xXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9faXRlbSB2aXNpb24tcGhvdG8tZ2FsbGVyeV9faXRlbS0tbWFpblwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2Zy1tYWluLXBob3RvXCI+PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX2l0ZW1cIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidmctZ2FsbGVyeVwiPjwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICBjb25zdCBnYWxsZXJ5Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi52aXNpb24tcGhvdG8tZ2FsbGVyeVwiKTtcbiAgICBjb25zdCBtYWluUGhvdG9Db250YWluZXIgPSByb290RWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnZnLW1haW4tcGhvdG9cIik7XG4gICAgY29uc3QgZ2FsbGVyeSA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmctZ2FsbGVyeVwiKTtcbiAgICBjb25zdCB7IHVwbG9hZCB9ID0gdGhpcy5jb250cm9scztcblxuICAgIHRoaXMuZ2V0UGhvdG9zKClcbiAgICAgIC50aGVuKFxuICAgICAgICByZXNwb25zZSA9PiB7XG4gICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHtcbiAgICAgICAgICAgIG1haW46IHRydWUsXG4gICAgICAgICAgICBlbXB0eTogdHJ1ZSxcbiAgICAgICAgICAgIHBob3RvSWQ6IG51bGxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmICh1cGxvYWQpIHtcbiAgICAgICAgICAgIGdhbGxlcnkuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQoe1xuICAgICAgICAgICAgICBtYWluOiBmYWxzZSxcbiAgICAgICAgICAgICAgZW1wdHk6IHRydWUsXG4gICAgICAgICAgICAgIHBob3RvSWQ6IG51bGxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMuY3JlYXRlTm9QaG90b0VsZW1lbnQoKTtcblxuICAgICAgICAgICAgZ2FsbGVyeUNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwidmlzaW9uLXBob3RvLWdhbGxlcnktLW1lc3NhZ2VcIik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLnRoZW4oXG4gICAgICAgIHJlc3BvbnNlSnNvbiA9PiB7XG4gICAgICAgICAgaWYgKCFyZXNwb25zZUpzb24gfHwgIXJlc3BvbnNlSnNvbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZU5vUGhvdG9FbGVtZW50KCk7XG4gICAgICAgICAgICBnYWxsZXJ5LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGdhbGxlcnlDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcInZpc2lvbi1waG90by1nYWxsZXJ5LS1tZXNzYWdlXCIpO1xuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgbWFpblBob3RvRGF0YSA9IHJlc3BvbnNlSnNvbi5maW5kKCh7IG1haW4gfSkgPT4gbWFpbik7XG4gICAgICAgICAgY29uc3QgZ2FsbGVyeVBob3Rvc0RhdGEgPSByZXNwb25zZUpzb24uZmlsdGVyKCh7IG1haW4gfSkgPT4gIW1haW4pO1xuXG4gICAgICAgICAgaWYgKCEhbWFpblBob3RvRGF0YSkge1xuICAgICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KFxuICAgICAgICAgICAgICBtYWluUGhvdG9EYXRhXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtYWluUGhvdG9Db250YWluZXIucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChnYWxsZXJ5UGhvdG9zRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCBnYWxsZXJ5UGhvdG9zSHRtbCA9IFwiXCI7XG5cbiAgICAgICAgICAgIGdhbGxlcnlQaG90b3NEYXRhLmZvckVhY2goXG4gICAgICAgICAgICAgIHBob3RvRGF0YSA9PlxuICAgICAgICAgICAgICAgIChnYWxsZXJ5UGhvdG9zSHRtbCArPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudChwaG90b0RhdGEpKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKHVwbG9hZCkge1xuICAgICAgICAgICAgICBnYWxsZXJ5UGhvdG9zSHRtbCArPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudCh7XG4gICAgICAgICAgICAgICAgbWFpbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW1wdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgcGhvdG9JZDogbnVsbFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZ2FsbGVyeS5pbm5lckhUTUwgPSBnYWxsZXJ5UGhvdG9zSHRtbDtcbiAgICAgICAgICB9IGVsc2UgaWYgKCF1cGxvYWQpIHtcbiAgICAgICAgICAgIGdhbGxlcnkucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgICAgIGdhbGxlcnlDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcInZpc2lvbi1waG90by1nYWxsZXJ5LS1tZXNzYWdlXCIpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7XG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgICAgIH0pO1xuXG4gICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gIH1cblxuICAvKipcbiAgICog0KPQvdC40LLQtdGA0YHQsNC70YzQvdGL0Lkg0LzQtdGC0L7QtCDQtNC70Y8g0YHQvtC30LTQsNC90LjRjyDRjdC70LXQvNC10L3RgtCwINGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gcGFyYW1zLnBob3RvSWQge251bWJlcn0gSUQg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0L3QsCDQv9C+0YDRgtCw0LvQtSBWaXNpb24uXG4gICAqIEBwYXJhbSBwYXJhbXMubWFpbiB7Ym9vbGVhbn0gINCk0LvQsNCzINC+0YHQvdC+0LLQvdC+0LPQviDRhNC+0YLQvi5cbiAgICogQHBhcmFtIHBhcmFtcy5lbXB0eSB7Ym9vbGVhbn0g0KTQu9Cw0LMgXCLQv9GD0YHRgtC+0LPQvlwiINGE0L7RgtC+LCDQuNGB0L/QvtC70YzQt9GD0LXRgtGB0Y8g0LTQu9GPINC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0LrQvdC+0L/QutC4INC30LDQs9GA0YPQt9C60LguXG4gICAqIEBwYXJhbSBwYXJhbXMucGF0aCB7c3RyaW5nfSDQn9GD0YLRjCDQuiDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHBhcmFtIHBhcmFtcy5hdmF0YXJVcmwge3N0cmluZ30g0J/Rg9GC0Ywg0Log0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9INCt0LvQtdC80LXQvdGCINGE0L7RgtC+0LPRgNCw0YTQuNC4INCyINCy0LjQtNC1INGB0YLRgNC+0LrQuC5cbiAgICovXG4gIHN0YXRpYyBjcmVhdGVQaG90b0VsZW1lbnQocGFyYW1zKSB7XG4gICAgY29uc3QgeyBwaG90b0lkLCBtYWluLCBlbXB0eSwgcGF0aCwgYXZhdGFyVXJsIH0gPSBwYXJhbXM7XG4gICAgY29uc3QgeyBkaXNhYmxlQWxsLCB1cGxvYWQsIHVwZGF0ZSwgcmVtb3ZlIH0gPSB0aGlzLmNvbnRyb2xzO1xuICAgIGxldCBidXR0b25zID0gXCJcIjtcbiAgICBsZXQgZWxlbWVudENsYXNzZXMgPSBcIlwiO1xuICAgIGxldCBiYWNrZ3JvdW5kSW1hZ2UgPSBcIlwiO1xuICAgIGxldCBtYWluQXR0cmlidXRlID0gXCJcIjtcblxuICAgIGlmICghYXZhdGFyVXJsICYmIHBhdGgpIHtcbiAgICAgIGJhY2tncm91bmRJbWFnZSA9IGBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgke3BhdGh9KVwiYDtcbiAgICB9XG5cbiAgICBpZiAoYXZhdGFyVXJsKSB7XG4gICAgICBiYWNrZ3JvdW5kSW1hZ2UgPSBgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHthdmF0YXJVcmx9KVwiYDtcbiAgICB9XG5cbiAgICBpZiAobWFpbikge1xuICAgICAgbWFpbkF0dHJpYnV0ZSA9IGBkYXRhLW1haW49XCIke21haW59XCJgO1xuXG4gICAgICBpZiAoZW1wdHkpIHtcbiAgICAgICAgZWxlbWVudENsYXNzZXMgPSBcInZnLXBob3RvIHZnLXBob3RvLS1tYWluXCI7XG4gICAgICAgIGJ1dHRvbnMgPSBWaXNpb25QaG90b0dhbGxlcnkuZ2V0UGhvdG9CdXR0b25zKHtcbiAgICAgICAgICB1cGxvYWRcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50Q2xhc3NlcyA9IFwidmctcGhvdG8gdmctcGhvdG8tLW1haW5cIjtcbiAgICAgICAgYnV0dG9ucyA9IFZpc2lvblBob3RvR2FsbGVyeS5nZXRQaG90b0J1dHRvbnMoe1xuICAgICAgICAgIHJlbW92ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGVtcHR5KSB7XG4gICAgICAgIGVsZW1lbnRDbGFzc2VzID0gXCJ2Zy1nYWxsZXJ5X19pdGVtIHZnLXBob3RvIHZnLXBob3RvLS11cGxvYWRcIjtcbiAgICAgICAgYnV0dG9ucyA9IFZpc2lvblBob3RvR2FsbGVyeS5nZXRQaG90b0J1dHRvbnMoe1xuICAgICAgICAgIHVwbG9hZEljb246IHVwbG9hZFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnRDbGFzc2VzID0gXCJ2Zy1nYWxsZXJ5X19pdGVtIHZnLXBob3RvXCI7XG4gICAgICAgIGJ1dHRvbnMgPSBWaXNpb25QaG90b0dhbGxlcnkuZ2V0UGhvdG9CdXR0b25zKHtcbiAgICAgICAgICB1cGRhdGUsXG4gICAgICAgICAgcmVtb3ZlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBgXG4gICAgICA8ZGl2IGNsYXNzPVwiJHtlbGVtZW50Q2xhc3Nlc31cIlxuICAgICAgICAke2JhY2tncm91bmRJbWFnZX1cbiAgICAgICAgZGF0YS1waG90by1pZD1cIiR7cGhvdG9JZH1cIlxuICAgICAgICAke21haW5BdHRyaWJ1dGV9PlxuICAgICAgICAke2Rpc2FibGVBbGwgPyBcIlwiIDogYnV0dG9uc31cbiAgICAgICAgPC9kaXY+XG4gICAgICBgO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZU5vUGhvdG9FbGVtZW50KCkge1xuICAgIHJldHVybiBgXG4gICAgICA8ZGl2IGNsYXNzPVwidmctcGhvdG8gdmctcGhvdG8tLW1haW5cIj5cbiAgICAgICAgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgdmlld0JveD1cIi0yNTYgLTI1NiAxMDI0IDEwMjRcIj5cbiAgICAgICAgICA8cGF0aCBmaWxsPVwiIzRhNTI2NlwiXG4gICAgICAgICAgICBkPVwiTTQzNyAzMTAuOGMtMjguNC0yOC40LTYyLjItNDkuMi05OS4xLTYxLjcgMzQuMS0yNS4yIDU2LjItNjUuNiA1Ni4yLTExMS4xQzM5NC4xIDYxLjkgMzMyLjEgMCAyNTYgMFMxMTcuOSA2MS45IDExNy45IDEzOC4xYzAgNDUuNSAyMi4xIDg1LjkgNTYuMiAxMTEuMSAtMzYuOSAxMi40LTcwLjggMzMuMy05OS4xIDYxLjdDMjYuNiAzNTkuMiAwIDQyMy41IDAgNDkxLjggMCA1MDMgOSA1MTIgMjAuMiA1MTJoNDcxLjdjMTEuMSAwIDIwLjItOSAyMC4yLTIwLjJDNTEyIDQyMy41IDQ4NS40IDM1OS4yIDQzNyAzMTAuOHpNMTU4LjIgMTM4LjFjMC01My45IDQzLjktOTcuOCA5Ny44LTk3LjggNTMuOSAwIDk3LjggNDMuOSA5Ny44IDk3LjggMCA1My45LTQzLjkgOTcuOC05Ny44IDk3LjhDMjAyLjEgMjM1LjggMTU4LjIgMTkyIDE1OC4yIDEzOC4xek00MS4yIDQ3MS43QzUxLjQgMzYyLjIgMTQzLjkgMjc2LjIgMjU2IDI3Ni4yczIwNC42IDg2IDIxNC44IDE5NS41SDQxLjJ6XCIvPlxuICAgICAgICA8L3N2Zz5cbiAgICAgIDwvZGl2PlxuICAgIGA7XG4gIH1cblxuICAvKipcbiAgICog0J/QvtC70YPRh9C40YLRjCDQutC90L7Qv9C60YMg0L/QviDQv9C10YDQtdC00LDQstCw0LXQvNGL0Lwg0L/QsNGA0LDQvNC10YLRgNCw0LwuXG4gICAqIEBwYXJhbSBwYXJhbXMuZGlzYWJsZUFsbCB7Ym9vbGVhbn0g0J7RgtC60LvRjtGH0LjRgtGMINCy0YHQtSDQutC90L7Qv9C60LguXG4gICAqIEBwYXJhbSBwYXJhbXMucmVtb3ZlIHtib29sZWFufSDQmtC90L7Qv9C60LAg0YPQtNCw0LvQtdC90LjRjy5cbiAgICogQHBhcmFtIHBhcmFtcy51cGxvYWQge2Jvb2xlYW59INCa0L3QvtC/0LrQsCDQt9Cw0LPRgNGD0LfQutC4LlxuICAgKiBAcGFyYW0gcGFyYW1zLnVwbG9hZEljb24ge2Jvb2xlYW59INCa0L3QvtC/0LrQsCDQt9Cw0LPRgNGD0LfQutC4INCyINCy0LjQtNC1INC40LrQvtC90LrQuC5cbiAgICogQHBhcmFtIHBhcmFtcy5zZWxlY3Qge2Jvb2xlYW59INCa0L3QvtC/0LrQsCDQstGL0LHQvtGA0LAg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqL1xuICBzdGF0aWMgZ2V0UGhvdG9CdXR0b25zKHBhcmFtcykge1xuICAgIGlmIChwYXJhbXMuZGlzYWJsZUFsbCkge1xuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuXG4gICAgY29uc3QgYnV0dG9ucyA9IHtcbiAgICAgIHJlbW92ZTogYDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvbiB2Zy1idXR0b24tLXJlZFwiIGRhdGEtYWN0aW9uPVwicmVtb3ZlLXBob3RvXCI+0KPQtNCw0LvQuNGC0Yw8L2J1dHRvbj5gLFxuICAgICAgdXBsb2FkOiBgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uXCIgZGF0YS1hY3Rpb249XCJ1cGxvYWQtcGhvdG9cIj7Ql9Cw0LPRgNGD0LfQuNGC0Yw8L2J1dHRvbj5gLFxuICAgICAgdXBsb2FkSWNvbjogYDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvbiB2Zy1idXR0b24tLXVwbG9hZFwiIGRhdGEtYWN0aW9uPVwidXBsb2FkLXBob3RvXCI+JiM0Mzs8L2J1dHRvbj5gLFxuICAgICAgdXBkYXRlOiBgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uIHZnLWJ1dHRvbi0tZ3JlZW5cIiBkYXRhLWFjdGlvbj1cInVwZGF0ZS1waG90b1wiPtCS0YvQsdGA0LDRgtGMPC9idXR0b24+YFxuICAgIH07XG5cbiAgICByZXR1cm4gT2JqZWN0LmtleXMocGFyYW1zKS5yZWR1Y2UoKGJ1dHRvbnNTdHJpbmcsIGtleSkgPT4ge1xuICAgICAgaWYgKHBhcmFtc1trZXldKSB7XG4gICAgICAgIGJ1dHRvbnNTdHJpbmcgKz0gYnV0dG9uc1trZXldO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYnV0dG9uc1N0cmluZztcbiAgICB9LCBcIlwiKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQmNC90LjRhtC40LDQu9C40LfQsNGG0LjRjyDRgdC+0LHRi9GC0LjQuSDQtNC70Y8g0LrQvdC+0L/QvtC6INCz0LDQu9C10YDQtdC4LlxuICAgKi9cbiAgc3RhdGljIGluaXRFdmVudHMoKSB7XG4gICAgY29uc3QgeyByb290RWxlbWVudCB9ID0gdGhpcztcbiAgICBjb25zdCBidXR0b25zID0gcm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcImJ1dHRvblwiKTtcblxuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4ge1xuICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgIFwiY2xpY2tcIixcbiAgICAgICAgdGhpcy5yb3V0ZXJbYnV0dG9uLmRhdGFzZXQuYWN0aW9uXSxcbiAgICAgICAgZmFsc2VcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0KDQvtGD0YLQtdGALlxuICAgKiBAdHlwZSB7e1wicmVtb3ZlLXBob3RvXCI6IGZ1bmN0aW9uKCopOiB2b2lkLCBcImZpbGUtaW5wdXQtY2hhbmdlZFwiOiBmdW5jdGlvbigqKTogdm9pZCwgXCJ1cGxvYWQtcGhvdG9cIjogZnVuY3Rpb24oKik6IHZvaWQsIFwidXBkYXRlLXBob3RvXCI6IGZ1bmN0aW9uKCopOiB2b2lkfX1cbiAgICovXG4gIHN0YXRpYyByb3V0ZXIgPSB7XG4gICAgLyoqXG4gICAgICog0JfQsNCz0YDRg9C30LrQsCDRhNC+0YLQvtCz0YDQsNGE0LjQuCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICAgKiBAcGFyYW0gZSB7RXZlbnR9INCh0L7QsdGL0YLQuNC1LlxuICAgICAqL1xuICAgIFwidXBsb2FkLXBob3RvXCI6IGUgPT4ge1xuICAgICAgY29uc3QgZmlsZUlucHV0ID0gdGhpcy5yb290RWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFt0eXBlPVwiZmlsZVwiXScpO1xuXG4gICAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCB0aGlzLnJvdXRlcltcImZpbGUtaW5wdXQtY2hhbmdlZFwiXSk7XG4gICAgICBmaWxlSW5wdXQuY2xpY2soKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqINCh0LvRg9GI0LDRgtC10LvRjCDRgdC+0LHRi9GC0LjRjyDQuNC30LzQtdC90LXQvdC40Y8g0YTQsNC50LvQvtCy0L7Qs9C+INC/0L7Qu9GPINCy0LLQvtC00LAuXG4gICAgICogQHBhcmFtIGUge2V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICBcImZpbGUtaW5wdXQtY2hhbmdlZFwiOiBlID0+IHtcbiAgICAgIGNvbnN0IGZpbGUgPSBlLnRhcmdldC5maWxlc1swXTtcbiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuXG4gICAgICByZWFkZXIub25sb2FkID0gKCkgPT4ge1xuICAgICAgICB0aGlzLmFkZFBob3RvKHJlYWRlci5yZXN1bHQpLnRoZW4oXG4gICAgICAgICAgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9O1xuXG4gICAgICByZWFkZXIub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7XG4gICAgICAgICAgbWVzc2FnZTogcmVhZGVyLmVycm9yLFxuICAgICAgICAgIGJsb2NraW5nRXJyb3JNZXNzYWdlOiBg0J7RiNC40LHQutCwINC30LDQs9GA0YPQt9C60Lgg0YTQvtGC0L7Qs9GA0LDRhNC40LggKC3QuNC5KTogJHtyZWFkZXIuZXJyb3J9YFxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDRg9C00LDQu9C10L3QuNC1INGE0L7RgtC+0LPRgNCw0YTQuNC4INGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgICAqIEBwYXJhbSBlIHtFdmVudH0g0KHQvtCx0YvRgtC40LUuXG4gICAgICovXG4gICAgXCJyZW1vdmUtcGhvdG9cIjogZSA9PiB7XG4gICAgICBjb25zdCBwaG90b0VsZW1lbnQgPSBlLnRhcmdldC5jbG9zZXN0KFwiLnZnLXBob3RvXCIpO1xuICAgICAgY29uc3QgeyBwaG90b0lkIH0gPSBwaG90b0VsZW1lbnQuZGF0YXNldDtcblxuICAgICAgaWYgKCEhcGhvdG9JZCkge1xuICAgICAgICB0aGlzLmRlbGV0ZVBob3RvKCtwaG90b0lkKS50aGVuKFxuICAgICAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG4gICAgLyoqXG4gICAgICog0JfQsNC/0YDQvtGBINC90LAg0L7QsdC90L7QstC70LXQvdC40LUg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAgICogQHBhcmFtIGUge0V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICBcInVwZGF0ZS1waG90b1wiOiBlID0+IHtcbiAgICAgIGNvbnN0IHBob3RvRWxlbWVudCA9IGUudGFyZ2V0LmNsb3Nlc3QoXCIudmctcGhvdG9cIik7XG4gICAgICBjb25zdCB7IHBob3RvSWQgfSA9IHBob3RvRWxlbWVudC5kYXRhc2V0O1xuXG4gICAgICBpZiAoISFwaG90b0lkKSB7XG4gICAgICAgIHRoaXMuc2V0QXNNYWluUGhvdG8oK3Bob3RvSWQpLnRoZW4oXG4gICAgICAgICAgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==