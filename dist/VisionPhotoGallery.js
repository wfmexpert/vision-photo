!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VisionPhotoGallery=e():t.VisionPhotoGallery=e()}(this,(function(){return function(){"use strict";var t={d:function(e,o){for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},e={};function o(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function n(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}t.d(e,{default:function(){return s}});var s=function(){function t(e){var o=e.root,n=e.employeeId,r=e.visionPersonId,i=e.token,a=e.disableControls,s=void 0!==a&&a;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!o)throw new Error("Не указан ID корневого элемента для галереи!");var l=document.getElementById(o);if(!l)throw new Error("Проверьте указанный ID корневого элемента для галереи!");if(t.rootElement=l,!n&&!r)throw new Error("Не указан ID пользователя на портале Vision");this.employeeId=n,this.visionPersonId=r,this.token=i,this.disableControls=s,t.draw()}var e,o,a;return e=t,a=[{key:"update",value:function(t){var e=t.employeeId,o=t.token;this.employeeId=e,this.token=o,this.draw()}},{key:"handleError",value:function(t){var e=t.message,o=t.blockingErrorMessage;if(this.errorFunction){var n="";"object"===r(e)&&(e.faultstring?n=e.faultstring:Object.keys(e).reverse().forEach((function(t){n+="".concat(e[t],"<br/>")})));var i=n.length?n:JSON.stringify(e);this.errorFunction(i,"Ошибка")}else{if(o)throw new Error(o);console.log(e)}}},{key:"request",value:function(t){var e=t.requestPath,o=t.requestBody,n={method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":this.token},body:JSON.stringify(o)};return fetch("/api/v2/vision/".concat(e,"/"),n)}},{key:"getPhotos",value:function(){var t={};return this.employeeId&&!this.visionPersonId?t.employeeId=this.employeeId:this.visionPersonId&&(t.vision_person_id=this.visionPersonId),this.request({requestPath:"get_photos",requestBody:n(n({},t),{},{masterAlbum:!0})})}},{key:"addPhoto",value:function(t){return this.request({requestPath:"add_photo",requestBody:{employeeId:this.employeeId,image:t}})}},{key:"deletePhoto",value:function(t){return this.request({requestPath:"delete_photo",requestBody:{photo_id:t}})}},{key:"updatePhoto",value:function(t){return this.request({requestPath:"update_photo",requestBody:{employeeId:this.employeeId,photo_id:t}})}},{key:"draw",value:function(){var t=this,e=this.rootElement;e.innerHTML='\n      <div class="vision-photo-gallery vision-photo-gallery--message" data-message="Загрузка...">\n        <input type="file" class="vision-photo-gallery__file-field" tabindex="-1">\n        <div class="vision-photo-gallery__item vision-photo-gallery__item--main">\n          <h4 class="vision-photo-gallery__title">Основная фотография</h4>\n          <div class="vg-main-photo"></div>\n        </div>\n        <div class="vision-photo-gallery__item">\n          <h4 class="vision-photo-gallery__title">Галерея</h4>\n          <div class="vg-gallery"></div>\n        </div>\n      </div>\n    ';var o=document.querySelector(".vision-photo-gallery"),n=e.querySelector(".vg-main-photo"),r=e.querySelector(".vg-gallery"),i=this.disableControls;this.getPhotos().then((function(e){if(n.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null}),r.innerHTML=t.createPhotoElement({main:!1,empty:!0,photoId:null}),e.ok)return e.json();n.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null}),o.classList.remove("vision-photo-gallery--message"),n.parentElement.classList.add("hidden"),t.initEvents()}),(function(e){t.handleError({message:e}),t.initEvents()})).then((function(e){if(e){var a=e.find((function(t){return t.main})),s=e.filter((function(t){return!t.main}));if(a?n.innerHTML=t.createPhotoElement(a):n.parentElement.classList.add("hidden"),s.length){var l="";s.forEach((function(e){return l+=t.createPhotoElement(e)})),i||(l+=t.createPhotoElement({main:!1,empty:!0,photoId:null})),r.innerHTML=l}t.initEvents(),o.classList.remove("vision-photo-gallery--message")}}),(function(e){t.handleError({message:e}),t.initEvents()})).catch((function(e){t.handleError({message:e}),t.initEvents()})),this.initEvents()}},{key:"createPhotoElement",value:function(t){var e=t.photoId,o=t.main,n=t.empty,r=t.path,i=t.avatarUrl,a=this.disableControls,s="",l="",u="",c="";return r&&(u='style="background-image: url('.concat(r,')"')),i&&(u='style="background-image: url('.concat(i,')"')),o&&(c='data-main="'.concat(o,'"')),o&&!n?(l="vg-photo vg-photo--main",s='\n        <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n      '):o&&n?(l="vg-photo vg-photo--main",s='\n        <button class="vg-photo__button vg-button" data-action="upload-photo">Загрузить</button>\n      '):!o&&n?(l="vg-gallery__item vg-photo vg-photo--upload",s='\n        <button class="vg-photo__button vg-button vg-button--upload" data-action="upload-photo">&#43;</button>\n      '):(l="vg-gallery__item vg-photo",s='\n        <button class="vg-photo__button vg-button vg-button--green" data-action="update-photo">Выбрать</button>\n        <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n      '),'\n      <div class="'.concat(l,'"\n        ').concat(u,'\n        data-photo-id="').concat(e,'"\n        ').concat(c,">\n        ").concat(a?"":s,"\n        </div>\n      ")}},{key:"initEvents",value:function(){var t=this;this.rootElement.querySelectorAll("button").forEach((function(e){e.addEventListener("click",t.router[e.dataset.action],!1)}))}}],(o=[{key:"errorFunction",get:function(){return t.errorFunction},set:function(e){e&&(t.errorFunction=e)}},{key:"employeeId",get:function(){return t.employeeId},set:function(e){e&&(t.employeeId=e)}},{key:"visionPersonId",get:function(){return t.employeeId},set:function(e){e&&(t.visionPersonId=e)}},{key:"rootElement",get:function(){return t.rootElement}},{key:"token",get:function(){return t.token},set:function(e){e&&(t.token=e)}},{key:"disableControls",get:function(){return t.disableControls},set:function(e){e&&(t.disableControls=e)}}])&&i(e.prototype,o),a&&i(e,a),t}();return a(s,"employeeId",null),a(s,"visionPersonId",null),a(s,"rootElement",null),a(s,"token",null),a(s,"disableControls",!1),a(s,"errorFunction",null),a(s,"router",{"upload-photo":function(t){var e=s.rootElement.querySelector('input[type="file"]');e.addEventListener("change",s.router["file-input-changed"]),e.click()},"file-input-changed":function(t){var e=t.target.files[0],o=new FileReader;o.readAsDataURL(e),o.onload=function(){s.addPhoto(o.result).then((function(t){if(t.ok)s.draw();else if(200!==t.status)return t.json()}),(function(t){s.handleError({message:t})}))},o.onerror=function(){s.handleError({message:o.error,blockingErrorMessage:"Ошибка загрузки фотографии (-ий): ".concat(o.error)})}},"remove-photo":function(t){var e=t.target.closest(".vg-photo").dataset.photoId;e&&s.deletePhoto(+e).then((function(t){if(t.ok)s.draw();else if(200!==t.status)return t.json()}),(function(t){s.handleError({message:t})}))},"update-photo":function(t){var e=t.target.closest(".vg-photo").dataset.photoId;e&&s.updatePhoto(+e).then((function(t){if(t.ok)s.draw();else if(200!==t.status)return t.json()}),(function(t){s.handleError({message:t})}))}}),e.default}()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS8uL1Zpc2lvblBob3RvR2FsbGVyeS9pbmRleC5qcyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJ0aGlzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIlZpc2lvblBob3RvR2FsbGVyeSIsImVtcGxveWVlSWQiLCJ2aXNpb25QZXJzb25JZCIsInRva2VuIiwiZGlzYWJsZUNvbnRyb2xzIiwiRXJyb3IiLCJyb290RWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJkcmF3IiwicGFyYW1zIiwibWVzc2FnZSIsImJsb2NraW5nRXJyb3JNZXNzYWdlIiwiZXJyb3JGdW5jdGlvbiIsIm1lc3NhZ2VTdHJpbmciLCJmYXVsdHN0cmluZyIsImtleXMiLCJyZXZlcnNlIiwiZm9yRWFjaCIsImVycm9yTWVzc2FnZSIsImxlbmd0aCIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb25zb2xlIiwibG9nIiwicmVxdWVzdFBhdGgiLCJyZXF1ZXN0Qm9keSIsInJlcXVlc3REZWZhdWx0cyIsIm1ldGhvZCIsIm1vZGUiLCJjcmVkZW50aWFscyIsImhlYWRlcnMiLCJib2R5IiwiZmV0Y2giLCJlbXBsb3llZSIsInZpc2lvbl9wZXJzb25faWQiLCJyZXF1ZXN0IiwibWFzdGVyQWxidW0iLCJpbWFnZSIsInBob3RvSWQiLCJwaG90b19pZCIsImlubmVySFRNTCIsImdhbGxlcnlDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwibWFpblBob3RvQ29udGFpbmVyIiwiZ2FsbGVyeSIsImlzQ29udHJvbHNEaXNhYmxlZCIsImdldFBob3RvcyIsInRoZW4iLCJyZXNwb25zZSIsImNyZWF0ZVBob3RvRWxlbWVudCIsIm1haW4iLCJlbXB0eSIsIm9rIiwianNvbiIsImNsYXNzTGlzdCIsInJlbW92ZSIsInBhcmVudEVsZW1lbnQiLCJhZGQiLCJpbml0RXZlbnRzIiwiZXJyb3IiLCJoYW5kbGVFcnJvciIsInJlc3BvbnNlSnNvbiIsIm1haW5QaG90b0RhdGEiLCJmaW5kIiwiZ2FsbGVyeVBob3Rvc0RhdGEiLCJmaWx0ZXIiLCJnYWxsZXJ5UGhvdG9zSHRtbCIsInBob3RvRGF0YSIsImNhdGNoIiwicGF0aCIsImF2YXRhclVybCIsImJ1dHRvbnMiLCJlbGVtZW50Q2xhc3NlcyIsImJhY2tncm91bmRJbWFnZSIsIm1haW5BdHRyaWJ1dGUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiYnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJvdXRlciIsImRhdGFzZXQiLCJhY3Rpb24iLCJ2YWx1ZSIsImUiLCJmaWxlSW5wdXQiLCJjbGljayIsImZpbGUiLCJ0YXJnZXQiLCJmaWxlcyIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJyZWFkQXNEYXRhVVJMIiwib25sb2FkIiwiYWRkUGhvdG8iLCJyZXN1bHQiLCJzdGF0dXMiLCJvbmVycm9yIiwiY2xvc2VzdCIsImRlbGV0ZVBob3RvIiwidXBkYXRlUGhvdG8iXSwibWFwcGluZ3MiOiJDQUFBLFNBQTJDQSxFQUFNQyxHQUMxQixpQkFBWkMsU0FBMEMsaUJBQVhDLE9BQ3hD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LEVBb2dCSjZELFlBQVksQ0FDZmxELFFBQVNpRCxRQU1qQjZCLEVBQU9PLFFBQVUsV0EzZ0JGaEcsRUE0Z0JSNkQsWUFBWSxDQUNmbEQsUUFBUzhFLEVBQU83QixNQUNoQmhELHFCQUFzQixxQ0FBRixPQUF1QzZFLEVBQU83QixXQVF4RSxlQUFnQixTQUFBdUIsR0FDZCxJQUNRNUMsRUFEYTRDLEVBQUVJLE9BQU9VLFFBQVEsYUFDTGpCLFFBQXpCekMsUUFFRkEsR0ExaEJTdkMsRUEyaEJSa0csYUFBYTNELEdBQVNTLE1BQ3pCLFNBQUFDLEdBQ0UsR0FBSUEsRUFBU0ksR0E3aEJKckQsRUE4aEJGUyxZQUNBLEdBQXdCLE1BQXBCd0MsRUFBUzhDLE9BQ2xCLE9BQU85QyxFQUFTSyxVQUdwQixTQUFBTSxHQW5pQlc1RCxFQW9pQko2RCxZQUFZLENBQ2ZsRCxRQUFTaUQsUUFVbkIsZUFBZ0IsU0FBQXVCLEdBQ2QsSUFDUTVDLEVBRGE0QyxFQUFFSSxPQUFPVSxRQUFRLGFBQ0xqQixRQUF6QnpDLFFBRUZBLEdBbmpCU3ZDLEVBb2pCUm1HLGFBQWE1RCxHQUFTUyxNQUN6QixTQUFBQyxHQUNFLEdBQUlBLEVBQVNJLEdBdGpCSnJELEVBdWpCRlMsWUFDQSxHQUF3QixNQUFwQndDLEVBQVM4QyxPQUNsQixPQUFPOUMsRUFBU0ssVUFHcEIsU0FBQU0sR0E1akJXNUQsRUE2akJKNkQsWUFBWSxDQUNmbEQsUUFBU2lELFUiLCJmaWxlIjoiVmlzaW9uUGhvdG9HYWxsZXJ5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW10sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiVmlzaW9uUGhvdG9HYWxsZXJ5XCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIlZpc2lvblBob3RvR2FsbGVyeVwiXSA9IGZhY3RvcnkoKTtcbn0pKHRoaXMsIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBkZWZpbml0aW9uKSB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iaiwgcHJvcCkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCk7IH0iLCJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFwiLi9hcHAuc2Nzc1wiO1xuXG4vKipcbiAqINCa0LvQsNGB0YEg0LPQsNC70LXRgNC10LguXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZpc2lvblBob3RvR2FsbGVyeSB7XG4gIHN0YXRpYyBlbXBsb3llZUlkID0gbnVsbDtcbiAgc3RhdGljIHZpc2lvblBlcnNvbklkID0gbnVsbDtcbiAgc3RhdGljIHJvb3RFbGVtZW50ID0gbnVsbDtcbiAgc3RhdGljIHRva2VuID0gbnVsbDtcbiAgc3RhdGljIGRpc2FibGVDb250cm9scyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiDQmtC+0L3RgdGC0YDRg9C60YLQvtGAINGN0LrQt9C10LzQv9C70Y/RgNCwINC60LvQsNGB0YHQsCDQs9Cw0LvQtdGA0LXQuC5cbiAgICogQHBhcmFtIHJvb3Qge3N0cmluZ30gSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAsINC60YPQtNCwINCx0YPQtNC10YIg0YDQtdC90LTQtdGA0LjRgtGM0YHRjyDQs9Cw0LvQtdGA0LXRjy5cbiAgICogQHBhcmFtIGVtcGxveWVlSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcGFyYW0gdmlzaW9uUGVyc29uSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKiBAcGFyYW0gdG9rZW4ge3N0cmluZ30gQ1NSRi3RgtC+0LrQtdC9INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICogQHBhcmFtIGRpc2FibGVDb250cm9scyB7Ym9vbGVhbn0g0J7RgtC60LvRjtGH0LjRgtGMINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0LfQsNCz0YDRg9C30LrQuCwg0L7QsdC90L7QstC70LXQvdC40Y8g0Lgg0YPQtNCw0LvQtdC90LjRjyDRhNC+0YLQvtCz0YDQsNGE0LjQuS5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHtcbiAgICByb290LFxuICAgIGVtcGxveWVlSWQsXG4gICAgdmlzaW9uUGVyc29uSWQsXG4gICAgdG9rZW4sXG4gICAgZGlzYWJsZUNvbnRyb2xzID0gZmFsc2VcbiAgfSkge1xuICAgIGlmICghcm9vdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwi0J3QtSDRg9C60LDQt9Cw0L0gSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAg0LTQu9GPINCz0LDQu9C10YDQtdC4IVwiKTtcbiAgICB9XG5cbiAgICBjb25zdCByb290RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJvb3QpO1xuXG4gICAgaWYgKCEhcm9vdEVsZW1lbnQpIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS5yb290RWxlbWVudCA9IHJvb3RFbGVtZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCLQn9GA0L7QstC10YDRjNGC0LUg0YPQutCw0LfQsNC90L3Ri9C5IElEINC60L7RgNC90LXQstC+0LPQviDRjdC70LXQvNC10L3RgtCwINC00LvRjyDQs9Cw0LvQtdGA0LXQuCFcIik7XG4gICAgfVxuXG4gICAgaWYgKCFlbXBsb3llZUlkICYmICF2aXNpb25QZXJzb25JZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwi0J3QtSDRg9C60LDQt9Cw0L0gSUQg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uXCIpO1xuICAgIH1cblxuICAgIHRoaXMuZW1wbG95ZWVJZCA9IGVtcGxveWVlSWQ7XG4gICAgdGhpcy52aXNpb25QZXJzb25JZCA9IHZpc2lvblBlcnNvbklkO1xuICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcbiAgICB0aGlzLmRpc2FibGVDb250cm9scyA9IGRpc2FibGVDb250cm9scztcblxuICAgIFZpc2lvblBob3RvR2FsbGVyeS5kcmF3KCk7XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LDQtdC80YvQuSDQvNC10YLQvtC0INC00LvRjyDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICogQHR5cGUge251bGx8RnVuY3Rpb259INCk0YPQvdC60YbQuNGPINC+0LHRgNCw0LHQvtGC0YfQuNC6INC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKi9cbiAgc3RhdGljIGVycm9yRnVuY3Rpb24gPSBudWxsO1xuICAvKipcbiAgICog0J/QvtC70YPRh9C10L3QuNC1INC80LXRgtC+0LTQsCDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqIEB0eXBlIHtudWxsfEZ1bmN0aW9ufSDQpNGD0L3QutGG0LjRjyDQvtCx0YDQsNCx0L7RgtGH0LjQuiDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICovXG4gIGdldCBlcnJvckZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZXJyb3JGdW5jdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDQvNC10YLQvtC00LAg0LTQu9GPINC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKiBAcGFyYW0gZXJyb3JGdW5jdGlvbiB7bnVsbHxGdW5jdGlvbn0g0KTRg9C90LrRhtC40Y8g0L7QsdGA0LDQsdC+0YLRh9C40Log0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqL1xuICBzZXQgZXJyb3JGdW5jdGlvbihlcnJvckZ1bmN0aW9uKSB7XG4gICAgaWYgKGVycm9yRnVuY3Rpb24pIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS5lcnJvckZ1bmN0aW9uID0gZXJyb3JGdW5jdGlvbjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J7QsdC90L7QstC70LXQvdC40LUg0L/QsNGA0LDQvNC10YLRgNC+0LIg0LPQsNC70LXRgNC10LguXG4gICAqIEBwYXJhbSBlbXBsb3llZUlkIHtudW1iZXJ8bnVtYmVyfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIHRva2VuIHtzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICovXG4gIHN0YXRpYyB1cGRhdGUoeyBlbXBsb3llZUlkLCB0b2tlbiB9KSB7XG4gICAgdGhpcy5lbXBsb3llZUlkID0gZW1wbG95ZWVJZDtcbiAgICB0aGlzLnRva2VuID0gdG9rZW47XG5cbiAgICB0aGlzLmRyYXcoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LjRgtGMIElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICovXG4gIGdldCBlbXBsb3llZUlkKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZW1wbG95ZWVJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDRjdC60LfQtdC80L/Qu9GP0YDRgyDQs9Cw0LvQtdGA0LXQuCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIGVtcGxveWVlSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKi9cbiAgc2V0IGVtcGxveWVlSWQoZW1wbG95ZWVJZCkge1xuICAgIGlmIChlbXBsb3llZUlkKSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkuZW1wbG95ZWVJZCA9IGVtcGxveWVlSWQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0YwgSUQg0YHQvtGC0YDRg9C00L3QuNC60LAg0LDRg9GC0YHQvtGA0YHQtdGA0LAuXG4gICAqIEByZXR1cm4ge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKi9cbiAgZ2V0IHZpc2lvblBlcnNvbklkKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZW1wbG95ZWVJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDRjdC60LfQtdC80L/Qu9GP0YDRgyDQs9Cw0LvQtdGA0LXQuCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICogQHBhcmFtIHZpc2lvblBlcnNvbklkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICovXG4gIHNldCB2aXNpb25QZXJzb25JZCh2aXNpb25QZXJzb25JZCkge1xuICAgIGlmICh2aXNpb25QZXJzb25JZCkge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LnZpc2lvblBlcnNvbklkID0gdmlzaW9uUGVyc29uSWQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCa0L7RgNC90LXQstC+0Lkg0Y3Qu9C10LzQtdC90YIsINCyINC60L7RgtC+0YDRi9C5INCx0YPQtNC10YIg0YDQtdC90LTQtdGA0LjRgtGM0YHRjyDQs9Cw0LvQtdGA0LXRjy5cbiAgICogQHJldHVybiB7bnVsbHxFbGVtZW50fSDQmtC+0YDQvdC10LLQvtC5INGN0LvQtdC80LXQvdGCINC00LvRjyDRgNC10L3QtNC10YDQsC5cbiAgICovXG4gIGdldCByb290RWxlbWVudCgpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LnJvb3RFbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0YwgQ1NSRi3RgtC+0LrQtdC9INGB0LXRgdGB0LjQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8uXG4gICAqIEByZXR1cm4ge251bGx8c3RyaW5nfSBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICovXG4gIGdldCB0b2tlbigpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LnRva2VuO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C40YLRjCBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICogQHBhcmFtIHRva2VuIHtzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC40Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPLlxuICAgKi9cbiAgc2V0IHRva2VuKHRva2VuKSB7XG4gICAgaWYgKHRva2VuKSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkudG9rZW4gPSB0b2tlbjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J/QvtC70YPRh9C40YLRjCDQt9C90LDRh9C10L3QuNC1INGB0L7RgdGC0L7Rj9C90LjRjyDQutC+0L3RgtGA0L7Qu9C+0LIuXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59INCh0L7RgdGC0L7Rj9C90LjQtSDQutC+0L3RgtGA0L7Qu9C+0LIuXG4gICAqL1xuICBnZXQgZGlzYWJsZUNvbnRyb2xzKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZGlzYWJsZUNvbnRyb2xzO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C40YLRjCBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICogQHBhcmFtIHZhbHVlIHtib29sZWFufSDQktC60LvRjtGH0LjRgtGML9C+0YLQutC70Y7Rh9C40YLRjCDQutC+0L3RgtGA0L7Qu9GLLlxuICAgKi9cbiAgc2V0IGRpc2FibGVDb250cm9scyh2YWx1ZSkge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LmRpc2FibGVDb250cm9scyA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQntCx0YDQsNCx0L7RgtGH0LjQuiDQvtGI0LjQsdC+0LouXG4gICAqIEBwYXJhbSBwYXJhbXMubWVzc2FnZSB7c3RyaW5nfSDQodC+0L7QsdGJ0LXQvdC40LUg0L7QsSDQvtGI0LjQsdC60LUuXG4gICAqIEBwYXJhbSBwYXJhbXMuYmxvY2tpbmdFcnJvck1lc3NhZ2Uge3N0cmluZ30g0JHQu9C+0LrQuNGA0YPRjtGJ0LXQtSDQv9C+0YLQvtC6INGB0L7QvtCx0YnQtdC90LjQtSDQvtCxINC+0YjQuNCx0LrQtS5cbiAgICovXG4gIHN0YXRpYyBoYW5kbGVFcnJvcihwYXJhbXMpIHtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIGJsb2NraW5nRXJyb3JNZXNzYWdlIH0gPSBwYXJhbXM7XG5cbiAgICBpZiAodGhpcy5lcnJvckZ1bmN0aW9uKSB7XG4gICAgICBsZXQgbWVzc2FnZVN0cmluZyA9IFwiXCI7XG5cbiAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICBpZiAobWVzc2FnZS5mYXVsdHN0cmluZykge1xuICAgICAgICAgIG1lc3NhZ2VTdHJpbmcgPSBtZXNzYWdlLmZhdWx0c3RyaW5nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIE9iamVjdC5rZXlzKG1lc3NhZ2UpXG4gICAgICAgICAgICAucmV2ZXJzZSgpXG4gICAgICAgICAgICAuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgICBtZXNzYWdlU3RyaW5nICs9IGAke21lc3NhZ2Vba2V5XX08YnIvPmA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBtZXNzYWdlU3RyaW5nLmxlbmd0aFxuICAgICAgICA/IG1lc3NhZ2VTdHJpbmdcbiAgICAgICAgOiBKU09OLnN0cmluZ2lmeShtZXNzYWdlKTtcblxuICAgICAgdGhpcy5lcnJvckZ1bmN0aW9uKGVycm9yTWVzc2FnZSwgXCLQntGI0LjQsdC60LBcIik7XG4gICAgfSBlbHNlIGlmIChibG9ja2luZ0Vycm9yTWVzc2FnZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGJsb2NraW5nRXJyb3JNZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCe0LHRkdGA0YLQutCwINC00LvRjyDQt9Cw0L/RgNC+0YHQvtCyINC6IEFQSS5cbiAgICogQHBhcmFtIHJlcXVlc3RQYXRoIHtzdHJpbmd9INCd0LDQt9Cy0LDQvdC40LUg0LzQtdGC0L7QtNCwIEFQSS5cbiAgICogQHBhcmFtIHJlcXVlc3RCb2R5IHtvYmplY3R9INCf0LDRgNCw0LzQtdGC0YDRiyDQt9Cw0L/RgNC+0YHQsC5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgcmVxdWVzdCh7IHJlcXVlc3RQYXRoLCByZXF1ZXN0Qm9keSB9KSB7XG4gICAgY29uc3QgcmVxdWVzdERlZmF1bHRzID0ge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIG1vZGU6IFwic2FtZS1vcmlnaW5cIixcbiAgICAgIGNyZWRlbnRpYWxzOiBcInNhbWUtb3JpZ2luXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBcIlgtQ1NSRlRva2VuXCI6IHRoaXMudG9rZW5cbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSlcbiAgICB9O1xuXG4gICAgcmV0dXJuIGZldGNoKGAvYXBpL3YyL3Zpc2lvbi8ke3JlcXVlc3RQYXRofS9gLCByZXF1ZXN0RGVmYXVsdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqINCS0YvQs9GA0YPQt9C60LAg0LLRgdC10YUg0YTQvtGC0L7Qs9GA0LDRhNC40Lkg0YEg0L/QvtGA0YLQsNC70LAgVmlzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIGdldFBob3RvcygpIHtcbiAgICBjb25zdCBlbXBsb3llZSA9IHt9O1xuXG4gICAgaWYgKHRoaXMuZW1wbG95ZWVJZCAmJiAhdGhpcy52aXNpb25QZXJzb25JZCkge1xuICAgICAgZW1wbG95ZWUuZW1wbG95ZWVJZCA9IHRoaXMuZW1wbG95ZWVJZDtcbiAgICB9IGVsc2UgaWYgKHRoaXMudmlzaW9uUGVyc29uSWQpIHtcbiAgICAgIGVtcGxveWVlLnZpc2lvbl9wZXJzb25faWQgPSB0aGlzLnZpc2lvblBlcnNvbklkO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgcmVxdWVzdFBhdGg6IFwiZ2V0X3Bob3Rvc1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgLi4uZW1wbG95ZWUsXG4gICAgICAgIG1hc3RlckFsYnVtOiB0cnVlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0JfQsNC/0YDQvtGBINC90LAg0LTQvtCx0LDQstC70LXQvdC40LUgKNC30LDQs9GA0YPQt9C60YMpINGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gaW1hZ2Uge0J1ZmZlckVuY29kaW5nfSDQpNC+0YLQvtCz0YDQsNGE0LjQuCDQsiDRhNC+0YDQvNCw0YLQtSBCYXNlNjQuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINGBINGA0LXQt9GD0LvRjNGC0LDRgtC+0Lwg0LLRi9C/0L7Qu9C90LXQvdC40Y8g0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgYWRkUGhvdG8oaW1hZ2UpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiBcImFkZF9waG90b1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgZW1wbG95ZWVJZDogdGhpcy5lbXBsb3llZUlkLFxuICAgICAgICBpbWFnZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCX0LDQv9GA0L7RgSDQvdCwINGD0LTQsNC70LXQvdC40LUg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwaG90b0lkIHtOdW1iZXJ9IElEINGE0L7RgtC+0LPRgNCw0YTQuNC4INC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIGRlbGV0ZVBob3RvKHBob3RvSWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiBcImRlbGV0ZV9waG90b1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgcGhvdG9faWQ6IHBob3RvSWRcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDQvtCx0L3QvtCy0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHBhcmFtIHBob3RvSWQge051bWJlcn0gSUQg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0L3QsCDQv9C+0YDRgtCw0LvQtSBWaXNpb24uXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINGBINGA0LXQt9GD0LvRjNGC0LDRgtC+0Lwg0LLRi9C/0L7Qu9C90LXQvdC40Y8g0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgdXBkYXRlUGhvdG8ocGhvdG9JZCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgcmVxdWVzdFBhdGg6IFwidXBkYXRlX3Bob3RvXCIsXG4gICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICBlbXBsb3llZUlkOiB0aGlzLmVtcGxveWVlSWQsXG4gICAgICAgIHBob3RvX2lkOiBwaG90b0lkXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0J7RgtGA0LjRgdC+0LLQutCwIERPTSDQs9Cw0LvQtdGA0LXQuNC4LlxuICAgKi9cbiAgc3RhdGljIGRyYXcoKSB7XG4gICAgY29uc3Qgcm9vdEVsZW1lbnQgPSB0aGlzLnJvb3RFbGVtZW50O1xuXG4gICAgcm9vdEVsZW1lbnQuaW5uZXJIVE1MID0gYFxuICAgICAgPGRpdiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5IHZpc2lvbi1waG90by1nYWxsZXJ5LS1tZXNzYWdlXCIgZGF0YS1tZXNzYWdlPVwi0JfQsNCz0YDRg9C30LrQsC4uLlwiPlxuICAgICAgICA8aW5wdXQgdHlwZT1cImZpbGVcIiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X19maWxlLWZpZWxkXCIgdGFiaW5kZXg9XCItMVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX2l0ZW0gdmlzaW9uLXBob3RvLWdhbGxlcnlfX2l0ZW0tLW1haW5cIj5cbiAgICAgICAgICA8aDQgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9fdGl0bGVcIj7QntGB0L3QvtCy0L3QsNGPINGE0L7RgtC+0LPRgNCw0YTQuNGPPC9oND5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidmctbWFpbi1waG90b1wiPjwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X19pdGVtXCI+XG4gICAgICAgICAgPGg0IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX3RpdGxlXCI+0JPQsNC70LXRgNC10Y88L2g0PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2Zy1nYWxsZXJ5XCI+PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgYDtcblxuICAgIGNvbnN0IGdhbGxlcnlDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnZpc2lvbi1waG90by1nYWxsZXJ5XCIpO1xuICAgIGNvbnN0IG1haW5QaG90b0NvbnRhaW5lciA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmctbWFpbi1waG90b1wiKTtcbiAgICBjb25zdCBnYWxsZXJ5ID0gcm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi52Zy1nYWxsZXJ5XCIpO1xuICAgIGNvbnN0IHsgZGlzYWJsZUNvbnRyb2xzOiBpc0NvbnRyb2xzRGlzYWJsZWQgfSA9IHRoaXM7XG5cbiAgICB0aGlzLmdldFBob3RvcygpXG4gICAgICAudGhlbihcbiAgICAgICAgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudCh7XG4gICAgICAgICAgICBtYWluOiB0cnVlLFxuICAgICAgICAgICAgZW1wdHk6IHRydWUsXG4gICAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBnYWxsZXJ5LmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHtcbiAgICAgICAgICAgIG1haW46IGZhbHNlLFxuICAgICAgICAgICAgZW1wdHk6IHRydWUsXG4gICAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudCh7XG4gICAgICAgICAgICAgIG1haW46IHRydWUsXG4gICAgICAgICAgICAgIGVtcHR5OiB0cnVlLFxuICAgICAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZ2FsbGVyeUNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwidmlzaW9uLXBob3RvLWdhbGxlcnktLW1lc3NhZ2VcIik7XG4gICAgICAgICAgICBtYWluUGhvdG9Db250YWluZXIucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7XG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC50aGVuKFxuICAgICAgICByZXNwb25zZUpzb24gPT4ge1xuICAgICAgICAgIGlmICghcmVzcG9uc2VKc29uKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgbWFpblBob3RvRGF0YSA9IHJlc3BvbnNlSnNvbi5maW5kKCh7IG1haW4gfSkgPT4gbWFpbik7XG4gICAgICAgICAgY29uc3QgZ2FsbGVyeVBob3Rvc0RhdGEgPSByZXNwb25zZUpzb24uZmlsdGVyKCh7IG1haW4gfSkgPT4gIW1haW4pO1xuXG4gICAgICAgICAgaWYgKCEhbWFpblBob3RvRGF0YSkge1xuICAgICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KFxuICAgICAgICAgICAgICBtYWluUGhvdG9EYXRhXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtYWluUGhvdG9Db250YWluZXIucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChnYWxsZXJ5UGhvdG9zRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCBnYWxsZXJ5UGhvdG9zSHRtbCA9IFwiXCI7XG5cbiAgICAgICAgICAgIGdhbGxlcnlQaG90b3NEYXRhLmZvckVhY2goXG4gICAgICAgICAgICAgIHBob3RvRGF0YSA9PlxuICAgICAgICAgICAgICAgIChnYWxsZXJ5UGhvdG9zSHRtbCArPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudChwaG90b0RhdGEpKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKCFpc0NvbnRyb2xzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgZ2FsbGVyeVBob3Rvc0h0bWwgKz0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQoe1xuICAgICAgICAgICAgICAgIG1haW46IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVtcHR5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHBob3RvSWQ6IG51bGxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGdhbGxlcnkuaW5uZXJIVE1MID0gZ2FsbGVyeVBob3Rvc0h0bWw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgICAgICAgZ2FsbGVyeUNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwidmlzaW9uLXBob3RvLWdhbGxlcnktLW1lc3NhZ2VcIik7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7XG4gICAgICAgICAgbWVzc2FnZTogZXJyb3JcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgfSk7XG5cbiAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQo9C90LjQstC10YDRgdCw0LvRjNC90YvQuSDQvNC10YLQvtC0INC00LvRjyDRgdC+0LfQtNCw0L3QuNGPINGN0LvQtdC80LXQvdGC0LAg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwYXJhbXMucGhvdG9JZCB7bnVtYmVyfSBJRCDRhNC+0YLQvtCz0YDQsNGE0LjQuCDQvdCwINC/0L7RgNGC0LDQu9C1IFZpc2lvbi5cbiAgICogQHBhcmFtIHBhcmFtcy5tYWluIHtib29sZWFufSAg0KTQu9Cw0LMg0L7RgdC90L7QstC90L7Qs9C+INGE0L7RgtC+LlxuICAgKiBAcGFyYW0gcGFyYW1zLmVtcHR5IHtib29sZWFufSDQpNC70LDQsyBcItC/0YPRgdGC0L7Qs9C+XCIg0YTQvtGC0L4sINC40YHQv9C+0LvRjNC30YPQtdGC0YHRjyDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQutC90L7Qv9C60Lgg0LfQsNCz0YDRg9C30LrQuC5cbiAgICogQHBhcmFtIHBhcmFtcy5wYXRoIHtzdHJpbmd9INCf0YPRgtGMINC6INGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gcGFyYW1zLmF2YXRhclVybCB7c3RyaW5nfSDQn9GD0YLRjCDQuiDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHJldHVybnMge3N0cmluZ30g0K3Qu9C10LzQtdC90YIg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0LIg0LLQuNC00LUg0YHRgtGA0L7QutC4LlxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZVBob3RvRWxlbWVudChwYXJhbXMpIHtcbiAgICBjb25zdCB7IHBob3RvSWQsIG1haW4sIGVtcHR5LCBwYXRoLCBhdmF0YXJVcmwgfSA9IHBhcmFtcztcbiAgICBjb25zdCB7IGRpc2FibGVDb250cm9sczogaXNDb250cm9sc0Rpc2FibGVkIH0gPSB0aGlzO1xuICAgIGxldCBidXR0b25zID0gXCJcIjtcbiAgICBsZXQgZWxlbWVudENsYXNzZXMgPSBcIlwiO1xuICAgIGxldCBiYWNrZ3JvdW5kSW1hZ2UgPSBcIlwiO1xuICAgIGxldCBtYWluQXR0cmlidXRlID0gXCJcIjtcblxuICAgIGlmIChwYXRoKSB7XG4gICAgICBiYWNrZ3JvdW5kSW1hZ2UgPSBgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHtwYXRofSlcImA7XG4gICAgfVxuXG4gICAgaWYgKGF2YXRhclVybCkge1xuICAgICAgYmFja2dyb3VuZEltYWdlID0gYHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7YXZhdGFyVXJsfSlcImA7XG4gICAgfVxuXG4gICAgaWYgKG1haW4pIHtcbiAgICAgIG1haW5BdHRyaWJ1dGUgPSBgZGF0YS1tYWluPVwiJHttYWlufVwiYDtcbiAgICB9XG5cbiAgICBpZiAobWFpbiAmJiAhZW1wdHkpIHtcbiAgICAgIGVsZW1lbnRDbGFzc2VzID0gXCJ2Zy1waG90byB2Zy1waG90by0tbWFpblwiO1xuICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uIHZnLWJ1dHRvbi0tcmVkXCIgZGF0YS1hY3Rpb249XCJyZW1vdmUtcGhvdG9cIj7Qo9C00LDQu9C40YLRjDwvYnV0dG9uPlxuICAgICAgYDtcbiAgICB9IGVsc2UgaWYgKG1haW4gJiYgZW1wdHkpIHtcbiAgICAgIGVsZW1lbnRDbGFzc2VzID0gXCJ2Zy1waG90byB2Zy1waG90by0tbWFpblwiO1xuICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uXCIgZGF0YS1hY3Rpb249XCJ1cGxvYWQtcGhvdG9cIj7Ql9Cw0LPRgNGD0LfQuNGC0Yw8L2J1dHRvbj5cbiAgICAgIGA7XG4gICAgfSBlbHNlIGlmICghbWFpbiAmJiBlbXB0eSkge1xuICAgICAgZWxlbWVudENsYXNzZXMgPSBcInZnLWdhbGxlcnlfX2l0ZW0gdmctcGhvdG8gdmctcGhvdG8tLXVwbG9hZFwiO1xuICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uIHZnLWJ1dHRvbi0tdXBsb2FkXCIgZGF0YS1hY3Rpb249XCJ1cGxvYWQtcGhvdG9cIj4mIzQzOzwvYnV0dG9uPlxuICAgICAgYDtcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbWVudENsYXNzZXMgPSBcInZnLWdhbGxlcnlfX2l0ZW0gdmctcGhvdG9cIjtcbiAgICAgIGJ1dHRvbnMgPSBgXG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvbiB2Zy1idXR0b24tLWdyZWVuXCIgZGF0YS1hY3Rpb249XCJ1cGRhdGUtcGhvdG9cIj7QktGL0LHRgNCw0YLRjDwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS1yZWRcIiBkYXRhLWFjdGlvbj1cInJlbW92ZS1waG90b1wiPtCj0LTQsNC70LjRgtGMPC9idXR0b24+XG4gICAgICBgO1xuICAgIH1cblxuICAgIHJldHVybiBgXG4gICAgICA8ZGl2IGNsYXNzPVwiJHtlbGVtZW50Q2xhc3Nlc31cIlxuICAgICAgICAke2JhY2tncm91bmRJbWFnZX1cbiAgICAgICAgZGF0YS1waG90by1pZD1cIiR7cGhvdG9JZH1cIlxuICAgICAgICAke21haW5BdHRyaWJ1dGV9PlxuICAgICAgICAke2lzQ29udHJvbHNEaXNhYmxlZCA/IFwiXCIgOiBidXR0b25zfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIGA7XG4gIH1cblxuICAvKipcbiAgICog0JjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0YHQvtCx0YvRgtC40Lkg0LTQu9GPINC60L3QvtC/0L7QuiDQs9Cw0LvQtdGA0LXQuC5cbiAgICovXG4gIHN0YXRpYyBpbml0RXZlbnRzKCkge1xuICAgIGNvbnN0IHsgcm9vdEVsZW1lbnQgfSA9IHRoaXM7XG4gICAgY29uc3QgYnV0dG9ucyA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJidXR0b25cIik7XG5cbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICBcImNsaWNrXCIsXG4gICAgICAgIHRoaXMucm91dGVyW2J1dHRvbi5kYXRhc2V0LmFjdGlvbl0sXG4gICAgICAgIGZhbHNlXG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCg0L7Rg9GC0LXRgC5cbiAgICogQHR5cGUge3tcInJlbW92ZS1waG90b1wiOiBmdW5jdGlvbigqKTogdm9pZCwgXCJmaWxlLWlucHV0LWNoYW5nZWRcIjogZnVuY3Rpb24oKik6IHZvaWQsIFwidXBsb2FkLXBob3RvXCI6IGZ1bmN0aW9uKCopOiB2b2lkLCBcInVwZGF0ZS1waG90b1wiOiBmdW5jdGlvbigqKTogdm9pZH19XG4gICAqL1xuICBzdGF0aWMgcm91dGVyID0ge1xuICAgIC8qKlxuICAgICAqINCX0LDQs9GA0YPQt9C60LAg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAgICogQHBhcmFtIGUge0V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICBcInVwbG9hZC1waG90b1wiOiBlID0+IHtcbiAgICAgIGNvbnN0IGZpbGVJbnB1dCA9IHRoaXMucm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1cImZpbGVcIl0nKTtcblxuICAgICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgdGhpcy5yb3V0ZXJbXCJmaWxlLWlucHV0LWNoYW5nZWRcIl0pO1xuICAgICAgZmlsZUlucHV0LmNsaWNrKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDQodC70YPRiNCw0YLQtdC70Ywg0YHQvtCx0YvRgtC40Y8g0LjQt9C80LXQvdC10L3QuNGPINGE0LDQudC70L7QstC+0LPQviDQv9C+0LvRjyDQstCy0L7QtNCwLlxuICAgICAqIEBwYXJhbSBlIHtldmVudH0g0KHQvtCx0YvRgtC40LUuXG4gICAgICovXG4gICAgXCJmaWxlLWlucHV0LWNoYW5nZWRcIjogZSA9PiB7XG4gICAgICBjb25zdCBmaWxlID0gZS50YXJnZXQuZmlsZXNbMF07XG4gICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcblxuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5hZGRQaG90byhyZWFkZXIucmVzdWx0KS50aGVuKFxuICAgICAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfTtcblxuICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgIG1lc3NhZ2U6IHJlYWRlci5lcnJvcixcbiAgICAgICAgICBibG9ja2luZ0Vycm9yTWVzc2FnZTogYNCe0YjQuNCx0LrQsCDQt9Cw0LPRgNGD0LfQutC4INGE0L7RgtC+0LPRgNCw0YTQuNC4ICgt0LjQuSk6ICR7cmVhZGVyLmVycm9yfWBcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH0sXG4gICAgLyoqXG4gICAgICog0JfQsNC/0YDQvtGBINC90LAg0YPQtNCw0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICAgKiBAcGFyYW0gZSB7RXZlbnR9INCh0L7QsdGL0YLQuNC1LlxuICAgICAqL1xuICAgIFwicmVtb3ZlLXBob3RvXCI6IGUgPT4ge1xuICAgICAgY29uc3QgcGhvdG9FbGVtZW50ID0gZS50YXJnZXQuY2xvc2VzdChcIi52Zy1waG90b1wiKTtcbiAgICAgIGNvbnN0IHsgcGhvdG9JZCB9ID0gcGhvdG9FbGVtZW50LmRhdGFzZXQ7XG5cbiAgICAgIGlmICghIXBob3RvSWQpIHtcbiAgICAgICAgdGhpcy5kZWxldGVQaG90bygrcGhvdG9JZCkudGhlbihcbiAgICAgICAgICByZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICAqINCX0LDQv9GA0L7RgSDQvdCwINC+0LHQvdC+0LLQu9C10L3QuNC1INGE0L7RgtC+0LPRgNCw0YTQuNC4INGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgICAqIEBwYXJhbSBlIHtFdmVudH0g0KHQvtCx0YvRgtC40LUuXG4gICAgICovXG4gICAgXCJ1cGRhdGUtcGhvdG9cIjogZSA9PiB7XG4gICAgICBjb25zdCBwaG90b0VsZW1lbnQgPSBlLnRhcmdldC5jbG9zZXN0KFwiLnZnLXBob3RvXCIpO1xuICAgICAgY29uc3QgeyBwaG90b0lkIH0gPSBwaG90b0VsZW1lbnQuZGF0YXNldDtcblxuICAgICAgaWYgKCEhcGhvdG9JZCkge1xuICAgICAgICB0aGlzLnVwZGF0ZVBob3RvKCtwaG90b0lkKS50aGVuKFxuICAgICAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=