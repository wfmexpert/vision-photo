!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VisionPhotoGallery=e():t.VisionPhotoGallery=e()}(this,(function(){return function(){"use strict";var t={946:function(t,e,o){function n(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function r(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(Object(o),!0).forEach((function(e){s(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}o.d(e,{default:function(){return l}});var l=function(){function t(e){var o=e.root,n=e.employeeId,r=e.visionPersonId,i=e.token,a=e.disableControls,s=void 0!==a&&a;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!o)throw new Error("Не указан ID корневого элемента для галереи!");var l=document.getElementById(o);if(!l)throw new Error("Проверьте указанный ID корневого элемента для галереи!");if(t.rootElement=l,!n&&!r)throw new Error("Не указан ID пользователя на портале Vision");this.employeeId=n,this.visionPersonId=r,this.token=i,this.disableControls=s,t.draw()}var e,o,n;return e=t,n=[{key:"update",value:function(t){var e=t.employeeId,o=t.token;this.employeeId=e,this.token=o,this.draw()}},{key:"handleError",value:function(t){var e=t.message,o=t.blockingErrorMessage;if(this.errorFunction){var n="";"object"===i(e)&&Object.keys(e).reverse().forEach((function(t){n+="".concat(e[t],"<br/>")}));var r=n.length?n:JSON.stringify(e);this.errorFunction(r,"Ошибка")}else{if(o)throw new Error(o);console.log(e)}}},{key:"request",value:function(t){var e=t.requestPath,o=t.requestBody,n={method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":this.token},body:JSON.stringify(o)};return fetch("/api/v2/vision/".concat(e,"/"),n)}},{key:"getPhotos",value:function(){var t={};return this.employeeId&&!this.visionPersonId?t.employeeId=this.employeeId:this.visionPersonId&&(t.vision_person_id=this.visionPersonId),this.request({requestPath:"get_photos",requestBody:r(r({},t),{},{masterAlbum:!0})})}},{key:"addPhoto",value:function(t){return this.request({requestPath:"add_photo",requestBody:{employeeId:this.employeeId,image:t}})}},{key:"deletePhoto",value:function(t){return this.request({requestPath:"delete_photo",requestBody:{employeeId:this.employeeId,photoIds:[t],masterAlbum:!0}})}},{key:"updatePhoto",value:function(t){return this.request({requestPath:"update_photo",requestBody:{employeeId:this.employeeId,photo_id:t}})}},{key:"draw",value:function(){var t=this,e=this.rootElement;e.innerHTML='\n      <div class="vision-photo-gallery vision-photo-gallery--message" data-message="Загрузка...">\n        <input type="file" class="vision-photo-gallery__file-field" tabindex="-1">\n        <div class="vision-photo-gallery__item vision-photo-gallery__item--main">\n          <h4 class="vision-photo-gallery__title">Основная фотография</h4>\n          <div class="vg-main-photo"></div>\n        </div>\n        <div class="vision-photo-gallery__item">\n          <h4 class="vision-photo-gallery__title">Галерея</h4>\n          <div class="vg-gallery"></div>\n        </div>\n      </div>\n    ';var o=document.querySelector(".vision-photo-gallery"),n=e.querySelector(".vg-main-photo"),r=e.querySelector(".vg-gallery"),i=this.disableControls;this.getPhotos().then((function(e){if(n.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null}),r.innerHTML=t.createPhotoElement({main:!1,empty:!0,photoId:null}),e.ok)return e.json();n.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null}),t.initEvents()})).then((function(e){if(e){if(!e.length)return n.parentElement.classList.add("hidden"),r.parentElement.classList.add("hidden"),void(o.dataset.message="Нет фотографий");var a=e.find((function(t){return t.main})),s=e.filter((function(t){return!t.main}));if(a?n.innerHTML=t.createPhotoElement(a):n.parentElement.classList.add("hidden"),s.length){var l="";s.forEach((function(e){return l+=t.createPhotoElement(e)})),i||(l+=t.createPhotoElement({main:!1,empty:!0,photoId:null})),r.innerHTML=l}else r.parentElement.classList.add("hidden");t.initEvents(),o.classList.remove("vision-photo-gallery--message")}})).catch((function(e){t.handleError({message:e}),t.initEvents()})),this.initEvents()}},{key:"createPhotoElement",value:function(t){var e=t.photoId,o=t.main,n=t.empty,r=t.path,i=t.avatarUrl,a=this.disableControls,s="",l="",u="",c="";return r&&(u='style="background-image: url('.concat(r,')"')),i&&(u='style="background-image: url('.concat(i,')"')),o&&(c='data-main="'.concat(o,'"')),o&&!n?(l="vg-photo vg-photo--main",s='\n        <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n      '):o&&n?(l="vg-photo vg-photo--main",s='\n        <button class="vg-photo__button vg-button" data-action="upload-photo">Загрузить</button>\n      '):!o&&n?(l="vg-gallery__item vg-photo vg-photo--upload",s='\n        <button class="vg-photo__button vg-button vg-button--upload" data-action="upload-photo">&#43;</button>\n      '):(l="vg-gallery__item vg-photo",s='\n        <button class="vg-photo__button vg-button vg-button--green" data-action="update-photo">Выбрать</button>\n        <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n      '),'\n      <div class="'.concat(l,'"\n        ').concat(u,'\n        data-photo-id="').concat(e,'"\n        ').concat(c,">\n        ").concat(a?"":s,"\n        </div>\n      ")}},{key:"initEvents",value:function(){var t=this;this.rootElement.querySelectorAll("button").forEach((function(e){e.addEventListener("click",t.router[e.dataset.action],!1)}))}}],(o=[{key:"errorFunction",get:function(){return t.errorFunction},set:function(e){e&&(t.errorFunction=e)}},{key:"employeeId",get:function(){return t.employeeId},set:function(e){e&&(t.employeeId=e)}},{key:"visionPersonId",get:function(){return t.employeeId},set:function(e){e&&(t.visionPersonId=e)}},{key:"rootElement",get:function(){return t.rootElement}},{key:"token",get:function(){return t.token},set:function(e){e&&(t.token=e)}},{key:"disableControls",get:function(){return t.token},set:function(e){e&&(t.disableControls=e)}}])&&a(e.prototype,o),n&&a(e,n),t}();s(l,"employeeId",null),s(l,"visionPersonId",null),s(l,"rootElement",null),s(l,"token",null),s(l,"disableControls",!1),s(l,"errorFunction",null),s(l,"router",{"upload-photo":function(t){var e=l.rootElement.querySelector('input[type="file"]');e.addEventListener("change",l.router["file-input-changed"]),e.click()},"file-input-changed":function(t){var e=t.target.files[0],o=new FileReader;o.readAsDataURL(e),o.onload=function(){l.addPhoto(o.result).then((function(t){if(t.ok)l.draw();else if(200!==t.status)return t.json()})).then((function(t){200!==t.status&&l.handleError({message:t})}))},o.onerror=function(){l.handleError({message:o.error,blockingErrorMessage:"Ошибка загрузки фотографии (-ий): ".concat(o.error)})}},"remove-photo":function(t){var e=t.target.closest(".vg-photo").dataset.photoId;e&&l.deletePhoto(+e).then((function(t){if(t.ok)l.draw();else if(200!==t.status)return t.json()})).then((function(t){200!==t.status&&l.handleError({message:t})}))},"update-photo":function(t){var e=t.target.closest(".vg-photo").dataset.photoId;e&&l.updatePhoto(+e).then((function(t){if(t.ok)l.draw();else if(200!==t.status)return t.json()})).then((function(t){200!==t.status&&l.handleError({message:t})}))}})}},e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={exports:{}};return t[n](r,r.exports,o),r.exports}return o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o(946)}().default}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS8uL1Zpc2lvblBob3RvR2FsbGVyeS9pbmRleC5qcyIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vVmlzaW9uUGhvdG9HYWxsZXJ5L3dlYnBhY2svc3RhcnR1cCIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInRoaXMiLCJWaXNpb25QaG90b0dhbGxlcnkiLCJlbXBsb3llZUlkIiwidmlzaW9uUGVyc29uSWQiLCJ0b2tlbiIsImRpc2FibGVDb250cm9scyIsIkVycm9yIiwicm9vdEVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZHJhdyIsInBhcmFtcyIsIm1lc3NhZ2UiLCJibG9ja2luZ0Vycm9yTWVzc2FnZSIsImVycm9yRnVuY3Rpb24iLCJtZXNzYWdlU3RyaW5nIiwiT2JqZWN0Iiwia2V5cyIsInJldmVyc2UiLCJmb3JFYWNoIiwia2V5IiwiZXJyb3JNZXNzYWdlIiwibGVuZ3RoIiwiSlNPTiIsInN0cmluZ2lmeSIsImNvbnNvbGUiLCJsb2ciLCJyZXF1ZXN0UGF0aCIsInJlcXVlc3RCb2R5IiwicmVxdWVzdERlZmF1bHRzIiwibWV0aG9kIiwibW9kZSIsImNyZWRlbnRpYWxzIiwiaGVhZGVycyIsImJvZHkiLCJmZXRjaCIsImVtcGxveWVlIiwidmlzaW9uX3BlcnNvbl9pZCIsInJlcXVlc3QiLCJtYXN0ZXJBbGJ1bSIsImltYWdlIiwicGhvdG9JZCIsInBob3RvSWRzIiwicGhvdG9faWQiLCJpbm5lckhUTUwiLCJnYWxsZXJ5Q29udGFpbmVyIiwicXVlcnlTZWxlY3RvciIsIm1haW5QaG90b0NvbnRhaW5lciIsImdhbGxlcnkiLCJpc0NvbnRyb2xzRGlzYWJsZWQiLCJnZXRQaG90b3MiLCJ0aGVuIiwicmVzcG9uc2UiLCJjcmVhdGVQaG90b0VsZW1lbnQiLCJtYWluIiwiZW1wdHkiLCJvayIsImpzb24iLCJpbml0RXZlbnRzIiwicmVzcG9uc2VKc29uIiwicGFyZW50RWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImRhdGFzZXQiLCJtYWluUGhvdG9EYXRhIiwiZmluZCIsImdhbGxlcnlQaG90b3NEYXRhIiwiZmlsdGVyIiwiZ2FsbGVyeVBob3Rvc0h0bWwiLCJwaG90b0RhdGEiLCJyZW1vdmUiLCJjYXRjaCIsImVycm9yIiwiaGFuZGxlRXJyb3IiLCJwYXRoIiwiYXZhdGFyVXJsIiwiYnV0dG9ucyIsImVsZW1lbnRDbGFzc2VzIiwiYmFja2dyb3VuZEltYWdlIiwibWFpbkF0dHJpYnV0ZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwicm91dGVyIiwiYWN0aW9uIiwidmFsdWUiLCJlIiwiZmlsZUlucHV0IiwiY2xpY2siLCJmaWxlIiwidGFyZ2V0IiwiZmlsZXMiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwicmVhZEFzRGF0YVVSTCIsIm9ubG9hZCIsImFkZFBob3RvIiwicmVzdWx0Iiwic3RhdHVzIiwib25lcnJvciIsImNsb3Nlc3QiLCJkZWxldGVQaG90byIsInVwZGF0ZVBob3RvIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImQiLCJkZWZpbml0aW9uIiwibyIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9i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dW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIlZpc2lvblBob3RvR2FsbGVyeVwiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJWaXNpb25QaG90b0dhbGxlcnlcIl0gPSBmYWN0b3J5KCk7XG59KSh0aGlzLCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFwiLi9hcHAuc2Nzc1wiO1xuXG4vKipcbiAqINCa0LvQsNGB0YEg0LPQsNC70LXRgNC10LguXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZpc2lvblBob3RvR2FsbGVyeSB7XG4gIHN0YXRpYyBlbXBsb3llZUlkID0gbnVsbDtcbiAgc3RhdGljIHZpc2lvblBlcnNvbklkID0gbnVsbDtcbiAgc3RhdGljIHJvb3RFbGVtZW50ID0gbnVsbDtcbiAgc3RhdGljIHRva2VuID0gbnVsbDtcbiAgc3RhdGljIGRpc2FibGVDb250cm9scyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiDQmtC+0L3RgdGC0YDRg9C60YLQvtGAINGN0LrQt9C10LzQv9C70Y/RgNCwINC60LvQsNGB0YHQsCDQs9Cw0LvQtdGA0LXQuC5cbiAgICogQHBhcmFtIHJvb3Qge3N0cmluZ30gSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAsINC60YPQtNCwINCx0YPQtNC10YIg0YDQtdC90LTQtdGA0LjRgtGM0YHRjyDQs9Cw0LvQtdGA0LXRjy5cbiAgICogQHBhcmFtIGVtcGxveWVlSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcGFyYW0gdmlzaW9uUGVyc29uSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKiBAcGFyYW0gdG9rZW4ge3N0cmluZ30gQ1NSRi3RgtC+0LrQtdC9INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICogQHBhcmFtIGRpc2FibGVDb250cm9scyB7Ym9vbGVhbn0g0J7RgtC60LvRjtGH0LjRgtGMINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0LfQsNCz0YDRg9C30LrQuCwg0L7QsdC90L7QstC70LXQvdC40Y8g0Lgg0YPQtNCw0LvQtdC90LjRjyDRhNC+0YLQvtCz0YDQsNGE0LjQuS5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHtcbiAgICByb290LFxuICAgIGVtcGxveWVlSWQsXG4gICAgdmlzaW9uUGVyc29uSWQsXG4gICAgdG9rZW4sXG4gICAgZGlzYWJsZUNvbnRyb2xzID0gZmFsc2VcbiAgfSkge1xuICAgIGlmICghcm9vdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwi0J3QtSDRg9C60LDQt9Cw0L0gSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAg0LTQu9GPINCz0LDQu9C10YDQtdC4IVwiKTtcbiAgICB9XG5cbiAgICBjb25zdCByb290RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJvb3QpO1xuXG4gICAgaWYgKCEhcm9vdEVsZW1lbnQpIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS5yb290RWxlbWVudCA9IHJvb3RFbGVtZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCLQn9GA0L7QstC10YDRjNGC0LUg0YPQutCw0LfQsNC90L3Ri9C5IElEINC60L7RgNC90LXQstC+0LPQviDRjdC70LXQvNC10L3RgtCwINC00LvRjyDQs9Cw0LvQtdGA0LXQuCFcIik7XG4gICAgfVxuXG4gICAgaWYgKCFlbXBsb3llZUlkICYmICF2aXNpb25QZXJzb25JZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwi0J3QtSDRg9C60LDQt9Cw0L0gSUQg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uXCIpO1xuICAgIH1cblxuICAgIHRoaXMuZW1wbG95ZWVJZCA9IGVtcGxveWVlSWQ7XG4gICAgdGhpcy52aXNpb25QZXJzb25JZCA9IHZpc2lvblBlcnNvbklkO1xuICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcbiAgICB0aGlzLmRpc2FibGVDb250cm9scyA9IGRpc2FibGVDb250cm9scztcblxuICAgIFZpc2lvblBob3RvR2FsbGVyeS5kcmF3KCk7XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LDQtdC80YvQuSDQvNC10YLQvtC0INC00LvRjyDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICogQHR5cGUge251bGx8RnVuY3Rpb259INCk0YPQvdC60YbQuNGPINC+0LHRgNCw0LHQvtGC0YfQuNC6INC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKi9cbiAgc3RhdGljIGVycm9yRnVuY3Rpb24gPSBudWxsO1xuICAvKipcbiAgICog0J/QvtC70YPRh9C10L3QuNC1INC80LXRgtC+0LTQsCDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqIEB0eXBlIHtudWxsfEZ1bmN0aW9ufSDQpNGD0L3QutGG0LjRjyDQvtCx0YDQsNCx0L7RgtGH0LjQuiDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICovXG4gIGdldCBlcnJvckZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZXJyb3JGdW5jdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDQvNC10YLQvtC00LAg0LTQu9GPINC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKiBAcGFyYW0gZXJyb3JGdW5jdGlvbiB7bnVsbHxGdW5jdGlvbn0g0KTRg9C90LrRhtC40Y8g0L7QsdGA0LDQsdC+0YLRh9C40Log0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqL1xuICBzZXQgZXJyb3JGdW5jdGlvbihlcnJvckZ1bmN0aW9uKSB7XG4gICAgaWYgKGVycm9yRnVuY3Rpb24pIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS5lcnJvckZ1bmN0aW9uID0gZXJyb3JGdW5jdGlvbjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J7QsdC90L7QstC70LXQvdC40LUg0L/QsNGA0LDQvNC10YLRgNC+0LIg0LPQsNC70LXRgNC10LguXG4gICAqIEBwYXJhbSBlbXBsb3llZUlkIHtudW1iZXJ8bnVtYmVyfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIHRva2VuIHtzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICovXG4gIHN0YXRpYyB1cGRhdGUoeyBlbXBsb3llZUlkLCB0b2tlbiB9KSB7XG4gICAgdGhpcy5lbXBsb3llZUlkID0gZW1wbG95ZWVJZDtcbiAgICB0aGlzLnRva2VuID0gdG9rZW47XG5cbiAgICB0aGlzLmRyYXcoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LjRgtGMIElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICovXG4gIGdldCBlbXBsb3llZUlkKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZW1wbG95ZWVJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDRjdC60LfQtdC80L/Qu9GP0YDRgyDQs9Cw0LvQtdGA0LXQuCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIGVtcGxveWVlSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKi9cbiAgc2V0IGVtcGxveWVlSWQoZW1wbG95ZWVJZCkge1xuICAgIGlmIChlbXBsb3llZUlkKSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkuZW1wbG95ZWVJZCA9IGVtcGxveWVlSWQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0YwgSUQg0YHQvtGC0YDRg9C00L3QuNC60LAg0LDRg9GC0YHQvtGA0YHQtdGA0LAuXG4gICAqIEByZXR1cm4ge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKi9cbiAgZ2V0IHZpc2lvblBlcnNvbklkKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZW1wbG95ZWVJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDRjdC60LfQtdC80L/Qu9GP0YDRgyDQs9Cw0LvQtdGA0LXQuCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICogQHBhcmFtIHZpc2lvblBlcnNvbklkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICovXG4gIHNldCB2aXNpb25QZXJzb25JZCh2aXNpb25QZXJzb25JZCkge1xuICAgIGlmICh2aXNpb25QZXJzb25JZCkge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LnZpc2lvblBlcnNvbklkID0gdmlzaW9uUGVyc29uSWQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCa0L7RgNC90LXQstC+0Lkg0Y3Qu9C10LzQtdC90YIsINCyINC60L7RgtC+0YDRi9C5INCx0YPQtNC10YIg0YDQtdC90LTQtdGA0LjRgtGM0YHRjyDQs9Cw0LvQtdGA0LXRjy5cbiAgICogQHJldHVybiB7bnVsbHxFbGVtZW50fSDQmtC+0YDQvdC10LLQvtC5INGN0LvQtdC80LXQvdGCINC00LvRjyDRgNC10L3QtNC10YDQsC5cbiAgICovXG4gIGdldCByb290RWxlbWVudCgpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LnJvb3RFbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0YwgQ1NSRi3RgtC+0LrQtdC9INGB0LXRgdGB0LjQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8uXG4gICAqIEByZXR1cm4ge251bGx8c3RyaW5nfSBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICovXG4gIGdldCB0b2tlbigpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LnRva2VuO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C40YLRjCBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICogQHBhcmFtIHRva2VuIHtzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC40Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPLlxuICAgKi9cbiAgc2V0IHRva2VuKHRva2VuKSB7XG4gICAgaWYgKHRva2VuKSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkudG9rZW4gPSB0b2tlbjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J/QvtC70YPRh9C40YLRjCDQt9C90LDRh9C10L3QuNC1INGB0L7RgdGC0L7Rj9C90LjRjyDQutC+0L3RgtGA0L7Qu9C+0LIuXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59INCh0L7RgdGC0L7Rj9C90LjQtSDQutC+0L3RgtGA0L7Qu9C+0LIuXG4gICAqL1xuICBnZXQgZGlzYWJsZUNvbnRyb2xzKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkudG9rZW47XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LjRgtGMIENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC40Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPLlxuICAgKiBAcGFyYW0gdmFsdWUge2Jvb2xlYW59INCS0LrQu9GO0YfQuNGC0Ywv0L7RgtC60LvRjtGH0LjRgtGMINC60L7QvdGC0YDQvtC70YsuXG4gICAqL1xuICBzZXQgZGlzYWJsZUNvbnRyb2xzKHZhbHVlKSB7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkuZGlzYWJsZUNvbnRyb2xzID0gdmFsdWU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCe0LHRgNCw0LHQvtGC0YfQuNC6INC+0YjQuNCx0L7Qui5cbiAgICogQHBhcmFtIHBhcmFtcy5tZXNzYWdlIHtzdHJpbmd9INCh0L7QvtCx0YnQtdC90LjQtSDQvtCxINC+0YjQuNCx0LrQtS5cbiAgICogQHBhcmFtIHBhcmFtcy5ibG9ja2luZ0Vycm9yTWVzc2FnZSB7c3RyaW5nfSDQkdC70L7QutC40YDRg9GO0YnQtdC1INC/0L7RgtC+0Log0YHQvtC+0LHRidC10L3QuNC1INC+0LEg0L7RiNC40LHQutC1LlxuICAgKi9cbiAgc3RhdGljIGhhbmRsZUVycm9yKHBhcmFtcykge1xuICAgIGNvbnN0IHsgbWVzc2FnZSwgYmxvY2tpbmdFcnJvck1lc3NhZ2UgfSA9IHBhcmFtcztcblxuICAgIGlmICh0aGlzLmVycm9yRnVuY3Rpb24pIHtcbiAgICAgIGxldCBtZXNzYWdlU3RyaW5nID0gXCJcIjtcblxuICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKG1lc3NhZ2UpXG4gICAgICAgICAgLnJldmVyc2UoKVxuICAgICAgICAgIC5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICBtZXNzYWdlU3RyaW5nICs9IGAke21lc3NhZ2Vba2V5XX08YnIvPmA7XG4gICAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IG1lc3NhZ2VTdHJpbmcubGVuZ3RoXG4gICAgICAgID8gbWVzc2FnZVN0cmluZ1xuICAgICAgICA6IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpO1xuXG4gICAgICB0aGlzLmVycm9yRnVuY3Rpb24oZXJyb3JNZXNzYWdlLCBcItCe0YjQuNCx0LrQsFwiKTtcbiAgICB9IGVsc2UgaWYgKGJsb2NraW5nRXJyb3JNZXNzYWdlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYmxvY2tpbmdFcnJvck1lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J7QsdGR0YDRgtC60LAg0LTQu9GPINC30LDQv9GA0L7RgdC+0LIg0LogQVBJLlxuICAgKiBAcGFyYW0gcmVxdWVzdFBhdGgge3N0cmluZ30g0J3QsNC30LLQsNC90LjQtSDQvNC10YLQvtC00LAgQVBJLlxuICAgKiBAcGFyYW0gcmVxdWVzdEJvZHkge29iamVjdH0g0J/QsNGA0LDQvNC10YLRgNGLINC30LDQv9GA0L7RgdCwLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDQt9Cw0L/RgNC+0YHQsC5cbiAgICovXG4gIHN0YXRpYyByZXF1ZXN0KHsgcmVxdWVzdFBhdGgsIHJlcXVlc3RCb2R5IH0pIHtcbiAgICBjb25zdCByZXF1ZXN0RGVmYXVsdHMgPSB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgbW9kZTogXCJzYW1lLW9yaWdpblwiLFxuICAgICAgY3JlZGVudGlhbHM6IFwic2FtZS1vcmlnaW5cIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIFwiWC1DU1JGVG9rZW5cIjogdGhpcy50b2tlblxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KVxuICAgIH07XG5cbiAgICByZXR1cm4gZmV0Y2goYC9hcGkvdjIvdmlzaW9uLyR7cmVxdWVzdFBhdGh9L2AsIHJlcXVlc3REZWZhdWx0cyk7XG4gIH1cblxuICAvKipcbiAgICog0JLRi9Cz0YDRg9C30LrQsCDQstGB0LXRhSDRhNC+0YLQvtCz0YDQsNGE0LjQuSDRgSDQv9C+0YDRgtCw0LvQsCBWaXNpb24uXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINGBINGA0LXQt9GD0LvRjNGC0LDRgtC+0Lwg0LLRi9C/0L7Qu9C90LXQvdC40Y8g0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgZ2V0UGhvdG9zKCkge1xuICAgIGNvbnN0IGVtcGxveWVlID0ge307XG5cbiAgICBpZiAodGhpcy5lbXBsb3llZUlkICYmICF0aGlzLnZpc2lvblBlcnNvbklkKSB7XG4gICAgICBlbXBsb3llZS5lbXBsb3llZUlkID0gdGhpcy5lbXBsb3llZUlkO1xuICAgIH0gZWxzZSBpZiAodGhpcy52aXNpb25QZXJzb25JZCkge1xuICAgICAgZW1wbG95ZWUudmlzaW9uX3BlcnNvbl9pZCA9IHRoaXMudmlzaW9uUGVyc29uSWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh7XG4gICAgICByZXF1ZXN0UGF0aDogXCJnZXRfcGhvdG9zXCIsXG4gICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICAuLi5lbXBsb3llZSxcbiAgICAgICAgbWFzdGVyQWxidW06IHRydWVcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDQtNC+0LHQsNCy0LvQtdC90LjQtSAo0LfQsNCz0YDRg9C30LrRgykg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBpbWFnZSB7QnVmZmVyRW5jb2Rpbmd9INCk0L7RgtC+0LPRgNCw0YTQuNC4INCyINGE0L7RgNC80LDRgtC1IEJhc2U2NC5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0YEg0YDQtdC30YPQu9GM0YLQsNGC0L7QvCDQstGL0L/QvtC70L3QtdC90LjRjyDQt9Cw0L/RgNC+0YHQsC5cbiAgICovXG4gIHN0YXRpYyBhZGRQaG90byhpbWFnZSkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgcmVxdWVzdFBhdGg6IFwiYWRkX3Bob3RvXCIsXG4gICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICBlbXBsb3llZUlkOiB0aGlzLmVtcGxveWVlSWQsXG4gICAgICAgIGltYWdlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0JfQsNC/0YDQvtGBINC90LAg0YPQtNCw0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHBhcmFtIHBob3RvSWQge051bWJlcn0gSUQg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0L3QsCDQv9C+0YDRgtCw0LvQtSBWaXNpb24uXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINGBINGA0LXQt9GD0LvRjNGC0LDRgtC+0Lwg0LLRi9C/0L7Qu9C90LXQvdC40Y8g0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgZGVsZXRlUGhvdG8ocGhvdG9JZCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgcmVxdWVzdFBhdGg6IFwiZGVsZXRlX3Bob3RvXCIsXG4gICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICBlbXBsb3llZUlkOiB0aGlzLmVtcGxveWVlSWQsXG4gICAgICAgIHBob3RvSWRzOiBbcGhvdG9JZF0sXG4gICAgICAgIG1hc3RlckFsYnVtOiB0cnVlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0JfQsNC/0YDQvtGBINC90LAg0L7QsdC90L7QstC70LXQvdC40LUg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwaG90b0lkIHtOdW1iZXJ9IElEINGE0L7RgtC+0LPRgNCw0YTQuNC4INC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIHVwZGF0ZVBob3RvKHBob3RvSWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiBcInVwZGF0ZV9waG90b1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgZW1wbG95ZWVJZDogdGhpcy5lbXBsb3llZUlkLFxuICAgICAgICBwaG90b19pZDogcGhvdG9JZFxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCe0YLRgNC40YHQvtCy0LrQsCBET00g0LPQsNC70LXRgNC10LjQuC5cbiAgICovXG4gIHN0YXRpYyBkcmF3KCkge1xuICAgIGNvbnN0IHJvb3RFbGVtZW50ID0gdGhpcy5yb290RWxlbWVudDtcblxuICAgIHJvb3RFbGVtZW50LmlubmVySFRNTCA9IGBcbiAgICAgIDxkaXYgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeSB2aXNpb24tcGhvdG8tZ2FsbGVyeS0tbWVzc2FnZVwiIGRhdGEtbWVzc2FnZT1cItCX0LDQs9GA0YPQt9C60LAuLi5cIj5cbiAgICAgICAgPGlucHV0IHR5cGU9XCJmaWxlXCIgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9fZmlsZS1maWVsZFwiIHRhYmluZGV4PVwiLTFcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X19pdGVtIHZpc2lvbi1waG90by1nYWxsZXJ5X19pdGVtLS1tYWluXCI+XG4gICAgICAgICAgPGg0IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX3RpdGxlXCI+0J7RgdC90L7QstC90LDRjyDRhNC+0YLQvtCz0YDQsNGE0LjRjzwvaDQ+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInZnLW1haW4tcGhvdG9cIj48L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9faXRlbVwiPlxuICAgICAgICAgIDxoNCBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X190aXRsZVwiPtCT0LDQu9C10YDQtdGPPC9oND5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidmctZ2FsbGVyeVwiPjwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICBjb25zdCBnYWxsZXJ5Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi52aXNpb24tcGhvdG8tZ2FsbGVyeVwiKTtcbiAgICBjb25zdCBtYWluUGhvdG9Db250YWluZXIgPSByb290RWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnZnLW1haW4tcGhvdG9cIik7XG4gICAgY29uc3QgZ2FsbGVyeSA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmctZ2FsbGVyeVwiKTtcbiAgICBjb25zdCB7IGRpc2FibGVDb250cm9sczogaXNDb250cm9sc0Rpc2FibGVkIH0gPSB0aGlzO1xuXG4gICAgdGhpcy5nZXRQaG90b3MoKVxuICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICBtYWluUGhvdG9Db250YWluZXIuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQoe1xuICAgICAgICAgIG1haW46IHRydWUsXG4gICAgICAgICAgZW1wdHk6IHRydWUsXG4gICAgICAgICAgcGhvdG9JZDogbnVsbFxuICAgICAgICB9KTtcblxuICAgICAgICBnYWxsZXJ5LmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHtcbiAgICAgICAgICBtYWluOiBmYWxzZSxcbiAgICAgICAgICBlbXB0eTogdHJ1ZSxcbiAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHtcbiAgICAgICAgICAgIG1haW46IHRydWUsXG4gICAgICAgICAgICBlbXB0eTogdHJ1ZSxcbiAgICAgICAgICAgIHBob3RvSWQ6IG51bGxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKHJlc3BvbnNlSnNvbiA9PiB7XG4gICAgICAgIGlmICghcmVzcG9uc2VKc29uKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyZXNwb25zZUpzb24ubGVuZ3RoKSB7XG4gICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICBnYWxsZXJ5LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICBnYWxsZXJ5Q29udGFpbmVyLmRhdGFzZXQubWVzc2FnZSA9IFwi0J3QtdGCINGE0L7RgtC+0LPRgNCw0YTQuNC5XCI7XG5cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtYWluUGhvdG9EYXRhID0gcmVzcG9uc2VKc29uLmZpbmQoKHsgbWFpbiB9KSA9PiBtYWluKTtcbiAgICAgICAgY29uc3QgZ2FsbGVyeVBob3Rvc0RhdGEgPSByZXNwb25zZUpzb24uZmlsdGVyKCh7IG1haW4gfSkgPT4gIW1haW4pO1xuXG4gICAgICAgIGlmICghIW1haW5QaG90b0RhdGEpIHtcbiAgICAgICAgICBtYWluUGhvdG9Db250YWluZXIuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQobWFpblBob3RvRGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChnYWxsZXJ5UGhvdG9zRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICBsZXQgZ2FsbGVyeVBob3Rvc0h0bWwgPSBcIlwiO1xuXG4gICAgICAgICAgZ2FsbGVyeVBob3Rvc0RhdGEuZm9yRWFjaChcbiAgICAgICAgICAgIHBob3RvRGF0YSA9PlxuICAgICAgICAgICAgICAoZ2FsbGVyeVBob3Rvc0h0bWwgKz0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQocGhvdG9EYXRhKSlcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKCFpc0NvbnRyb2xzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgIGdhbGxlcnlQaG90b3NIdG1sICs9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHtcbiAgICAgICAgICAgICAgbWFpbjogZmFsc2UsXG4gICAgICAgICAgICAgIGVtcHR5OiB0cnVlLFxuICAgICAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBnYWxsZXJ5LmlubmVySFRNTCA9IGdhbGxlcnlQaG90b3NIdG1sO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGdhbGxlcnkucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgICAgIGdhbGxlcnlDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcInZpc2lvbi1waG90by1nYWxsZXJ5LS1tZXNzYWdlXCIpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgfSk7XG5cbiAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQo9C90LjQstC10YDRgdCw0LvRjNC90YvQuSDQvNC10YLQvtC0INC00LvRjyDRgdC+0LfQtNCw0L3QuNGPINGN0LvQtdC80LXQvdGC0LAg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwYXJhbXMucGhvdG9JZCB7bnVtYmVyfSBJRCDRhNC+0YLQvtCz0YDQsNGE0LjQuCDQvdCwINC/0L7RgNGC0LDQu9C1IFZpc2lvbi5cbiAgICogQHBhcmFtIHBhcmFtcy5tYWluIHtib29sZWFufSAg0KTQu9Cw0LMg0L7RgdC90L7QstC90L7Qs9C+INGE0L7RgtC+LlxuICAgKiBAcGFyYW0gcGFyYW1zLmVtcHR5IHtib29sZWFufSDQpNC70LDQsyBcItC/0YPRgdGC0L7Qs9C+XCIg0YTQvtGC0L4sINC40YHQv9C+0LvRjNC30YPQtdGC0YHRjyDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQutC90L7Qv9C60Lgg0LfQsNCz0YDRg9C30LrQuC5cbiAgICogQHBhcmFtIHBhcmFtcy5wYXRoIHtzdHJpbmd9INCf0YPRgtGMINC6INGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gcGFyYW1zLmF2YXRhclVybCB7c3RyaW5nfSDQn9GD0YLRjCDQuiDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHJldHVybnMge3N0cmluZ30g0K3Qu9C10LzQtdC90YIg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0LIg0LLQuNC00LUg0YHRgtGA0L7QutC4LlxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZVBob3RvRWxlbWVudChwYXJhbXMpIHtcbiAgICBjb25zdCB7IHBob3RvSWQsIG1haW4sIGVtcHR5LCBwYXRoLCBhdmF0YXJVcmwgfSA9IHBhcmFtcztcbiAgICBjb25zdCB7IGRpc2FibGVDb250cm9sczogaXNDb250cm9sc0Rpc2FibGVkIH0gPSB0aGlzO1xuICAgIGxldCBidXR0b25zID0gXCJcIjtcbiAgICBsZXQgZWxlbWVudENsYXNzZXMgPSBcIlwiO1xuICAgIGxldCBiYWNrZ3JvdW5kSW1hZ2UgPSBcIlwiO1xuICAgIGxldCBtYWluQXR0cmlidXRlID0gXCJcIjtcblxuICAgIGlmIChwYXRoKSB7XG4gICAgICBiYWNrZ3JvdW5kSW1hZ2UgPSBgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHtwYXRofSlcImA7XG4gICAgfVxuXG4gICAgaWYgKGF2YXRhclVybCkge1xuICAgICAgYmFja2dyb3VuZEltYWdlID0gYHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7YXZhdGFyVXJsfSlcImA7XG4gICAgfVxuXG4gICAgaWYgKG1haW4pIHtcbiAgICAgIG1haW5BdHRyaWJ1dGUgPSBgZGF0YS1tYWluPVwiJHttYWlufVwiYDtcbiAgICB9XG5cbiAgICBpZiAobWFpbiAmJiAhZW1wdHkpIHtcbiAgICAgIGVsZW1lbnRDbGFzc2VzID0gXCJ2Zy1waG90byB2Zy1waG90by0tbWFpblwiO1xuICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uIHZnLWJ1dHRvbi0tcmVkXCIgZGF0YS1hY3Rpb249XCJyZW1vdmUtcGhvdG9cIj7Qo9C00LDQu9C40YLRjDwvYnV0dG9uPlxuICAgICAgYDtcbiAgICB9IGVsc2UgaWYgKG1haW4gJiYgZW1wdHkpIHtcbiAgICAgIGVsZW1lbnRDbGFzc2VzID0gXCJ2Zy1waG90byB2Zy1waG90by0tbWFpblwiO1xuICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uXCIgZGF0YS1hY3Rpb249XCJ1cGxvYWQtcGhvdG9cIj7Ql9Cw0LPRgNGD0LfQuNGC0Yw8L2J1dHRvbj5cbiAgICAgIGA7XG4gICAgfSBlbHNlIGlmICghbWFpbiAmJiBlbXB0eSkge1xuICAgICAgZWxlbWVudENsYXNzZXMgPSBcInZnLWdhbGxlcnlfX2l0ZW0gdmctcGhvdG8gdmctcGhvdG8tLXVwbG9hZFwiO1xuICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uIHZnLWJ1dHRvbi0tdXBsb2FkXCIgZGF0YS1hY3Rpb249XCJ1cGxvYWQtcGhvdG9cIj4mIzQzOzwvYnV0dG9uPlxuICAgICAgYDtcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbWVudENsYXNzZXMgPSBcInZnLWdhbGxlcnlfX2l0ZW0gdmctcGhvdG9cIjtcbiAgICAgIGJ1dHRvbnMgPSBgXG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvbiB2Zy1idXR0b24tLWdyZWVuXCIgZGF0YS1hY3Rpb249XCJ1cGRhdGUtcGhvdG9cIj7QktGL0LHRgNCw0YLRjDwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS1yZWRcIiBkYXRhLWFjdGlvbj1cInJlbW92ZS1waG90b1wiPtCj0LTQsNC70LjRgtGMPC9idXR0b24+XG4gICAgICBgO1xuICAgIH1cblxuICAgIHJldHVybiBgXG4gICAgICA8ZGl2IGNsYXNzPVwiJHtlbGVtZW50Q2xhc3Nlc31cIlxuICAgICAgICAke2JhY2tncm91bmRJbWFnZX1cbiAgICAgICAgZGF0YS1waG90by1pZD1cIiR7cGhvdG9JZH1cIlxuICAgICAgICAke21haW5BdHRyaWJ1dGV9PlxuICAgICAgICAke2lzQ29udHJvbHNEaXNhYmxlZCA/IFwiXCIgOiBidXR0b25zfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIGA7XG4gIH1cblxuICAvKipcbiAgICog0JjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0YHQvtCx0YvRgtC40Lkg0LTQu9GPINC60L3QvtC/0L7QuiDQs9Cw0LvQtdGA0LXQuC5cbiAgICovXG4gIHN0YXRpYyBpbml0RXZlbnRzKCkge1xuICAgIGNvbnN0IHsgcm9vdEVsZW1lbnQgfSA9IHRoaXM7XG4gICAgY29uc3QgYnV0dG9ucyA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJidXR0b25cIik7XG5cbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICBcImNsaWNrXCIsXG4gICAgICAgIHRoaXMucm91dGVyW2J1dHRvbi5kYXRhc2V0LmFjdGlvbl0sXG4gICAgICAgIGZhbHNlXG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCg0L7Rg9GC0LXRgC5cbiAgICogQHR5cGUge3tcInJlbW92ZS1waG90b1wiOiBmdW5jdGlvbigqKTogdm9pZCwgXCJmaWxlLWlucHV0LWNoYW5nZWRcIjogZnVuY3Rpb24oKik6IHZvaWQsIFwidXBsb2FkLXBob3RvXCI6IGZ1bmN0aW9uKCopOiB2b2lkLCBcInVwZGF0ZS1waG90b1wiOiBmdW5jdGlvbigqKTogdm9pZH19XG4gICAqL1xuICBzdGF0aWMgcm91dGVyID0ge1xuICAgIC8qKlxuICAgICAqINCX0LDQs9GA0YPQt9C60LAg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAgICogQHBhcmFtIGUge0V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICBcInVwbG9hZC1waG90b1wiOiBlID0+IHtcbiAgICAgIGNvbnN0IGZpbGVJbnB1dCA9IHRoaXMucm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1cImZpbGVcIl0nKTtcblxuICAgICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgdGhpcy5yb3V0ZXJbXCJmaWxlLWlucHV0LWNoYW5nZWRcIl0pO1xuICAgICAgZmlsZUlucHV0LmNsaWNrKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDQodC70YPRiNCw0YLQtdC70Ywg0YHQvtCx0YvRgtC40Y8g0LjQt9C80LXQvdC10L3QuNGPINGE0LDQudC70L7QstC+0LPQviDQv9C+0LvRjyDQstCy0L7QtNCwLlxuICAgICAqIEBwYXJhbSBlIHtldmVudH0g0KHQvtCx0YvRgtC40LUuXG4gICAgICovXG4gICAgXCJmaWxlLWlucHV0LWNoYW5nZWRcIjogZSA9PiB7XG4gICAgICBjb25zdCBmaWxlID0gZS50YXJnZXQuZmlsZXNbMF07XG4gICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcblxuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5hZGRQaG90byhyZWFkZXIucmVzdWx0KVxuICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXNwb25zZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHJlYWRlci5vbmVycm9yID0gKCkgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHtcbiAgICAgICAgICBtZXNzYWdlOiByZWFkZXIuZXJyb3IsXG4gICAgICAgICAgYmxvY2tpbmdFcnJvck1lc3NhZ2U6IGDQntGI0LjQsdC60LAg0LfQsNCz0YDRg9C30LrQuCDRhNC+0YLQvtCz0YDQsNGE0LjQuCAoLdC40LkpOiAke3JlYWRlci5lcnJvcn1gXG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqINCX0LDQv9GA0L7RgSDQvdCwINGD0LTQsNC70LXQvdC40LUg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAgICogQHBhcmFtIGUge0V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICBcInJlbW92ZS1waG90b1wiOiBlID0+IHtcbiAgICAgIGNvbnN0IHBob3RvRWxlbWVudCA9IGUudGFyZ2V0LmNsb3Nlc3QoXCIudmctcGhvdG9cIik7XG4gICAgICBjb25zdCB7IHBob3RvSWQgfSA9IHBob3RvRWxlbWVudC5kYXRhc2V0O1xuXG4gICAgICBpZiAoISFwaG90b0lkKSB7XG4gICAgICAgIHRoaXMuZGVsZXRlUGhvdG8oK3Bob3RvSWQpXG4gICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgLyoqXG4gICAgICog0JfQsNC/0YDQvtGBINC90LAg0L7QsdC90L7QstC70LXQvdC40LUg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAgICogQHBhcmFtIGUge0V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICBcInVwZGF0ZS1waG90b1wiOiBlID0+IHtcbiAgICAgIGNvbnN0IHBob3RvRWxlbWVudCA9IGUudGFyZ2V0LmNsb3Nlc3QoXCIudmctcGhvdG9cIik7XG4gICAgICBjb25zdCB7IHBob3RvSWQgfSA9IHBob3RvRWxlbWVudC5kYXRhc2V0O1xuXG4gICAgICBpZiAoISFwaG90b0lkKSB7XG4gICAgICAgIHRoaXMudXBkYXRlUGhvdG8oK3Bob3RvSWQpXG4gICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn1cbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdGlmKF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0pIHtcblx0XHRyZXR1cm4gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gbW9kdWxlIGV4cG9ydHMgbXVzdCBiZSByZXR1cm5lZCBmcm9tIHJ1bnRpbWUgc28gZW50cnkgaW5saW5pbmcgaXMgZGlzYWJsZWRcbi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xucmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oOTQ2KTtcbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIGRlZmluaXRpb24pIHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqLCBwcm9wKSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsgfSJdLCJzb3VyY2VSb290IjoiIn0=