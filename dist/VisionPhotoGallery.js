!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VisionPhotoGallery=t():e.VisionPhotoGallery=t()}(this,(function(){return function(){"use strict";var e={d:function(t,o){for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}e.d(t,{default:function(){return a}});var a=function(){function e(t){var o=t.root,n=t.employeeId,r=t.visionPersonId,i=t.personId,s=t.token,a=t.controls,l=t.masterAlbum,u=void 0===l||l;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!o)throw new Error("Не указан ID корневого элемента для галереи!");var c=document.getElementById(o);if(!c)throw new Error("Проверьте указанный ID корневого элемента для галереи!");if(e.rootElement=c,!n&&!r&&!i)throw new Error("Не указан ID пользователя на портале Vision");this.employeeId=n,this.visionPersonId=r,this.personId=i,this.token=s,this.controls=a,this.masterAlbum=u,e.draw()}var t,n,s;return t=e,s=[{key:"update",value:function(e){var t=e.employeeId,o=e.token;this.employeeId=t,this.token=o,this.draw()}},{key:"handleError",value:function(e){var t=e.message,n=e.blockingErrorMessage;if(this.errorFunction){var r="";"object"===o(t)&&(t.faultstring?r=t.faultstring:Object.keys(t).reverse().forEach((function(e){r+="".concat(t[e],"<br/>")})));var i=r.length?r:JSON.stringify(t);this.errorFunction(i,"Ошибка")}else{if(n)throw new Error(n);console.log(t)}}},{key:"request",value:function(e){var t=e.requestPath,o=e.requestBody,n={method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":this.token},body:JSON.stringify(o)};return fetch("/api/v2/vision/".concat(t,"/"),n)}},{key:"getPhotos",value:function(){var e={};return this.employeeId&&!this.visionPersonId?e.employeeId=this.employeeId:this.visionPersonId?e.vision_person_id=this.visionPersonId:this.personId&&(e.personId=this.personId),this.request({requestPath:"get_photos",requestBody:r(r({},e),{},{masterAlbum:this.masterAlbum})})}},{key:"addPhoto",value:function(e){return this.toggleOverlayMessage("Загрузка..."),this.request({requestPath:"add_photo",requestBody:{employeeId:this.employeeId,image:e}})}},{key:"deletePhoto",value:function(e){return this.toggleOverlayMessage("Удаление фотографии..."),this.request({requestPath:"delete_photo",requestBody:{photo_id:e}})}},{key:"updatePhoto",value:function(e){return this.toggleOverlayMessage("Обновление фотографии..."),this.request({requestPath:"update_photo",requestBody:{employeeId:this.employeeId,photo_id:e}})}},{key:"setAsMainPhoto",value:function(e){return this.toggleOverlayMessage("Обновление основной фотографии..."),this.request({requestPath:"set_main_photo",requestBody:{employeeId:this.employeeId,photoId:e}})}},{key:"toggleOverlayMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.galleryContainer;if(!t)throw new Error("Не найдена корневой элемент галереи");e?(t.dataset.message=e,t.classList.add("vision-photo-gallery--message")):(t.classList.remove("vision-photo-gallery--message"),t.dataset.message="")}},{key:"draw",value:function(){var e=this,t=this.rootElement;t.innerHTML='\n      <div class="vision-photo-gallery">\n        <input type="file" class="vision-photo-gallery__file-field" tabindex="-1">\n        <div class="vision-photo-gallery__item vision-photo-gallery__item--main">\n          <div class="vg-main-photo"></div>\n        </div>\n        <div class="vision-photo-gallery__item">\n          <div class="vg-gallery"></div>\n        </div>\n      </div>\n    ';var o=document.querySelector(".vision-photo-gallery");this.galleryContainer=o,this.toggleOverlayMessage("Загрузка...");var n=t.querySelector(".vg-main-photo"),r=t.querySelector(".vg-gallery"),i=this.controls.upload;this.getPhotos().then((function(t){if(n.innerHTML=e.createPhotoElement({main:!0,empty:!0,photoId:null}),i&&(r.innerHTML=e.createPhotoElement({main:!1,empty:!0,photoId:null})),t.ok)return t.json();n.innerHTML=e.createNoPhotoElement(),e.initEvents(),e.toggleOverlayMessage()}),(function(t){e.toggleOverlayMessage(),e.handleError({message:t}),e.initEvents()})).then((function(t){if(!t||!t.length)return n.innerHTML=e.createNoPhotoElement(),r.parentElement.classList.add("hidden"),void e.toggleOverlayMessage();var o=t.find((function(e){return e.main})),s=t.filter((function(e){return!e.main}));if(o?n.innerHTML=e.createPhotoElement(o):n.parentElement.classList.add("hidden"),s.length){var a="";s.forEach((function(t){return a+=e.createPhotoElement(t)})),i&&(a+=e.createPhotoElement({main:!1,empty:!0,photoId:null})),r.innerHTML=a}else i||r.parentElement.classList.add("hidden");e.initEvents(),e.toggleOverlayMessage()}),(function(t){e.handleError({message:t}),e.toggleOverlayMessage(),e.initEvents()})).catch((function(t){e.toggleOverlayMessage(),e.handleError({message:t}),e.initEvents()})),this.initEvents()}},{key:"createPhotoElement",value:function(t){var o=t.photoId,n=t.main,r=t.empty,i=t.path,s=t.avatarUrl,a=this.controls,l=a.disableAll,u=a.upload,c=a.update,d=a.remove,h="",p="",g="",v="";return!s&&i&&(g='style="background-image: url('.concat(i,')"')),s&&(g='style="background-image: url('.concat(s,')"')),n?(v='data-main="'.concat(n,'"'),r?(p="vg-photo vg-photo--main",h=e.getPhotoButtons({upload:u})):(p="vg-photo vg-photo--main",h=e.getPhotoButtons({remove:d}))):r?(p="vg-gallery__item vg-photo vg-photo--upload",h=e.getPhotoButtons({uploadIcon:u})):(p="vg-gallery__item vg-photo",h=e.getPhotoButtons({update:c,remove:d})),'\n      <div class="'.concat(p,'"\n        ').concat(g,'\n        data-photo-id="').concat(o,'"\n        ').concat(v,">\n        ").concat(l?"":h,"\n        </div>\n      ")}},{key:"createNoPhotoElement",value:function(){return'\n      <div class="vg-photo vg-photo--main">\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="-256 -256 1024 1024">\n          <path fill="#4a5266"\n            d="M437 310.8c-28.4-28.4-62.2-49.2-99.1-61.7 34.1-25.2 56.2-65.6 56.2-111.1C394.1 61.9 332.1 0 256 0S117.9 61.9 117.9 138.1c0 45.5 22.1 85.9 56.2 111.1 -36.9 12.4-70.8 33.3-99.1 61.7C26.6 359.2 0 423.5 0 491.8 0 503 9 512 20.2 512h471.7c11.1 0 20.2-9 20.2-20.2C512 423.5 485.4 359.2 437 310.8zM158.2 138.1c0-53.9 43.9-97.8 97.8-97.8 53.9 0 97.8 43.9 97.8 97.8 0 53.9-43.9 97.8-97.8 97.8C202.1 235.8 158.2 192 158.2 138.1zM41.2 471.7C51.4 362.2 143.9 276.2 256 276.2s204.6 86 214.8 195.5H41.2z"/>\n        </svg>\n      </div>\n    '}},{key:"getPhotoButtons",value:function(e){if(e.disableAll)return"";var t={remove:'<button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>',upload:'<button class="vg-photo__button vg-button" data-action="upload-photo">Загрузить</button>',uploadIcon:'<button class="vg-photo__button vg-button vg-button--upload" data-action="upload-photo">&#43;</button>',update:'<button class="vg-photo__button vg-button vg-button--green" data-action="update-photo">Выбрать</button>'};return Object.keys(e).reduce((function(o,n){return e[n]&&(o+=t[n]),o}),"")}},{key:"initEvents",value:function(){var e=this;this.rootElement.querySelectorAll("button").forEach((function(t){t.addEventListener("click",e.router[t.dataset.action],!1)}))}}],(n=[{key:"errorFunction",get:function(){return e.errorFunction},set:function(t){t&&(e.errorFunction=t)}},{key:"employeeId",get:function(){return e.employeeId},set:function(t){t&&(e.employeeId=t)}},{key:"visionPersonId",get:function(){return e.visionPersonId},set:function(t){t&&(e.visionPersonId=t)}},{key:"personId",get:function(){return e.personId},set:function(t){t&&(e.personId=t)}},{key:"rootElement",get:function(){return e.rootElement}},{key:"token",get:function(){return e.token},set:function(t){t&&(e.token=t)}},{key:"controls",get:function(){return e.controls},set:function(t){e.controls=r(r({},e.controls),t)}},{key:"masterAlbum",get:function(){return e.masterAlbum},set:function(t){e.masterAlbum=t}}])&&i(t.prototype,n),s&&i(t,s),e}();return s(a,"galleryContainer",null),s(a,"employeeId",null),s(a,"visionPersonId",null),s(a,"rootElement",null),s(a,"token",null),s(a,"controls",{disableAll:!1,update:!0,upload:!0,remove:!0}),s(a,"masterAlbum",!0),s(a,"errorFunction",null),s(a,"router",{"upload-photo":function(e){var t=a.rootElement.querySelector('input[type="file"]');t.addEventListener("change",a.router["file-input-changed"]),t.click()},"file-input-changed":function(e){var t=e.target.files[0],o=new FileReader;o.readAsDataURL(t),o.onload=function(){a.addPhoto(o.result).then((function(e){if(e.ok)a.draw();else if(200!==e.status)return e.json()}),(function(e){a.handleError({message:e})}))},o.onerror=function(){a.handleError({message:o.error,blockingErrorMessage:"Ошибка загрузки фотографии (-ий): ".concat(o.error)})}},"remove-photo":function(e){var t=e.target.closest(".vg-photo").dataset.photoId;t&&a.deletePhoto(+t).then((function(e){if(e.ok)a.draw();else if(200!==e.status)return e.json()}),(function(e){a.handleError({message:e})}))},"update-photo":function(e){var t=e.target.closest(".vg-photo"),o=t.dataset.photoId,n=t.querySelectorAll("button");o&&(n.forEach((function(e){return e.setAttribute("disabled","disabled")})),a.setAsMainPhoto(+o).then((function(e){if(e.ok)a.draw();else if(200!==e.status)return e.json()}),(function(e){a.handleError({message:e})})))}}),t.default}()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS8uL1Zpc2lvblBob3RvR2FsbGVyeS9pbmRleC5qcyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJ0aGlzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIlZpc2lvblBob3RvR2FsbGVyeSIsImVtcGxveWVlSWQiLCJ2aXNpb25QZXJzb25JZCIsInBlcnNvbklkIiwidG9rZW4iLCJjb250cm9scyIsIm1hc3RlckFsYnVtIiwiRXJyb3IiLCJyb290RWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJkcmF3IiwicGFyYW1zIiwibWVzc2FnZSIsImJsb2NraW5nRXJyb3JNZXNzYWdlIiwiZXJyb3JGdW5jdGlvbiIsIm1lc3NhZ2VTdHJpbmciLCJmYXVsdHN0cmluZyIsImtleXMiLCJyZXZlcnNlIiwiZm9yRWFjaCIsImVycm9yTWVzc2FnZSIsImxlbmd0aCIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb25zb2xlIiwibG9nIiwicmVxdWVzdFBhdGgiLCJyZXF1ZXN0Qm9keSIsInJlcXVlc3REZWZhdWx0cyIsIm1ldGhvZCIsIm1vZGUiLCJjcmVkZW50aWFscyIsImhlYWRlcnMiLCJib2R5IiwiZmV0Y2giLCJlbXBsb3llZSIsInZpc2lvbl9wZXJzb25faWQiLCJyZXF1ZXN0IiwiaW1hZ2UiLCJ0b2dnbGVPdmVybGF5TWVzc2FnZSIsInBob3RvSWQiLCJwaG90b19pZCIsImdhbGxlcnlDb250YWluZXIiLCJkYXRhc2V0IiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwiaW5uZXJIVE1MIiwicXVlcnlTZWxlY3RvciIsIm1haW5QaG90b0NvbnRhaW5lciIsImdhbGxlcnkiLCJ1cGxvYWQiLCJnZXRQaG90b3MiLCJ0aGVuIiwicmVzcG9uc2UiLCJjcmVhdGVQaG90b0VsZW1lbnQiLCJtYWluIiwiZW1wdHkiLCJvayIsImpzb24iLCJjcmVhdGVOb1Bob3RvRWxlbWVudCIsImluaXRFdmVudHMiLCJlcnJvciIsImhhbmRsZUVycm9yIiwicmVzcG9uc2VKc29uIiwicGFyZW50RWxlbWVudCIsIm1haW5QaG90b0RhdGEiLCJmaW5kIiwiZ2FsbGVyeVBob3Rvc0RhdGEiLCJmaWx0ZXIiLCJnYWxsZXJ5UGhvdG9zSHRtbCIsInBob3RvRGF0YSIsImNhdGNoIiwicGF0aCIsImF2YXRhclVybCIsImRpc2FibGVBbGwiLCJ1cGRhdGUiLCJidXR0b25zIiwiZWxlbWVudENsYXNzZXMiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJtYWluQXR0cmlidXRlIiwiZ2V0UGhvdG9CdXR0b25zIiwidXBsb2FkSWNvbiIsInJlZHVjZSIsImJ1dHRvbnNTdHJpbmciLCJxdWVyeVNlbGVjdG9yQWxsIiwiYnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJvdXRlciIsImFjdGlvbiIsInZhbHVlIiwiZXZlbnQiLCJmaWxlSW5wdXQiLCJjbGljayIsImZpbGUiLCJ0YXJnZXQiLCJmaWxlcyIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJyZWFkQXNEYXRhVVJMIiwib25sb2FkIiwiYWRkUGhvdG8iLCJyZXN1bHQiLCJzdGF0dXMiLCJvbmVycm9yIiwiY2xvc2VzdCIsImRlbGV0ZVBob3RvIiwicGhvdG9FbGVtZW50Iiwic2V0QXR0cmlidXRlIiwic2V0QXNNYWluUGhvdG8iXSwibWFwcGluZ3MiOiJDQUFBLFNBQTJDQSxFQUFNQyxHQUMxQixpQkFBWkMsU0FBMEMsaUJBQVhDLE9BQ3hDQSxPQUFPRCxRQUFVRCxJQUNRLG1CQUFYRyxRQUF5QkEsT0FBT0MsSUFDOUNELE9BQU8sR0FBSUgsR0FDZSxpQkFBWkMsUUFDZEEsUUFBNEIsbUJBQUlELElBRWhDRCxFQUF5QixtQkFBSUMsSUFSL0IsQ0FTR0ssTUFBTSxXQUNULE8sd0JDVEEsSUFBSUMsRUFBc0IsQ0NBMUIsRUFBd0IsU0FBU0wsRUFBU00sR0FDekMsSUFBSSxJQUFJQyxLQUFPRCxFQUNYRCxFQUFvQkcsRUFBRUYsRUFBWUMsS0FBU0YsRUFBb0JHLEVBQUVSLEVBQVNPLElBQzVFRSxPQUFPQyxlQUFlVixFQUFTTyxFQUFLLENBQUVJLFlBQVksRUFBTUMsSUFBS04sRUFBV0MsTUNKM0UsRUFBd0IsU0FBU00sRUFBS0MsR0FBUSxPQUFPTCxPQUFPTSxVQUFVQyxlQUFlQyxLQUFLSixFQUFLQyxLLGluQ0NPMUVJLEUsV0E0Qm5CLGNBUWUsSUFQRHBCLEVBT0MsRUFQREEsS0FDQXFCLEVBTUMsRUFOREEsV0FDQUMsRUFLQyxFQUxEQSxlQUNBQyxFQUlDLEVBSkRBLFNBQ0FDLEVBR0MsRUFIREEsTUFDQUMsRUFFQyxFQUZEQSxTQUVDLElBRERDLG1CQUNDLFNBQ2IsRyw0RkFEYSxVQUNSMUIsRUFDSCxNQUFNLElBQUkyQixNQUFNLGdEQUdsQixJQUFNQyxFQUFjQyxTQUFTQyxlQUFlOUIsR0FFNUMsSUFBTTRCLEVBR0osTUFBTSxJQUFJRCxNQUFNLDBEQUdsQixHQUxFUCxFQUFtQlEsWUFBY0EsR0FLOUJQLElBQWVDLElBQW1CQyxFQUNyQyxNQUFNLElBQUlJLE1BQU0sK0NBR2xCckIsS0FBS2UsV0FBYUEsRUFDbEJmLEtBQUtnQixlQUFpQkEsRUFDdEJoQixLQUFL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UUFBU2tELFFBVW5CLGVBQWdCLFNBQUE2QixHQUNkLElBQU1nQixFQUFlaEIsRUFBTUksT0FBT1UsUUFBUSxhQUNuQ2pFLEVBQVdtRSxFQUFhaEUsUUFBeEJILFFBQ0RxQyxFQUFVOEIsRUFBYXRCLGlCQUFpQixVQUV4QzdDLElBQ0pxQyxFQUFRMUQsU0FBUSxTQUFBbUUsR0FBTSxPQUFJQSxFQUFPc0IsYUFBYSxXQUFZLGVBcnNCN0M3RyxFQXVzQlI4RyxnQkFBZ0JyRSxHQUFTYSxNQUM1QixTQUFBQyxHQUNFLEdBQUlBLEVBQVNJLEdBenNCSjNELEVBMHNCRlcsWUFDQSxHQUF3QixNQUFwQjRDLEVBQVNpRCxPQUNsQixPQUFPakQsRUFBU0ssVUFHcEIsU0FBQUcsR0Evc0JXL0QsRUFndEJKZ0UsWUFBWSxDQUNmbkQsUUFBU2tELFciLCJmaWxlIjoiVmlzaW9uUGhvdG9HYWxsZXJ5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW10sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiVmlzaW9uUGhvdG9HYWxsZXJ5XCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIlZpc2lvblBob3RvR2FsbGVyeVwiXSA9IGZhY3RvcnkoKTtcbn0pKHRoaXMsIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBkZWZpbml0aW9uKSB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iaiwgcHJvcCkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCk7IH0iLCJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFwiLi9hcHAuc2Nzc1wiO1xuXG4vKipcbiAqINCa0LvQsNGB0YEg0LPQsNC70LXRgNC10LguXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZpc2lvblBob3RvR2FsbGVyeSB7XG4gIHN0YXRpYyBnYWxsZXJ5Q29udGFpbmVyID0gbnVsbDtcbiAgc3RhdGljIGVtcGxveWVlSWQgPSBudWxsO1xuICBzdGF0aWMgdmlzaW9uUGVyc29uSWQgPSBudWxsO1xuICBzdGF0aWMgcm9vdEVsZW1lbnQgPSBudWxsO1xuICBzdGF0aWMgdG9rZW4gPSBudWxsO1xuICBzdGF0aWMgY29udHJvbHMgPSB7XG4gICAgZGlzYWJsZUFsbDogZmFsc2UsXG4gICAgdXBkYXRlOiB0cnVlLFxuICAgIHVwbG9hZDogdHJ1ZSxcbiAgICByZW1vdmU6IHRydWVcbiAgfTtcbiAgc3RhdGljIG1hc3RlckFsYnVtID0gdHJ1ZTtcblxuICAvKipcbiAgICog0JrQvtC90YHRgtGA0YPQutGC0L7RgCDRjdC60LfQtdC80L/Qu9GP0YDQsCDQutC70LDRgdGB0LAg0LPQsNC70LXRgNC10LguXG4gICAqIEBwYXJhbSByb290IHtzdHJpbmd9IElEINC60L7RgNC90LXQstC+0LPQviDRjdC70LXQvNC10L3RgtCwLCDQutGD0LTQsCDQsdGD0LTQtdGCINGA0LXQvdC00LXRgNC40YLRjNGB0Y8g0LPQsNC70LXRgNC10Y8uXG4gICAqIEBwYXJhbSBlbXBsb3llZUlkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIHZpc2lvblBlcnNvbklkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICogQHBhcmFtIHBlcnNvbklkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICogQHBhcmFtIHRva2VuIHtzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8uXG4gICAqIEBwYXJhbSBjb250cm9scyB7b2JqZWN0fSDQndCw0YHRgtGA0L7QudC60LAg0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDRjdC70LXQvNC10L3RgtC+0LIg0YPQv9GA0LDQstC70LXQvdC40Y8uXG4gICAqIEBwYXJhbSBjb250cm9scy5kaXNhYmxlQWxsIHtib29sZWFufSDQntGC0LrQu9GO0YfQuNGC0Ywg0LLRgdC1INGN0LvQtdC80LXQvdGC0Ysg0YPQv9GA0LDQstC70LXQvdC40Y8uXG4gICAqIEBwYXJhbSBjb250cm9scy51cGRhdGUge2Jvb2xlYW59INCe0YLQvtCx0YDQsNC20LXQvdC40LUg0LrQvdC+0L/QutC4INC+0LHQvdC+0LLQu9C10L3QuNGPINGE0L7RgtC+0LPRgNCw0YTQuNC4ICjRg9GB0YLQsNC90L7QstC60LAg0L7RgdC90L7QstC90L7QuSkuXG4gICAqIEBwYXJhbSBjb250cm9scy51cGxvYWQge2Jvb2xlYW59INCe0YLQvtCx0YDQsNC20LXQvdC40LUg0LrQvdC+0L/QutC4INC30LDQs9GA0YPQt9C60Lgg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBjb250cm9scy5yZW1vdmUge2Jvb2xlYW59INCe0YLQvtCx0YDQsNC20LXQvdC40LUg0LrQvdC+0L/QutC4INGD0LTQsNC70LXQvdC40Y8g0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBtYXN0ZXJBbGJ1bSB7Ym9vbGVhbn0g0JfQsNCz0YDRg9C30LrQsCDRhNC+0YLQvtCz0YDQsNGE0LjQuSDQuNC3INC80LDRgdGC0LXRgC3QsNC70LHQvtC80LAuXG4gICAqL1xuICBjb25zdHJ1Y3Rvcih7XG4gICAgICAgICAgICAgICAgcm9vdCxcbiAgICAgICAgICAgICAgICBlbXBsb3llZUlkLFxuICAgICAgICAgICAgICAgIHZpc2lvblBlcnNvbklkLFxuICAgICAgICAgICAgICAgIHBlcnNvbklkLFxuICAgICAgICAgICAgICAgIHRva2VuLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xzLFxuICAgICAgICAgICAgICAgIG1hc3RlckFsYnVtID0gdHJ1ZVxuICAgICAgICAgICAgICB9KSB7XG4gICAgaWYgKCFyb290KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCLQndC1INGD0LrQsNC30LDQvSBJRCDQutC+0YDQvdC10LLQvtCz0L4g0Y3Qu9C10LzQtdC90YLQsCDQtNC70Y8g0LPQsNC70LXRgNC10LghXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IHJvb3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocm9vdCk7XG5cbiAgICBpZiAoISFyb290RWxlbWVudCkge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LnJvb3RFbGVtZW50ID0gcm9vdEVsZW1lbnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcItCf0YDQvtCy0LXRgNGM0YLQtSDRg9C60LDQt9Cw0L3QvdGL0LkgSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAg0LTQu9GPINCz0LDQu9C10YDQtdC4IVwiKTtcbiAgICB9XG5cbiAgICBpZiAoIWVtcGxveWVlSWQgJiYgIXZpc2lvblBlcnNvbklkICYmICFwZXJzb25JZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwi0J3QtSDRg9C60LDQt9Cw0L0gSUQg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uXCIpO1xuICAgIH1cblxuICAgIHRoaXMuZW1wbG95ZWVJZCA9IGVtcGxveWVlSWQ7XG4gICAgdGhpcy52aXNpb25QZXJzb25JZCA9IHZpc2lvblBlcnNvbklkO1xuICAgIHRoaXMucGVyc29uSWQgPSBwZXJzb25JZDtcbiAgICB0aGlzLnRva2VuID0gdG9rZW47XG4gICAgdGhpcy5jb250cm9scyA9IGNvbnRyb2xzO1xuICAgIHRoaXMubWFzdGVyQWxidW0gPSBtYXN0ZXJBbGJ1bTtcblxuICAgIFZpc2lvblBob3RvR2FsbGVyeS5kcmF3KCk7XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LDQtdC80YvQuSDQvNC10YLQvtC0INC00LvRjyDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICogQHR5cGUge251bGx8RnVuY3Rpb259INCk0YPQvdC60YbQuNGPINC+0LHRgNCw0LHQvtGC0YfQuNC6INC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKi9cbiAgc3RhdGljIGVycm9yRnVuY3Rpb24gPSBudWxsO1xuICAvKipcbiAgICog0J/QvtC70YPRh9C10L3QuNC1INC80LXRgtC+0LTQsCDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqIEB0eXBlIHtudWxsfEZ1bmN0aW9ufSDQpNGD0L3QutGG0LjRjyDQvtCx0YDQsNCx0L7RgtGH0LjQuiDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICovXG4gIGdldCBlcnJvckZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuZXJyb3JGdW5jdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDQvNC10YLQvtC00LAg0LTQu9GPINC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKiBAcGFyYW0gZXJyb3JGdW5jdGlvbiB7bnVsbHxGdW5jdGlvbn0g0KTRg9C90LrRhtC40Y8g0L7QsdGA0LDQsdC+0YLRh9C40Log0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqL1xuICBzZXQgZXJyb3JGdW5jdGlvbihlcnJvckZ1bmN0aW9uKSB7XG4gICAgaWYgKGVycm9yRnVuY3Rpb24pIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS5lcnJvckZ1bmN0aW9uID0gZXJyb3JGdW5jdGlvbjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J7QsdC90L7QstC70LXQvdC40LUg0L/QsNGA0LDQvNC10YLRgNC+0LIg0LPQsNC70LXRgNC10LguXG4gICAqIEBwYXJhbSBlbXBsb3llZUlkIHtudW1iZXJ8bnVtYmVyfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIHRva2VuIHtzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICovXG4gIHN0YXRpYyB1cGRhdGUoe2VtcGxveWVlSWQsIHRva2VufSkge1xuICAgIHRoaXMuZW1wbG95ZWVJZCA9IGVtcGxveWVlSWQ7XG4gICAgdGhpcy50b2tlbiA9IHRva2VuO1xuXG4gICAgdGhpcy5kcmF3KCk7XG4gIH1cblxuICAvKipcbiAgICog0J/QvtC70YPRh9C40YLRjCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHJldHVybiB7bnVtYmVyfHN0cmluZ30gSUQg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAqL1xuICBnZXQgZW1wbG95ZWVJZCgpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LmVtcGxveWVlSWQ7XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LXQvdC40LUg0Y3QutC30LXQvNC/0LvRj9GA0YMg0LPQsNC70LXRgNC10LggSUQg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAqIEBwYXJhbSBlbXBsb3llZUlkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICovXG4gIHNldCBlbXBsb3llZUlkKGVtcGxveWVlSWQpIHtcbiAgICBpZiAoZW1wbG95ZWVJZCkge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LmVtcGxveWVlSWQgPSBlbXBsb3llZUlkO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LjRgtGMIElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICovXG4gIGdldCB2aXNpb25QZXJzb25JZCgpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LnZpc2lvblBlcnNvbklkO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C10L3QuNC1INGN0LrQt9C10LzQv9C70Y/RgNGDINCz0LDQu9C10YDQtdC4IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKiBAcGFyYW0gdmlzaW9uUGVyc29uSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKi9cbiAgc2V0IHZpc2lvblBlcnNvbklkKHZpc2lvblBlcnNvbklkKSB7XG4gICAgaWYgKHZpc2lvblBlcnNvbklkKSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkudmlzaW9uUGVyc29uSWQgPSB2aXNpb25QZXJzb25JZDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J/QvtC70YPRh9C40YLRjCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICogQHJldHVybiB7bnVtYmVyfHN0cmluZ30gSUQg0YHQvtGC0YDRg9C00L3QuNC60LAg0LDRg9GC0YHQvtGA0YHQtdGA0LAuXG4gICAqL1xuICBnZXQgcGVyc29uSWQoKSB7XG4gICAgcmV0dXJuIFZpc2lvblBob3RvR2FsbGVyeS5wZXJzb25JZDtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDRjdC60LfQtdC80L/Qu9GP0YDRgyDQs9Cw0LvQtdGA0LXQuCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICogQHBhcmFtIHBlcnNvbklkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICovXG4gIHNldCBwZXJzb25JZChwZXJzb25JZCkge1xuICAgIGlmIChwZXJzb25JZCkge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LnBlcnNvbklkID0gcGVyc29uSWQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCa0L7RgNC90LXQstC+0Lkg0Y3Qu9C10LzQtdC90YIsINCyINC60L7RgtC+0YDRi9C5INCx0YPQtNC10YIg0YDQtdC90LTQtdGA0LjRgtGM0YHRjyDQs9Cw0LvQtdGA0LXRjy5cbiAgICogQHJldHVybiB7bnVsbHxFbGVtZW50fSDQmtC+0YDQvdC10LLQvtC5INGN0LvQtdC80LXQvdGCINC00LvRjyDRgNC10L3QtNC10YDQsC5cbiAgICovXG4gIGdldCByb290RWxlbWVudCgpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LnJvb3RFbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0YwgQ1NSRi3RgtC+0LrQtdC9INGB0LXRgdGB0LjQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8uXG4gICAqIEByZXR1cm4ge251bGx8c3RyaW5nfSBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICovXG4gIGdldCB0b2tlbigpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5LnRva2VuO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C40YLRjCBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICogQHBhcmFtIHRva2VuIHtzdHJpbmd9IENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC40Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPLlxuICAgKi9cbiAgc2V0IHRva2VuKHRva2VuKSB7XG4gICAgaWYgKHRva2VuKSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkudG9rZW4gPSB0b2tlbjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J/QvtC70YPRh9C40YLRjCDQt9C90LDRh9C10L3QuNC1INGB0L7RgdGC0L7Rj9C90LjRjyDQutC+0L3RgtGA0L7Qu9C+0LIuXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59INCh0L7RgdGC0L7Rj9C90LjQtSDQutC+0L3RgtGA0L7Qu9C+0LIuXG4gICAqL1xuICBnZXQgY29udHJvbHMoKSB7XG4gICAgcmV0dXJuIFZpc2lvblBob3RvR2FsbGVyeS5jb250cm9scztcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQuNGC0Ywg0LfQvdCw0YfQtdC90LjQtSDRgdC+0YHRgtC+0Y/QvdC40Y8g0LrQvtC90YLRgNC+0LvQvtCyLlxuICAgKiBAcGFyYW0gdmFsdWUge2Jvb2xlYW59INCS0LrQu9GO0YfQuNGC0Ywv0L7RgtC60LvRjtGH0LjRgtGMINC60L7QvdGC0YDQvtC70YsuXG4gICAqL1xuICBzZXQgY29udHJvbHModmFsdWUpIHtcbiAgICBWaXNpb25QaG90b0dhbGxlcnkuY29udHJvbHMgPSB7XG4gICAgICAuLi5WaXNpb25QaG90b0dhbGxlcnkuY29udHJvbHMsXG4gICAgICAuLi52YWx1ZVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog0J/QvtC70YPRh9C40YLRjCDRhNC70LDQsyDQt9Cw0LPRgNGD0LfQutC4INGE0L7RgtC+0LPRgNCw0YTQuNC5INC40Lcg0LzQsNGB0YLQtdGALdCw0LvRjNCx0L7QvNCwLlxuICAgKiBAcmV0dXJuIHtib29sZWFufSDQodC+0YHRgtC+0Y/QvdC40LUg0YTQu9Cw0LPQsCDQt9Cw0LPRgNGD0LfQutC4INGE0L7RgtC+0LPRgNCw0YTQuNC5INC40Lcg0LzQsNGB0YLQtdGALdCw0LvRjNCx0L7QvNCwLlxuICAgKi9cbiAgZ2V0IG1hc3RlckFsYnVtKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkubWFzdGVyQWxidW07XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LjRgtGMINGE0LvQsNCzINC30LDQs9GA0YPQt9C60Lgg0YTQvtGC0L7Qs9GA0LDRhNC40Lkg0LjQtyDQvNCw0YHRgtC10YAt0LDQu9GM0LHQvtC80LAuXG4gICAqIEBwYXJhbSB2YWx1ZSB7Ym9vbGVhbn0g0JLQutC70Y7Rh9C40YLRjC/QstGL0LrQu9GO0YfQuNGC0Ywg0LfQsNCz0YDRg9C30LrRgyDQuNC3INC80LDRgdGC0LXRgC3QsNC70YzQsdC+0LzQsC5cbiAgICovXG4gIHNldCBtYXN0ZXJBbGJ1bSh2YWx1ZSkge1xuICAgIFZpc2lvblBob3RvR2FsbGVyeS5tYXN0ZXJBbGJ1bSA9IHZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqINCe0LHRgNCw0LHQvtGC0YfQuNC6INC+0YjQuNCx0L7Qui5cbiAgICogQHBhcmFtIHBhcmFtcy5tZXNzYWdlIHtzdHJpbmd9INCh0L7QvtCx0YnQtdC90LjQtSDQvtCxINC+0YjQuNCx0LrQtS5cbiAgICogQHBhcmFtIHBhcmFtcy5ibG9ja2luZ0Vycm9yTWVzc2FnZSB7c3RyaW5nfSDQkdC70L7QutC40YDRg9GO0YnQtdC1INC/0L7RgtC+0Log0YHQvtC+0LHRidC10L3QuNC1INC+0LEg0L7RiNC40LHQutC1LlxuICAgKi9cbiAgc3RhdGljIGhhbmRsZUVycm9yKHBhcmFtcykge1xuICAgIGNvbnN0IHttZXNzYWdlLCBibG9ja2luZ0Vycm9yTWVzc2FnZX0gPSBwYXJhbXM7XG5cbiAgICBpZiAodGhpcy5lcnJvckZ1bmN0aW9uKSB7XG4gICAgICBsZXQgbWVzc2FnZVN0cmluZyA9IFwiXCI7XG5cbiAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICBpZiAobWVzc2FnZS5mYXVsdHN0cmluZykge1xuICAgICAgICAgIG1lc3NhZ2VTdHJpbmcgPSBtZXNzYWdlLmZhdWx0c3RyaW5nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIE9iamVjdC5rZXlzKG1lc3NhZ2UpXG4gICAgICAgICAgICAucmV2ZXJzZSgpXG4gICAgICAgICAgICAuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgICBtZXNzYWdlU3RyaW5nICs9IGAke21lc3NhZ2Vba2V5XX08YnIvPmA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBtZXNzYWdlU3RyaW5nLmxlbmd0aFxuICAgICAgICA/IG1lc3NhZ2VTdHJpbmdcbiAgICAgICAgOiBKU09OLnN0cmluZ2lmeShtZXNzYWdlKTtcblxuICAgICAgdGhpcy5lcnJvckZ1bmN0aW9uKGVycm9yTWVzc2FnZSwgXCLQntGI0LjQsdC60LBcIik7XG4gICAgfSBlbHNlIGlmIChibG9ja2luZ0Vycm9yTWVzc2FnZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGJsb2NraW5nRXJyb3JNZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCe0LHRkdGA0YLQutCwINC00LvRjyDQt9Cw0L/RgNC+0YHQvtCyINC6IEFQSS5cbiAgICogQHBhcmFtIHJlcXVlc3RQYXRoIHtzdHJpbmd9INCd0LDQt9Cy0LDQvdC40LUg0LzQtdGC0L7QtNCwIEFQSS5cbiAgICogQHBhcmFtIHJlcXVlc3RCb2R5IHtvYmplY3R9INCf0LDRgNCw0LzQtdGC0YDRiyDQt9Cw0L/RgNC+0YHQsC5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgcmVxdWVzdCh7cmVxdWVzdFBhdGgsIHJlcXVlc3RCb2R5fSkge1xuICAgIGNvbnN0IHJlcXVlc3REZWZhdWx0cyA9IHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBtb2RlOiBcInNhbWUtb3JpZ2luXCIsXG4gICAgICBjcmVkZW50aWFsczogXCJzYW1lLW9yaWdpblwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgXCJYLUNTUkZUb2tlblwiOiB0aGlzLnRva2VuXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpXG4gICAgfTtcblxuICAgIHJldHVybiBmZXRjaChgL2FwaS92Mi92aXNpb24vJHtyZXF1ZXN0UGF0aH0vYCwgcmVxdWVzdERlZmF1bHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQktGL0LPRgNGD0LfQutCwINCy0YHQtdGFINGE0L7RgtC+0LPRgNCw0YTQuNC5INGBINC/0L7RgNGC0LDQu9CwIFZpc2lvbi5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0YEg0YDQtdC30YPQu9GM0YLQsNGC0L7QvCDQstGL0L/QvtC70L3QtdC90LjRjyDQt9Cw0L/RgNC+0YHQsC5cbiAgICovXG4gIHN0YXRpYyBnZXRQaG90b3MoKSB7XG4gICAgY29uc3QgZW1wbG95ZWUgPSB7fTtcblxuICAgIGlmICh0aGlzLmVtcGxveWVlSWQgJiYgIXRoaXMudmlzaW9uUGVyc29uSWQpIHtcbiAgICAgIGVtcGxveWVlLmVtcGxveWVlSWQgPSB0aGlzLmVtcGxveWVlSWQ7XG4gICAgfSBlbHNlIGlmICh0aGlzLnZpc2lvblBlcnNvbklkKSB7XG4gICAgICBlbXBsb3llZS52aXNpb25fcGVyc29uX2lkID0gdGhpcy52aXNpb25QZXJzb25JZDtcbiAgICB9IGVsc2UgaWYgKHRoaXMucGVyc29uSWQpIHtcbiAgICAgIGVtcGxveWVlLnBlcnNvbklkID0gdGhpcy5wZXJzb25JZDtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiBcImdldF9waG90b3NcIixcbiAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgIC4uLmVtcGxveWVlLFxuICAgICAgICBtYXN0ZXJBbGJ1bTogdGhpcy5tYXN0ZXJBbGJ1bVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCX0LDQv9GA0L7RgSDQvdCwINC00L7QsdCw0LLQu9C10L3QuNC1ICjQt9Cw0LPRgNGD0LfQutGDKSDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHBhcmFtIGltYWdlIHtCdWZmZXJFbmNvZGluZ30g0KTQvtGC0L7Qs9GA0LDRhNC40Lgg0LIg0YTQvtGA0LzQsNGC0LUgQmFzZTY0LlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIGFkZFBob3RvKGltYWdlKSB7XG4gICAgdGhpcy50b2dnbGVPdmVybGF5TWVzc2FnZSgn0JfQsNCz0YDRg9C30LrQsC4uLicpO1xuXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh7XG4gICAgICByZXF1ZXN0UGF0aDogXCJhZGRfcGhvdG9cIixcbiAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgIGVtcGxveWVlSWQ6IHRoaXMuZW1wbG95ZWVJZCxcbiAgICAgICAgaW1hZ2VcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDRg9C00LDQu9C10L3QuNC1INGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gcGhvdG9JZCB7TnVtYmVyfSBJRCDRhNC+0YLQvtCz0YDQsNGE0LjQuCDQvdCwINC/0L7RgNGC0LDQu9C1IFZpc2lvbi5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0YEg0YDQtdC30YPQu9GM0YLQsNGC0L7QvCDQstGL0L/QvtC70L3QtdC90LjRjyDQt9Cw0L/RgNC+0YHQsC5cbiAgICovXG4gIHN0YXRpYyBkZWxldGVQaG90byhwaG90b0lkKSB7XG4gICAgdGhpcy50b2dnbGVPdmVybGF5TWVzc2FnZSgn0KPQtNCw0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuC4uLicpO1xuXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh7XG4gICAgICByZXF1ZXN0UGF0aDogXCJkZWxldGVfcGhvdG9cIixcbiAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgIHBob3RvX2lkOiBwaG90b0lkXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0JfQsNC/0YDQvtGBINC90LAg0L7QsdC90L7QstC70LXQvdC40LUg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwaG90b0lkIHtOdW1iZXJ9IElEINGE0L7RgtC+0LPRgNCw0YTQuNC4INC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIHVwZGF0ZVBob3RvKHBob3RvSWQpIHtcbiAgICB0aGlzLnRvZ2dsZU92ZXJsYXlNZXNzYWdlKCfQntCx0L3QvtCy0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuC4uLicpO1xuXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh7XG4gICAgICByZXF1ZXN0UGF0aDogXCJ1cGRhdGVfcGhvdG9cIixcbiAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgIGVtcGxveWVlSWQ6IHRoaXMuZW1wbG95ZWVJZCxcbiAgICAgICAgcGhvdG9faWQ6IHBob3RvSWRcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDRg9GB0YLQsNC90L7QstC60YMg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0LrQsNC6INC+0YHQvdC+0LLQvdC+0Lkg0LTQu9GPINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcGFyYW0gcGhvdG9JZCB7TnVtYmVyfSBJRCDRhNC+0YLQvtCz0YDQsNGE0LjQuCDQvdCwINC/0L7RgNGC0LDQu9C1IFZpc2lvbi5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0YEg0YDQtdC30YPQu9GM0YLQsNGC0L7QvCDQstGL0L/QvtC70L3QtdC90LjRjyDQt9Cw0L/RgNC+0YHQsC5cbiAgICovXG4gIHN0YXRpYyBzZXRBc01haW5QaG90byhwaG90b0lkKSB7XG4gICAgdGhpcy50b2dnbGVPdmVybGF5TWVzc2FnZSgn0J7QsdC90L7QstC70LXQvdC40LUg0L7RgdC90L7QstC90L7QuSDRhNC+0YLQvtCz0YDQsNGE0LjQuC4uLicpO1xuXG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh7XG4gICAgICByZXF1ZXN0UGF0aDogXCJzZXRfbWFpbl9waG90b1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgZW1wbG95ZWVJZDogdGhpcy5lbXBsb3llZUlkLFxuICAgICAgICBwaG90b0lkOiBwaG90b0lkXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0J/QtdGA0LXQutC70Y7Rh9Cw0YLQtdC70Ywg0LHQu9C+0LrQuNGA0YPRjtGJ0LXQs9C+INGB0L7QvtCx0YnQtdC90LjRjy5cbiAgICogQHBhcmFtIG1lc3NhZ2Uge3N0cmluZ3x1bmRlZmluZWR8bnVsbH0g0KHQvtC+0LHRidC10L3QuNC1LlxuICAgKi9cbiAgc3RhdGljIHRvZ2dsZU92ZXJsYXlNZXNzYWdlKG1lc3NhZ2UgPSBudWxsKSB7XG4gICAgY29uc3Qge2dhbGxlcnlDb250YWluZXJ9ID0gdGhpcztcblxuICAgIGlmICghZ2FsbGVyeUNvbnRhaW5lcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfQndC1INC90LDQudC00LXQvdCwINC60L7RgNC90LXQstC+0Lkg0Y3Qu9C10LzQtdC90YIg0LPQsNC70LXRgNC10LgnKTtcbiAgICB9XG5cbiAgICBpZiAobWVzc2FnZSkge1xuICAgICAgZ2FsbGVyeUNvbnRhaW5lci5kYXRhc2V0Lm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgICAgZ2FsbGVyeUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCd2aXNpb24tcGhvdG8tZ2FsbGVyeS0tbWVzc2FnZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICBnYWxsZXJ5Q29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Zpc2lvbi1waG90by1nYWxsZXJ5LS1tZXNzYWdlJyk7XG4gICAgICBnYWxsZXJ5Q29udGFpbmVyLmRhdGFzZXQubWVzc2FnZSA9ICcnO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQntGC0YDQuNGB0L7QstC60LAgRE9NINCz0LDQu9C10YDQtdC40LguXG4gICAqL1xuICBzdGF0aWMgZHJhdygpIHtcbiAgICBjb25zdCByb290RWxlbWVudCA9IHRoaXMucm9vdEVsZW1lbnQ7XG5cbiAgICByb290RWxlbWVudC5pbm5lckhUTUwgPSBgXG4gICAgICA8ZGl2IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9XCJmaWxlXCIgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9fZmlsZS1maWVsZFwiIHRhYmluZGV4PVwiLTFcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X19pdGVtIHZpc2lvbi1waG90by1nYWxsZXJ5X19pdGVtLS1tYWluXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInZnLW1haW4tcGhvdG9cIj48L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9faXRlbVwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2Zy1nYWxsZXJ5XCI+PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgYDtcblxuICAgIGNvbnN0IGdhbGxlcnlDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnZpc2lvbi1waG90by1nYWxsZXJ5XCIpO1xuXG4gICAgdGhpcy5nYWxsZXJ5Q29udGFpbmVyID0gZ2FsbGVyeUNvbnRhaW5lcjtcbiAgICB0aGlzLnRvZ2dsZU92ZXJsYXlNZXNzYWdlKCfQl9Cw0LPRgNGD0LfQutCwLi4uJyk7XG5cbiAgICBjb25zdCBtYWluUGhvdG9Db250YWluZXIgPSByb290RWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnZnLW1haW4tcGhvdG9cIik7XG4gICAgY29uc3QgZ2FsbGVyeSA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmctZ2FsbGVyeVwiKTtcbiAgICBjb25zdCB7dXBsb2FkfSA9IHRoaXMuY29udHJvbHM7XG5cbiAgICB0aGlzLmdldFBob3RvcygpXG4gICAgICAudGhlbihcbiAgICAgICAgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudCh7XG4gICAgICAgICAgICBtYWluOiB0cnVlLFxuICAgICAgICAgICAgZW1wdHk6IHRydWUsXG4gICAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAodXBsb2FkKSB7XG4gICAgICAgICAgICBnYWxsZXJ5LmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHtcbiAgICAgICAgICAgICAgbWFpbjogZmFsc2UsXG4gICAgICAgICAgICAgIGVtcHR5OiB0cnVlLFxuICAgICAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZU5vUGhvdG9FbGVtZW50KCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgICAgICAgdGhpcy50b2dnbGVPdmVybGF5TWVzc2FnZSgpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdGhpcy50b2dnbGVPdmVybGF5TWVzc2FnZSgpO1xuICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLnRoZW4oXG4gICAgICAgIHJlc3BvbnNlSnNvbiA9PiB7XG4gICAgICAgICAgaWYgKCFyZXNwb25zZUpzb24gfHwgIXJlc3BvbnNlSnNvbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZU5vUGhvdG9FbGVtZW50KCk7XG4gICAgICAgICAgICBnYWxsZXJ5LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlT3ZlcmxheU1lc3NhZ2UoKTtcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IG1haW5QaG90b0RhdGEgPSByZXNwb25zZUpzb24uZmluZCgoe21haW59KSA9PiBtYWluKTtcbiAgICAgICAgICBjb25zdCBnYWxsZXJ5UGhvdG9zRGF0YSA9IHJlc3BvbnNlSnNvbi5maWx0ZXIoKHttYWlufSkgPT4gIW1haW4pO1xuXG4gICAgICAgICAgaWYgKCEhbWFpblBob3RvRGF0YSkge1xuICAgICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KFxuICAgICAgICAgICAgICBtYWluUGhvdG9EYXRhXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtYWluUGhvdG9Db250YWluZXIucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChnYWxsZXJ5UGhvdG9zRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCBnYWxsZXJ5UGhvdG9zSHRtbCA9IFwiXCI7XG5cbiAgICAgICAgICAgIGdhbGxlcnlQaG90b3NEYXRhLmZvckVhY2goXG4gICAgICAgICAgICAgIHBob3RvRGF0YSA9PlxuICAgICAgICAgICAgICAgIChnYWxsZXJ5UGhvdG9zSHRtbCArPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudChwaG90b0RhdGEpKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKHVwbG9hZCkge1xuICAgICAgICAgICAgICBnYWxsZXJ5UGhvdG9zSHRtbCArPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudCh7XG4gICAgICAgICAgICAgICAgbWFpbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW1wdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgcGhvdG9JZDogbnVsbFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZ2FsbGVyeS5pbm5lckhUTUwgPSBnYWxsZXJ5UGhvdG9zSHRtbDtcbiAgICAgICAgICB9IGVsc2UgaWYgKCF1cGxvYWQpIHtcbiAgICAgICAgICAgIGdhbGxlcnkucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgICAgIHRoaXMudG9nZ2xlT3ZlcmxheU1lc3NhZ2UoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0aGlzLnRvZ2dsZU92ZXJsYXlNZXNzYWdlKCk7XG4gICAgICAgICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIHRoaXMudG9nZ2xlT3ZlcmxheU1lc3NhZ2UoKTtcbiAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7XG4gICAgICAgICAgbWVzc2FnZTogZXJyb3JcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgfSk7XG5cbiAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQo9C90LjQstC10YDRgdCw0LvRjNC90YvQuSDQvNC10YLQvtC0INC00LvRjyDRgdC+0LfQtNCw0L3QuNGPINGN0LvQtdC80LXQvdGC0LAg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwYXJhbXMucGhvdG9JZCB7bnVtYmVyfSBJRCDRhNC+0YLQvtCz0YDQsNGE0LjQuCDQvdCwINC/0L7RgNGC0LDQu9C1IFZpc2lvbi5cbiAgICogQHBhcmFtIHBhcmFtcy5tYWluIHtib29sZWFufSAg0KTQu9Cw0LMg0L7RgdC90L7QstC90L7Qs9C+INGE0L7RgtC+LlxuICAgKiBAcGFyYW0gcGFyYW1zLmVtcHR5IHtib29sZWFufSDQpNC70LDQsyBcItC/0YPRgdGC0L7Qs9C+XCIg0YTQvtGC0L4sINC40YHQv9C+0LvRjNC30YPQtdGC0YHRjyDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQutC90L7Qv9C60Lgg0LfQsNCz0YDRg9C30LrQuC5cbiAgICogQHBhcmFtIHBhcmFtcy5wYXRoIHtzdHJpbmd9INCf0YPRgtGMINC6INGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gcGFyYW1zLmF2YXRhclVybCB7c3RyaW5nfSDQn9GD0YLRjCDQuiDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHJldHVybnMge3N0cmluZ30g0K3Qu9C10LzQtdC90YIg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0LIg0LLQuNC00LUg0YHRgtGA0L7QutC4LlxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZVBob3RvRWxlbWVudChwYXJhbXMpIHtcbiAgICBjb25zdCB7cGhvdG9JZCwgbWFpbiwgZW1wdHksIHBhdGgsIGF2YXRhclVybH0gPSBwYXJhbXM7XG4gICAgY29uc3Qge2Rpc2FibGVBbGwsIHVwbG9hZCwgdXBkYXRlLCByZW1vdmV9ID0gdGhpcy5jb250cm9scztcbiAgICBsZXQgYnV0dG9ucyA9IFwiXCI7XG4gICAgbGV0IGVsZW1lbnRDbGFzc2VzID0gXCJcIjtcbiAgICBsZXQgYmFja2dyb3VuZEltYWdlID0gXCJcIjtcbiAgICBsZXQgbWFpbkF0dHJpYnV0ZSA9IFwiXCI7XG5cbiAgICBpZiAoIWF2YXRhclVybCAmJiBwYXRoKSB7XG4gICAgICBiYWNrZ3JvdW5kSW1hZ2UgPSBgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHtwYXRofSlcImA7XG4gICAgfVxuXG4gICAgaWYgKGF2YXRhclVybCkge1xuICAgICAgYmFja2dyb3VuZEltYWdlID0gYHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7YXZhdGFyVXJsfSlcImA7XG4gICAgfVxuXG4gICAgaWYgKG1haW4pIHtcbiAgICAgIG1haW5BdHRyaWJ1dGUgPSBgZGF0YS1tYWluPVwiJHttYWlufVwiYDtcblxuICAgICAgaWYgKGVtcHR5KSB7XG4gICAgICAgIGVsZW1lbnRDbGFzc2VzID0gXCJ2Zy1waG90byB2Zy1waG90by0tbWFpblwiO1xuICAgICAgICBidXR0b25zID0gVmlzaW9uUGhvdG9HYWxsZXJ5LmdldFBob3RvQnV0dG9ucyh7XG4gICAgICAgICAgdXBsb2FkXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWxlbWVudENsYXNzZXMgPSBcInZnLXBob3RvIHZnLXBob3RvLS1tYWluXCI7XG4gICAgICAgIGJ1dHRvbnMgPSBWaXNpb25QaG90b0dhbGxlcnkuZ2V0UGhvdG9CdXR0b25zKHtcbiAgICAgICAgICByZW1vdmVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChlbXB0eSkge1xuICAgICAgICBlbGVtZW50Q2xhc3NlcyA9IFwidmctZ2FsbGVyeV9faXRlbSB2Zy1waG90byB2Zy1waG90by0tdXBsb2FkXCI7XG4gICAgICAgIGJ1dHRvbnMgPSBWaXNpb25QaG90b0dhbGxlcnkuZ2V0UGhvdG9CdXR0b25zKHtcbiAgICAgICAgICB1cGxvYWRJY29uOiB1cGxvYWRcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50Q2xhc3NlcyA9IFwidmctZ2FsbGVyeV9faXRlbSB2Zy1waG90b1wiO1xuICAgICAgICBidXR0b25zID0gVmlzaW9uUGhvdG9HYWxsZXJ5LmdldFBob3RvQnV0dG9ucyh7XG4gICAgICAgICAgdXBkYXRlLFxuICAgICAgICAgIHJlbW92ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYFxuICAgICAgPGRpdiBjbGFzcz1cIiR7ZWxlbWVudENsYXNzZXN9XCJcbiAgICAgICAgJHtiYWNrZ3JvdW5kSW1hZ2V9XG4gICAgICAgIGRhdGEtcGhvdG8taWQ9XCIke3Bob3RvSWR9XCJcbiAgICAgICAgJHttYWluQXR0cmlidXRlfT5cbiAgICAgICAgJHtkaXNhYmxlQWxsID8gXCJcIiA6IGJ1dHRvbnN9XG4gICAgICAgIDwvZGl2PlxuICAgICAgYDtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVOb1Bob3RvRWxlbWVudCgpIHtcbiAgICByZXR1cm4gYFxuICAgICAgPGRpdiBjbGFzcz1cInZnLXBob3RvIHZnLXBob3RvLS1tYWluXCI+XG4gICAgICAgIDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHZpZXdCb3g9XCItMjU2IC0yNTYgMTAyNCAxMDI0XCI+XG4gICAgICAgICAgPHBhdGggZmlsbD1cIiM0YTUyNjZcIlxuICAgICAgICAgICAgZD1cIk00MzcgMzEwLjhjLTI4LjQtMjguNC02Mi4yLTQ5LjItOTkuMS02MS43IDM0LjEtMjUuMiA1Ni4yLTY1LjYgNTYuMi0xMTEuMUMzOTQuMSA2MS45IDMzMi4xIDAgMjU2IDBTMTE3LjkgNjEuOSAxMTcuOSAxMzguMWMwIDQ1LjUgMjIuMSA4NS45IDU2LjIgMTExLjEgLTM2LjkgMTIuNC03MC44IDMzLjMtOTkuMSA2MS43QzI2LjYgMzU5LjIgMCA0MjMuNSAwIDQ5MS44IDAgNTAzIDkgNTEyIDIwLjIgNTEyaDQ3MS43YzExLjEgMCAyMC4yLTkgMjAuMi0yMC4yQzUxMiA0MjMuNSA0ODUuNCAzNTkuMiA0MzcgMzEwLjh6TTE1OC4yIDEzOC4xYzAtNTMuOSA0My45LTk3LjggOTcuOC05Ny44IDUzLjkgMCA5Ny44IDQzLjkgOTcuOCA5Ny44IDAgNTMuOS00My45IDk3LjgtOTcuOCA5Ny44QzIwMi4xIDIzNS44IDE1OC4yIDE5MiAxNTguMiAxMzguMXpNNDEuMiA0NzEuN0M1MS40IDM2Mi4yIDE0My45IDI3Ni4yIDI1NiAyNzYuMnMyMDQuNiA4NiAyMTQuOCAxOTUuNUg0MS4yelwiLz5cbiAgICAgICAgPC9zdmc+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0Ywg0LrQvdC+0L/QutGDINC/0L4g0L/QtdGA0LXQtNCw0LLQsNC10LzRi9C8INC/0LDRgNCw0LzQtdGC0YDQsNC8LlxuICAgKiBAcGFyYW0gcGFyYW1zLmRpc2FibGVBbGwge2Jvb2xlYW59INCe0YLQutC70Y7Rh9C40YLRjCDQstGB0LUg0LrQvdC+0L/QutC4LlxuICAgKiBAcGFyYW0gcGFyYW1zLnJlbW92ZSB7Ym9vbGVhbn0g0JrQvdC+0L/QutCwINGD0LTQsNC70LXQvdC40Y8uXG4gICAqIEBwYXJhbSBwYXJhbXMudXBsb2FkIHtib29sZWFufSDQmtC90L7Qv9C60LAg0LfQsNCz0YDRg9C30LrQuC5cbiAgICogQHBhcmFtIHBhcmFtcy51cGxvYWRJY29uIHtib29sZWFufSDQmtC90L7Qv9C60LAg0LfQsNCz0YDRg9C30LrQuCDQsiDQstC40LTQtSDQuNC60L7QvdC60LguXG4gICAqIEBwYXJhbSBwYXJhbXMuc2VsZWN0IHtib29sZWFufSDQmtC90L7Qv9C60LAg0LLRi9Cx0L7RgNCwINGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKi9cbiAgc3RhdGljIGdldFBob3RvQnV0dG9ucyhwYXJhbXMpIHtcbiAgICBpZiAocGFyYW1zLmRpc2FibGVBbGwpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cblxuICAgIGNvbnN0IGJ1dHRvbnMgPSB7XG4gICAgICByZW1vdmU6IGA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS1yZWRcIiBkYXRhLWFjdGlvbj1cInJlbW92ZS1waG90b1wiPtCj0LTQsNC70LjRgtGMPC9idXR0b24+YCxcbiAgICAgIHVwbG9hZDogYDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvblwiIGRhdGEtYWN0aW9uPVwidXBsb2FkLXBob3RvXCI+0JfQsNCz0YDRg9C30LjRgtGMPC9idXR0b24+YCxcbiAgICAgIHVwbG9hZEljb246IGA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS11cGxvYWRcIiBkYXRhLWFjdGlvbj1cInVwbG9hZC1waG90b1wiPiYjNDM7PC9idXR0b24+YCxcbiAgICAgIHVwZGF0ZTogYDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvbiB2Zy1idXR0b24tLWdyZWVuXCIgZGF0YS1hY3Rpb249XCJ1cGRhdGUtcGhvdG9cIj7QktGL0LHRgNCw0YLRjDwvYnV0dG9uPmBcbiAgICB9O1xuXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHBhcmFtcykucmVkdWNlKChidXR0b25zU3RyaW5nLCBrZXkpID0+IHtcbiAgICAgIGlmIChwYXJhbXNba2V5XSkge1xuICAgICAgICBidXR0b25zU3RyaW5nICs9IGJ1dHRvbnNba2V5XTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGJ1dHRvbnNTdHJpbmc7XG4gICAgfSwgXCJcIik7XG4gIH1cblxuICAvKipcbiAgICog0JjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0YHQvtCx0YvRgtC40Lkg0LTQu9GPINC60L3QvtC/0L7QuiDQs9Cw0LvQtdGA0LXQuC5cbiAgICovXG4gIHN0YXRpYyBpbml0RXZlbnRzKCkge1xuICAgIGNvbnN0IHtyb290RWxlbWVudH0gPSB0aGlzO1xuICAgIGNvbnN0IGJ1dHRvbnMgPSByb290RWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiYnV0dG9uXCIpO1xuXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgXCJjbGlja1wiLFxuICAgICAgICB0aGlzLnJvdXRlcltidXR0b24uZGF0YXNldC5hY3Rpb25dLFxuICAgICAgICBmYWxzZVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQoNC+0YPRgtC10YAuXG4gICAqIEB0eXBlIHt7XCJyZW1vdmUtcGhvdG9cIjogZnVuY3Rpb24oKik6IHZvaWQsIFwiZmlsZS1pbnB1dC1jaGFuZ2VkXCI6IGZ1bmN0aW9uKCopOiB2b2lkLCBcInVwbG9hZC1waG90b1wiOiBmdW5jdGlvbigqKTogdm9pZCwgXCJ1cGRhdGUtcGhvdG9cIjogZnVuY3Rpb24oKik6IHZvaWR9fVxuICAgKi9cbiAgc3RhdGljIHJvdXRlciA9IHtcbiAgICAvKipcbiAgICAgKiDQl9Cw0LPRgNGD0LfQutCwINGE0L7RgtC+0LPRgNCw0YTQuNC4INGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgICAqIEBwYXJhbSBldmVudCB7RXZlbnR9INCh0L7QsdGL0YLQuNC1LlxuICAgICAqL1xuICAgIFwidXBsb2FkLXBob3RvXCI6IGV2ZW50ID0+IHtcbiAgICAgIGNvbnN0IGZpbGVJbnB1dCA9IHRoaXMucm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1cImZpbGVcIl0nKTtcblxuICAgICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgdGhpcy5yb3V0ZXJbXCJmaWxlLWlucHV0LWNoYW5nZWRcIl0pO1xuICAgICAgZmlsZUlucHV0LmNsaWNrKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDQodC70YPRiNCw0YLQtdC70Ywg0YHQvtCx0YvRgtC40Y8g0LjQt9C80LXQvdC10L3QuNGPINGE0LDQudC70L7QstC+0LPQviDQv9C+0LvRjyDQstCy0L7QtNCwLlxuICAgICAqIEBwYXJhbSBldmVudCB7ZXZlbnR9INCh0L7QsdGL0YLQuNC1LlxuICAgICAqL1xuICAgIFwiZmlsZS1pbnB1dC1jaGFuZ2VkXCI6IGV2ZW50ID0+IHtcbiAgICAgIGNvbnN0IGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF07XG4gICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcblxuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5hZGRQaG90byhyZWFkZXIucmVzdWx0KS50aGVuKFxuICAgICAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfTtcblxuICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgIG1lc3NhZ2U6IHJlYWRlci5lcnJvcixcbiAgICAgICAgICBibG9ja2luZ0Vycm9yTWVzc2FnZTogYNCe0YjQuNCx0LrQsCDQt9Cw0LPRgNGD0LfQutC4INGE0L7RgtC+0LPRgNCw0YTQuNC4ICgt0LjQuSk6ICR7cmVhZGVyLmVycm9yfWBcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH0sXG4gICAgLyoqXG4gICAgICog0JfQsNC/0YDQvtGBINC90LAg0YPQtNCw0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICAgKiBAcGFyYW0gZXZlbnQge0V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICBcInJlbW92ZS1waG90b1wiOiBldmVudCA9PiB7XG4gICAgICBjb25zdCBwaG90b0VsZW1lbnQgPSBldmVudC50YXJnZXQuY2xvc2VzdChcIi52Zy1waG90b1wiKTtcbiAgICAgIGNvbnN0IHtwaG90b0lkfSA9IHBob3RvRWxlbWVudC5kYXRhc2V0O1xuXG4gICAgICBpZiAoISFwaG90b0lkKSB7XG4gICAgICAgIHRoaXMuZGVsZXRlUGhvdG8oK3Bob3RvSWQpLnRoZW4oXG4gICAgICAgICAgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDQvtCx0L3QvtCy0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICAgKiBAcGFyYW0gZXZlbnQge0V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICBcInVwZGF0ZS1waG90b1wiOiBldmVudCA9PiB7XG4gICAgICBjb25zdCBwaG90b0VsZW1lbnQgPSBldmVudC50YXJnZXQuY2xvc2VzdChcIi52Zy1waG90b1wiKTtcbiAgICAgIGNvbnN0IHtwaG90b0lkfSA9IHBob3RvRWxlbWVudC5kYXRhc2V0O1xuICAgICAgY29uc3QgYnV0dG9ucyA9IHBob3RvRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24nKTtcblxuICAgICAgaWYgKCEhcGhvdG9JZCkge1xuICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJykpO1xuXG4gICAgICAgIHRoaXMuc2V0QXNNYWluUGhvdG8oK3Bob3RvSWQpLnRoZW4oXG4gICAgICAgICAgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==