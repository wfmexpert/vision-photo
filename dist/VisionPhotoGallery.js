!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VisionPhotoGallery=t():e.VisionPhotoGallery=t()}(this,(function(){return function(){"use strict";var e={d:function(t,o){for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}e.d(t,{default:function(){return a}});var a=function(){function e(t){var o=t.root,n=t.employeeId,r=t.visionPersonId,i=t.personId,s=t.token,a=t.controls,u=t.masterAlbum,l=void 0===u||u;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!o)throw new Error("Не указан ID корневого элемента для галереи!");var c=document.getElementById(o);if(!c)throw new Error("Проверьте указанный ID корневого элемента для галереи!");if(e.rootElement=c,!n&&!r&&!i)throw new Error("Не указан ID пользователя на портале Vision");this.employeeId=n,this.visionPersonId=r,this.personId=i,this.token=s,this.controls=a,this.masterAlbum=l,e.draw()}var t,n,s;return t=e,s=[{key:"update",value:function(e){var t=e.employeeId,o=e.token;this.employeeId=t,this.token=o,this.draw()}},{key:"handleError",value:function(e){var t=e.message,n=e.blockingErrorMessage;if(this.errorFunction){var r="";"object"===o(t)&&(t.faultstring?r=t.faultstring:Object.keys(t).reverse().forEach((function(e){r+="".concat(t[e],"<br/>")})));var i=r.length?r:JSON.stringify(t);this.errorFunction(i,"Ошибка")}else{if(n)throw new Error(n);console.log(t)}}},{key:"request",value:function(e){var t=e.requestPath,o=e.requestBody,n={method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":this.token},body:JSON.stringify(o)};return fetch("/api/v2/vision/".concat(t,"/"),n)}},{key:"getPhotos",value:function(){var e={};return this.employeeId&&!this.visionPersonId?e.employeeId=this.employeeId:this.visionPersonId?e.vision_person_id=this.visionPersonId:this.personId&&(e.personId=this.personId),this.request({requestPath:"get_photos",requestBody:r(r({},e),{},{masterAlbum:this.masterAlbum})})}},{key:"addPhoto",value:function(e){return this.request({requestPath:"add_photo",requestBody:{employeeId:this.employeeId,image:e}})}},{key:"deletePhoto",value:function(e){return this.request({requestPath:"delete_photo",requestBody:{photo_id:e}})}},{key:"updatePhoto",value:function(e){return this.request({requestPath:"update_photo",requestBody:{employeeId:this.employeeId,photo_id:e}})}},{key:"setAsMainPhoto",value:function(e){return this.request({requestPath:"set_main_photo",requestBody:{employeeId:this.employeeId,photoId:e}})}},{key:"draw",value:function(){var e=this,t=this.rootElement;t.innerHTML='\n      <div class="vision-photo-gallery vision-photo-gallery--message" data-message="Загрузка...">\n        <input type="file" class="vision-photo-gallery__file-field" tabindex="-1">\n        <div class="vision-photo-gallery__item vision-photo-gallery__item--main">\n          <div class="vg-main-photo"></div>\n        </div>\n        <div class="vision-photo-gallery__item">\n          <div class="vg-gallery"></div>\n        </div>\n      </div>\n    ';var o=document.querySelector(".vision-photo-gallery"),n=t.querySelector(".vg-main-photo"),r=t.querySelector(".vg-gallery"),i=this.controls.upload;this.getPhotos().then((function(t){if(n.innerHTML=e.createPhotoElement({main:!0,empty:!0,photoId:null}),i&&(r.innerHTML=e.createPhotoElement({main:!1,empty:!0,photoId:null})),t.ok)return t.json();n.innerHTML=e.createNoPhotoElement(),o.classList.remove("vision-photo-gallery--message"),e.initEvents()}),(function(t){e.handleError({message:t}),e.initEvents()})).then((function(t){if(!t||!t.length)return n.innerHTML=e.createNoPhotoElement(),r.parentElement.classList.add("hidden"),void o.classList.remove("vision-photo-gallery--message");var s=t.find((function(e){return e.main})),a=t.filter((function(e){return!e.main}));if(s?n.innerHTML=e.createPhotoElement(s):n.parentElement.classList.add("hidden"),a.length){var u="";a.forEach((function(t){return u+=e.createPhotoElement(t)})),i&&(u+=e.createPhotoElement({main:!1,empty:!0,photoId:null})),r.innerHTML=u}else i||r.parentElement.classList.add("hidden");e.initEvents(),o.classList.remove("vision-photo-gallery--message")}),(function(t){e.handleError({message:t}),e.initEvents()})).catch((function(t){e.handleError({message:t}),e.initEvents()})),this.initEvents()}},{key:"createPhotoElement",value:function(t){var o=t.photoId,n=t.main,r=t.empty,i=t.path,s=t.avatarUrl,a=this.controls,u=a.disableAll,l=a.upload,c=a.update,d=a.remove,h="",p="",f="",v="";return!s&&i&&(f='style="background-image: url('.concat(i,')"')),s&&(f='style="background-image: url('.concat(s,')"')),n?(v='data-main="'.concat(n,'"'),r?(p="vg-photo vg-photo--main",h=e.getPhotoButtons({upload:l})):(p="vg-photo vg-photo--main",h=e.getPhotoButtons({remove:d}))):r?(p="vg-gallery__item vg-photo vg-photo--upload",h=e.getPhotoButtons({uploadIcon:l})):(p="vg-gallery__item vg-photo",h=e.getPhotoButtons({update:c,remove:d})),'\n      <div class="'.concat(p,'"\n        ').concat(f,'\n        data-photo-id="').concat(o,'"\n        ').concat(v,">\n        ").concat(u?e.prototype.noPhotoSvg:h,"\n        </div>\n      ")}},{key:"createNoPhotoElement",value:function(){return'\n      <div class="vg-photo vg-photo--main">\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="-256 -256 1024 1024">\n          <path fill="#4a5266"\n            d="M437 310.8c-28.4-28.4-62.2-49.2-99.1-61.7 34.1-25.2 56.2-65.6 56.2-111.1C394.1 61.9 332.1 0 256 0S117.9 61.9 117.9 138.1c0 45.5 22.1 85.9 56.2 111.1 -36.9 12.4-70.8 33.3-99.1 61.7C26.6 359.2 0 423.5 0 491.8 0 503 9 512 20.2 512h471.7c11.1 0 20.2-9 20.2-20.2C512 423.5 485.4 359.2 437 310.8zM158.2 138.1c0-53.9 43.9-97.8 97.8-97.8 53.9 0 97.8 43.9 97.8 97.8 0 53.9-43.9 97.8-97.8 97.8C202.1 235.8 158.2 192 158.2 138.1zM41.2 471.7C51.4 362.2 143.9 276.2 256 276.2s204.6 86 214.8 195.5H41.2z"/>\n        </svg>\n      </div>\n    '}},{key:"getPhotoButtons",value:function(e){if(e.disableAll)return"";var t={remove:'<button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>',upload:'<button class="vg-photo__button vg-button" data-action="upload-photo">Загрузить</button>',uploadIcon:'<button class="vg-photo__button vg-button vg-button--upload" data-action="upload-photo">&#43;</button>',update:'<button class="vg-photo__button vg-button vg-button--green" data-action="update-photo">Выбрать</button>'};return Object.keys(e).reduce((function(o,n){return e[n]&&(o+=t[n]),o}),"")}},{key:"initEvents",value:function(){var e=this;this.rootElement.querySelectorAll("button").forEach((function(t){t.addEventListener("click",e.router[t.dataset.action],!1)}))}}],(n=[{key:"errorFunction",get:function(){return e.errorFunction},set:function(t){t&&(e.errorFunction=t)}},{key:"employeeId",get:function(){return e.employeeId},set:function(t){t&&(e.employeeId=t)}},{key:"visionPersonId",get:function(){return e.visionPersonId},set:function(t){t&&(e.visionPersonId=t)}},{key:"personId",get:function(){return e.personId},set:function(t){t&&(e.personId=t)}},{key:"rootElement",get:function(){return e.rootElement}},{key:"token",get:function(){return e.token},set:function(t){t&&(e.token=t)}},{key:"controls",get:function(){return e.controls},set:function(t){e.controls=r(r({},e.controls),t)}},{key:"masterAlbum",get:function(){return e.masterAlbum},set:function(t){e.masterAlbum=t}}])&&i(t.prototype,n),s&&i(t,s),e}();return s(a,"employeeId",null),s(a,"visionPersonId",null),s(a,"rootElement",null),s(a,"token",null),s(a,"controls",{disableAll:!1,update:!0,upload:!0,remove:!0}),s(a,"masterAlbum",!0),s(a,"errorFunction",null),s(a,"router",{"upload-photo":function(e){var t=a.rootElement.querySelector('input[type="file"]');t.addEventListener("change",a.router["file-input-changed"]),t.click()},"file-input-changed":function(e){var t=e.target.files[0],o=new FileReader;o.readAsDataURL(t),o.onload=function(){a.addPhoto(o.result).then((function(e){if(e.ok)a.draw();else if(200!==e.status)return e.json()}),(function(e){a.handleError({message:e})}))},o.onerror=function(){a.handleError({message:o.error,blockingErrorMessage:"Ошибка загрузки фотографии (-ий): ".concat(o.error)})}},"remove-photo":function(e){var t=e.target.closest(".vg-photo").dataset.photoId;t&&a.deletePhoto(+t).then((function(e){if(e.ok)a.draw();else if(200!==e.status)return e.json()}),(function(e){a.handleError({message:e})}))},"update-photo":function(e){var t=e.target.closest(".vg-photo").dataset.photoId;t&&a.setAsMainPhoto(+t).then((function(e){if(e.ok)a.draw();else if(200!==e.status)return e.json()}),(function(e){a.handleError({message:e})}))}}),t.default}()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS8uL1Zpc2lvblBob3RvR2FsbGVyeS9pbmRleC5qcyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJ0aGlzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIlZpc2lvblBob3RvR2FsbGVyeSIsImVtcGxveWVlSWQiLCJ2aXNpb25QZXJzb25JZCIsInBlcnNvbklkIiwidG9rZW4iLCJjb250cm9scyIsIm1hc3RlckFsYnVtIiwiRXJyb3IiLCJyb290RWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJkcmF3IiwicGFyYW1zIiwibWVzc2FnZSIsImJsb2NraW5nRXJyb3JNZXNzYWdlIiwiZXJyb3JGdW5jdGlvbiIsIm1lc3NhZ2VTdHJpbmciLCJmYXVsdHN0cmluZyIsImtleXMiLCJyZXZlcnNlIiwiZm9yRWFjaCIsImVycm9yTWVzc2FnZSIsImxlbmd0aCIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb25zb2xlIiwibG9nIiwicmVxdWVzdFBhdGgiLCJyZXF1ZXN0Qm9keSIsInJlcXVlc3REZWZhdWx0cyIsIm1ldGhvZCIsIm1vZGUiLCJjcmVkZW50aWFscyIsImhlYWRlcnMiLCJib2R5IiwiZmV0Y2giLCJlbXBsb3llZSIsInZpc2lvbl9wZXJzb25faWQiLCJyZXF1ZXN0IiwiaW1hZ2UiLCJwaG90b0lkIiwicGhvdG9faWQiLCJpbm5lckhUTUwiLCJnYWxsZXJ5Q29udGFpbmVyIiwicXVlcnlTZWxlY3RvciIsIm1haW5QaG90b0NvbnRhaW5lciIsImdhbGxlcnkiLCJ1cGxvYWQiLCJnZXRQaG90b3MiLCJ0aGVuIiwicmVzcG9uc2UiLCJjcmVhdGVQaG90b0VsZW1lbnQiLCJtYWluIiwiZW1wdHkiLCJvayIsImpzb24iLCJjcmVhdGVOb1Bob3RvRWxlbWVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImluaXRFdmVudHMiLCJlcnJvciIsImhhbmRsZUVycm9yIiwicmVzcG9uc2VKc29uIiwicGFyZW50RWxlbWVudCIsImFkZCIsIm1haW5QaG90b0RhdGEiLCJmaW5kIiwiZ2FsbGVyeVBob3Rvc0RhdGEiLCJmaWx0ZXIiLCJnYWxsZXJ5UGhvdG9zSHRtbCIsInBob3RvRGF0YSIsImNhdGNoIiwicGF0aCIsImF2YXRhclVybCIsImRpc2FibGVBbGwiLCJ1cGRhdGUiLCJidXR0b25zIiwiZWxlbWVudENsYXNzZXMiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJtYWluQXR0cmlidXRlIiwiZ2V0UGhvdG9CdXR0b25zIiwidXBsb2FkSWNvbiIsIm5vUGhvdG9TdmciLCJyZWR1Y2UiLCJidXR0b25zU3RyaW5nIiwicXVlcnlTZWxlY3RvckFsbCIsImJ1dHRvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJyb3V0ZXIiLCJkYXRhc2V0IiwiYWN0aW9uIiwidmFsdWUiLCJlIiwiZmlsZUlucHV0IiwiY2xpY2siLCJmaWxlIiwidGFyZ2V0IiwiZmlsZXMiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwicmVhZEFzRGF0YVVSTCIsIm9ubG9hZCIsImFkZFBob3RvIiwicmVzdWx0Iiwic3RhdHVzIiwib25l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MG1CUnNHLFNBQVNKLEVBQU9LLFFBQVF0RCxNQUMzQixTQUFBQyxHQUNFLEdBQUlBLEVBQVNJLEdBNW1CSnRELEVBNm1CRlcsWUFDQSxHQUF3QixNQUFwQnVDLEVBQVNzRCxPQUNsQixPQUFPdEQsRUFBU0ssVUFHcEIsU0FBQUssR0FsbkJXNUQsRUFtbkJKNkQsWUFBWSxDQUNmaEQsUUFBUytDLFFBTWpCc0MsRUFBT08sUUFBVSxXQTFuQkZ6RyxFQTJuQlI2RCxZQUFZLENBQ2ZoRCxRQUFTcUYsRUFBT3RDLE1BQ2hCOUMscUJBQXNCLHFDQUFGLE9BQXVDb0YsRUFBT3RDLFdBUXhFLGVBQWdCLFNBQUFnQyxHQUNkLElBQ1FwRCxFQURhb0QsRUFBRUksT0FBT1UsUUFBUSxhQUNMakIsUUFBekJqRCxRQUVGQSxHQXpvQlN4QyxFQTBvQlIyRyxhQUFhbkUsR0FBU1MsTUFDekIsU0FBQUMsR0FDRSxHQUFJQSxFQUFTSSxHQTVvQkp0RCxFQTZvQkZXLFlBQ0EsR0FBd0IsTUFBcEJ1QyxFQUFTc0QsT0FDbEIsT0FBT3RELEVBQVNLLFVBR3BCLFNBQUFLLEdBbHBCVzVELEVBbXBCSjZELFlBQVksQ0FDZmhELFFBQVMrQyxRQVVuQixlQUFnQixTQUFBZ0MsR0FDZCxJQUNRcEQsRUFEYW9ELEVBQUVJLE9BQU9VLFFBQVEsYUFDTGpCLFFBQXpCakQsUUFFRkEsR0FscUJTeEMsRUFtcUJSNEcsZ0JBQWdCcEUsR0FBU1MsTUFDNUIsU0FBQUMsR0FDRSxHQUFJQSxFQUFTSSxHQXJxQkp0RCxFQXNxQkZXLFlBQ0EsR0FBd0IsTUFBcEJ1QyxFQUFTc0QsT0FDbEIsT0FBT3RELEVBQVNLLFVBR3BCLFNBQUFLLEdBM3FCVzVELEVBNHFCSjZELFlBQVksQ0FDZmhELFFBQVMrQyxVIiwiZmlsZSI6IlZpc2lvblBob3RvR2FsbGVyeS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIlZpc2lvblBob3RvR2FsbGVyeVwiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJWaXNpb25QaG90b0dhbGxlcnlcIl0gPSBmYWN0b3J5KCk7XG59KSh0aGlzLCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgZGVmaW5pdGlvbikge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmosIHByb3ApIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApOyB9IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCBcIi4vYXBwLnNjc3NcIjtcblxuLyoqXG4gKiDQmtC70LDRgdGBINCz0LDQu9C10YDQtdC4LlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBWaXNpb25QaG90b0dhbGxlcnkge1xuICBzdGF0aWMgZW1wbG95ZWVJZCA9IG51bGw7XG4gIHN0YXRpYyB2aXNpb25QZXJzb25JZCA9IG51bGw7XG4gIHN0YXRpYyByb290RWxlbWVudCA9IG51bGw7XG4gIHN0YXRpYyB0b2tlbiA9IG51bGw7XG4gIHN0YXRpYyBjb250cm9scyA9IHtcbiAgICBkaXNhYmxlQWxsOiBmYWxzZSxcbiAgICB1cGRhdGU6IHRydWUsXG4gICAgdXBsb2FkOiB0cnVlLFxuICAgIHJlbW92ZTogdHJ1ZVxuICB9O1xuICBzdGF0aWMgbWFzdGVyQWxidW0gPSB0cnVlO1xuXG4gIC8qKlxuICAgKiDQmtC+0L3RgdGC0YDRg9C60YLQvtGAINGN0LrQt9C10LzQv9C70Y/RgNCwINC60LvQsNGB0YHQsCDQs9Cw0LvQtdGA0LXQuC5cbiAgICogQHBhcmFtIHJvb3Qge3N0cmluZ30gSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAsINC60YPQtNCwINCx0YPQtNC10YIg0YDQtdC90LTQtdGA0LjRgtGM0YHRjyDQs9Cw0LvQtdGA0LXRjy5cbiAgICogQHBhcmFtIGVtcGxveWVlSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcGFyYW0gdmlzaW9uUGVyc29uSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKiBAcGFyYW0gcGVyc29uSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKiBAcGFyYW0gdG9rZW4ge3N0cmluZ30gQ1NSRi3RgtC+0LrQtdC9INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICogQHBhcmFtIGNvbnRyb2xzIHtvYmplY3R9INCd0LDRgdGC0YDQvtC50LrQsCDQvtGC0L7QsdGA0LDQttC10L3QuNGPINGN0LvQtdC80LXQvdGC0L7QsiDRg9C/0YDQsNCy0LvQtdC90LjRjy5cbiAgICogQHBhcmFtIGNvbnRyb2xzLmRpc2FibGVBbGwge2Jvb2xlYW59INCe0YLQutC70Y7Rh9C40YLRjCDQstGB0LUg0Y3Qu9C10LzQtdC90YLRiyDRg9C/0YDQsNCy0LvQtdC90LjRjy5cbiAgICogQHBhcmFtIGNvbnRyb2xzLnVwZGF0ZSB7Ym9vbGVhbn0g0J7RgtC+0LHRgNCw0LbQtdC90LjQtSDQutC90L7Qv9C60Lgg0L7QsdC90L7QstC70LXQvdC40Y8g0YTQvtGC0L7Qs9GA0LDRhNC40LggKNGD0YHRgtCw0L3QvtCy0LrQsCDQvtGB0L3QvtCy0L3QvtC5KS5cbiAgICogQHBhcmFtIGNvbnRyb2xzLnVwbG9hZCB7Ym9vbGVhbn0g0J7RgtC+0LHRgNCw0LbQtdC90LjQtSDQutC90L7Qv9C60Lgg0LfQsNCz0YDRg9C30LrQuCDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHBhcmFtIGNvbnRyb2xzLnJlbW92ZSB7Ym9vbGVhbn0g0J7RgtC+0LHRgNCw0LbQtdC90LjQtSDQutC90L7Qv9C60Lgg0YPQtNCw0LvQtdC90LjRjyDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHBhcmFtIG1hc3RlckFsYnVtIHtib29sZWFufSDQl9Cw0LPRgNGD0LfQutCwINGE0L7RgtC+0LPRgNCw0YTQuNC5INC40Lcg0LzQsNGB0YLQtdGALdCw0LvQsdC+0LzQsC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHtcbiAgICByb290LFxuICAgIGVtcGxveWVlSWQsXG4gICAgdmlzaW9uUGVyc29uSWQsXG4gICAgcGVyc29uSWQsXG4gICAgdG9rZW4sXG4gICAgY29udHJvbHMsXG4gICAgbWFzdGVyQWxidW0gPSB0cnVlXG4gIH0pIHtcbiAgICBpZiAoIXJvb3QpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcItCd0LUg0YPQutCw0LfQsNC9IElEINC60L7RgNC90LXQstC+0LPQviDRjdC70LXQvNC10L3RgtCwINC00LvRjyDQs9Cw0LvQtdGA0LXQuCFcIik7XG4gICAgfVxuXG4gICAgY29uc3Qgcm9vdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyb290KTtcblxuICAgIGlmICghIXJvb3RFbGVtZW50KSB7XG4gICAgICBWaXNpb25QaG90b0dhbGxlcnkucm9vdEVsZW1lbnQgPSByb290RWxlbWVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwi0J/RgNC+0LLQtdGA0YzRgtC1INGD0LrQsNC30LDQvdC90YvQuSBJRCDQutC+0YDQvdC10LLQvtCz0L4g0Y3Qu9C10LzQtdC90YLQsCDQtNC70Y8g0LPQsNC70LXRgNC10LghXCIpO1xuICAgIH1cblxuICAgIGlmICghZW1wbG95ZWVJZCAmJiAhdmlzaW9uUGVyc29uSWQgJiYgIXBlcnNvbklkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCLQndC1INGD0LrQsNC30LDQvSBJRCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8g0L3QsCDQv9C+0YDRgtCw0LvQtSBWaXNpb25cIik7XG4gICAgfVxuXG4gICAgdGhpcy5lbXBsb3llZUlkID0gZW1wbG95ZWVJZDtcbiAgICB0aGlzLnZpc2lvblBlcnNvbklkID0gdmlzaW9uUGVyc29uSWQ7XG4gICAgdGhpcy5wZXJzb25JZCA9IHBlcnNvbklkO1xuICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcbiAgICB0aGlzLmNvbnRyb2xzID0gY29udHJvbHM7XG4gICAgdGhpcy5tYXN0ZXJBbGJ1bSA9IG1hc3RlckFsYnVtO1xuXG4gICAgVmlzaW9uUGhvdG9HYWxsZXJ5LmRyYXcoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQsNC10LzRi9C5INC80LXRgtC+0LQg0LTQu9GPINC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKiBAdHlwZSB7bnVsbHxGdW5jdGlvbn0g0KTRg9C90LrRhtC40Y8g0L7QsdGA0LDQsdC+0YLRh9C40Log0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqL1xuICBzdGF0aWMgZXJyb3JGdW5jdGlvbiA9IG51bGw7XG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LXQvdC40LUg0LzQtdGC0L7QtNCwINC00LvRjyDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICogQHR5cGUge251bGx8RnVuY3Rpb259INCk0YPQvdC60YbQuNGPINC+0LHRgNCw0LHQvtGC0YfQuNC6INC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKi9cbiAgZ2V0IGVycm9yRnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFZpc2lvblBob3RvR2FsbGVyeS5lcnJvckZ1bmN0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C10L3QuNC1INC80LXRgtC+0LTQsCDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqIEBwYXJhbSBlcnJvckZ1bmN0aW9uIHtudWxsfEZ1bmN0aW9ufSDQpNGD0L3QutGG0LjRjyDQvtCx0YDQsNCx0L7RgtGH0LjQuiDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICovXG4gIHNldCBlcnJvckZ1bmN0aW9uKGVycm9yRnVuY3Rpb24pIHtcbiAgICBpZiAoZXJyb3JGdW5jdGlvbikge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LmVycm9yRnVuY3Rpb24gPSBlcnJvckZ1bmN0aW9uO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQntCx0L3QvtCy0LvQtdC90LjQtSDQv9Cw0YDQsNC80LXRgtGA0L7QsiDQs9Cw0LvQtdGA0LXQuC5cbiAgICogQHBhcmFtIGVtcGxveWVlSWQge251bWJlcnxudW1iZXJ9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcGFyYW0gdG9rZW4ge3N0cmluZ30gQ1NSRi3RgtC+0LrQtdC9INGB0LXRgdGB0Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPLlxuICAgKi9cbiAgc3RhdGljIHVwZGF0ZSh7IGVtcGxveWVlSWQsIHRva2VuIH0pIHtcbiAgICB0aGlzLmVtcGxveWVlSWQgPSBlbXBsb3llZUlkO1xuICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcblxuICAgIHRoaXMuZHJhdygpO1xuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0YwgSUQg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAqIEByZXR1cm4ge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKi9cbiAgZ2V0IGVtcGxveWVlSWQoKSB7XG4gICAgcmV0dXJuIFZpc2lvblBob3RvR2FsbGVyeS5lbXBsb3llZUlkO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C10L3QuNC1INGN0LrQt9C10LzQv9C70Y/RgNGDINCz0LDQu9C10YDQtdC4IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcGFyYW0gZW1wbG95ZWVJZCB7bnVtYmVyfHN0cmluZ30gSUQg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAqL1xuICBzZXQgZW1wbG95ZWVJZChlbXBsb3llZUlkKSB7XG4gICAgaWYgKGVtcGxveWVlSWQpIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS5lbXBsb3llZUlkID0gZW1wbG95ZWVJZDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0J/QvtC70YPRh9C40YLRjCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICogQHJldHVybiB7bnVtYmVyfHN0cmluZ30gSUQg0YHQvtGC0YDRg9C00L3QuNC60LAg0LDRg9GC0YHQvtGA0YHQtdGA0LAuXG4gICAqL1xuICBnZXQgdmlzaW9uUGVyc29uSWQoKSB7XG4gICAgcmV0dXJuIFZpc2lvblBob3RvR2FsbGVyeS52aXNpb25QZXJzb25JZDtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQtdC90LjQtSDRjdC60LfQtdC80L/Qu9GP0YDRgyDQs9Cw0LvQtdGA0LXQuCBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICogQHBhcmFtIHZpc2lvblBlcnNvbklkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsCDQsNGD0YLRgdC+0YDRgdC10YDQsC5cbiAgICovXG4gIHNldCB2aXNpb25QZXJzb25JZCh2aXNpb25QZXJzb25JZCkge1xuICAgIGlmICh2aXNpb25QZXJzb25JZCkge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LnZpc2lvblBlcnNvbklkID0gdmlzaW9uUGVyc29uSWQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0YwgSUQg0YHQvtGC0YDRg9C00L3QuNC60LAg0LDRg9GC0YHQvtGA0YHQtdGA0LAuXG4gICAqIEByZXR1cm4ge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwINCw0YPRgtGB0L7RgNGB0LXRgNCwLlxuICAgKi9cbiAgZ2V0IHBlcnNvbklkKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkucGVyc29uSWQ7XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LXQvdC40LUg0Y3QutC30LXQvNC/0LvRj9GA0YMg0LPQsNC70LXRgNC10LggSUQg0YHQvtGC0YDRg9C00L3QuNC60LAg0LDRg9GC0YHQvtGA0YHQtdGA0LAuXG4gICAqIEBwYXJhbSBwZXJzb25JZCB7bnVtYmVyfHN0cmluZ30gSUQg0YHQvtGC0YDRg9C00L3QuNC60LAg0LDRg9GC0YHQvtGA0YHQtdGA0LAuXG4gICAqL1xuICBzZXQgcGVyc29uSWQocGVyc29uSWQpIHtcbiAgICBpZiAocGVyc29uSWQpIHtcbiAgICAgIFZpc2lvblBob3RvR2FsbGVyeS5wZXJzb25JZCA9IHBlcnNvbklkO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQmtC+0YDQvdC10LLQvtC5INGN0LvQtdC80LXQvdGCLCDQsiDQutC+0YLQvtGA0YvQuSDQsdGD0LTQtdGCINGA0LXQvdC00LXRgNC40YLRjNGB0Y8g0LPQsNC70LXRgNC10Y8uXG4gICAqIEByZXR1cm4ge251bGx8RWxlbWVudH0g0JrQvtGA0L3QtdCy0L7QuSDRjdC70LXQvNC10L3RgiDQtNC70Y8g0YDQtdC90LTQtdGA0LAuXG4gICAqL1xuICBnZXQgcm9vdEVsZW1lbnQoKSB7XG4gICAgcmV0dXJuIFZpc2lvblBob3RvR2FsbGVyeS5yb290RWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LjRgtGMIENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC40Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPLlxuICAgKiBAcmV0dXJuIHtudWxsfHN0cmluZ30gQ1NSRi3RgtC+0LrQtdC9INGB0LXRgdGB0LjQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8uXG4gICAqL1xuICBnZXQgdG9rZW4oKSB7XG4gICAgcmV0dXJuIFZpc2lvblBob3RvR2FsbGVyeS50b2tlbjtcbiAgfVxuXG4gIC8qKlxuICAgKiDQndCw0LfQvdCw0YfQuNGC0YwgQ1NSRi3RgtC+0LrQtdC9INGB0LXRgdGB0LjQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8uXG4gICAqIEBwYXJhbSB0b2tlbiB7c3RyaW5nfSBDU1JGLdGC0L7QutC10L0g0YHQtdGB0YHQuNC4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICovXG4gIHNldCB0b2tlbih0b2tlbikge1xuICAgIGlmICh0b2tlbikge1xuICAgICAgVmlzaW9uUGhvdG9HYWxsZXJ5LnRva2VuID0gdG9rZW47XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0Ywg0LfQvdCw0YfQtdC90LjQtSDRgdC+0YHRgtC+0Y/QvdC40Y8g0LrQvtC90YLRgNC+0LvQvtCyLlxuICAgKiBAcmV0dXJuIHtib29sZWFufSDQodC+0YHRgtC+0Y/QvdC40LUg0LrQvtC90YLRgNC+0LvQvtCyLlxuICAgKi9cbiAgZ2V0IGNvbnRyb2xzKCkge1xuICAgIHJldHVybiBWaXNpb25QaG90b0dhbGxlcnkuY29udHJvbHM7XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LjRgtGMINC30L3QsNGH0LXQvdC40LUg0YHQvtGB0YLQvtGP0L3QuNGPINC60L7QvdGC0YDQvtC70L7Qsi5cbiAgICogQHBhcmFtIHZhbHVlIHtib29sZWFufSDQktC60LvRjtGH0LjRgtGML9C+0YLQutC70Y7Rh9C40YLRjCDQutC+0L3RgtGA0L7Qu9GLLlxuICAgKi9cbiAgc2V0IGNvbnRyb2xzKHZhbHVlKSB7XG4gICAgVmlzaW9uUGhvdG9HYWxsZXJ5LmNvbnRyb2xzID0ge1xuICAgICAgLi4uVmlzaW9uUGhvdG9HYWxsZXJ5LmNvbnRyb2xzLFxuICAgICAgLi4udmFsdWVcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0Ywg0YTQu9Cw0LMg0LfQsNCz0YDRg9C30LrQuCDRhNC+0YLQvtCz0YDQsNGE0LjQuSDQuNC3INC80LDRgdGC0LXRgC3QsNC70YzQsdC+0LzQsC5cbiAgICogQHJldHVybiB7Ym9vbGVhbn0g0KHQvtGB0YLQvtGP0L3QuNC1INGE0LvQsNCz0LAg0LfQsNCz0YDRg9C30LrQuCDRhNC+0YLQvtCz0YDQsNGE0LjQuSDQuNC3INC80LDRgdGC0LXRgC3QsNC70YzQsdC+0LzQsC5cbiAgICovXG4gIGdldCBtYXN0ZXJBbGJ1bSgpIHtcbiAgICByZXR1cm4gVmlzaW9uUGhvdG9HYWxsZXJ5Lm1hc3RlckFsYnVtO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9C40YLRjCDRhNC70LDQsyDQt9Cw0LPRgNGD0LfQutC4INGE0L7RgtC+0LPRgNCw0YTQuNC5INC40Lcg0LzQsNGB0YLQtdGALdCw0LvRjNCx0L7QvNCwLlxuICAgKiBAcGFyYW0gdmFsdWUge2Jvb2xlYW59INCS0LrQu9GO0YfQuNGC0Ywv0LLRi9C60LvRjtGH0LjRgtGMINC30LDQs9GA0YPQt9C60YMg0LjQtyDQvNCw0YHRgtC10YAt0LDQu9GM0LHQvtC80LAuXG4gICAqL1xuICBzZXQgbWFzdGVyQWxidW0odmFsdWUpIHtcbiAgICBWaXNpb25QaG90b0dhbGxlcnkubWFzdGVyQWxidW0gPSB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQntCx0YDQsNCx0L7RgtGH0LjQuiDQvtGI0LjQsdC+0LouXG4gICAqIEBwYXJhbSBwYXJhbXMubWVzc2FnZSB7c3RyaW5nfSDQodC+0L7QsdGJ0LXQvdC40LUg0L7QsSDQvtGI0LjQsdC60LUuXG4gICAqIEBwYXJhbSBwYXJhbXMuYmxvY2tpbmdFcnJvck1lc3NhZ2Uge3N0cmluZ30g0JHQu9C+0LrQuNGA0YPRjtGJ0LXQtSDQv9C+0YLQvtC6INGB0L7QvtCx0YnQtdC90LjQtSDQvtCxINC+0YjQuNCx0LrQtS5cbiAgICovXG4gIHN0YXRpYyBoYW5kbGVFcnJvcihwYXJhbXMpIHtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIGJsb2NraW5nRXJyb3JNZXNzYWdlIH0gPSBwYXJhbXM7XG5cbiAgICBpZiAodGhpcy5lcnJvckZ1bmN0aW9uKSB7XG4gICAgICBsZXQgbWVzc2FnZVN0cmluZyA9IFwiXCI7XG5cbiAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICBpZiAobWVzc2FnZS5mYXVsdHN0cmluZykge1xuICAgICAgICAgIG1lc3NhZ2VTdHJpbmcgPSBtZXNzYWdlLmZhdWx0c3RyaW5nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIE9iamVjdC5rZXlzKG1lc3NhZ2UpXG4gICAgICAgICAgICAucmV2ZXJzZSgpXG4gICAgICAgICAgICAuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgICBtZXNzYWdlU3RyaW5nICs9IGAke21lc3NhZ2Vba2V5XX08YnIvPmA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBtZXNzYWdlU3RyaW5nLmxlbmd0aFxuICAgICAgICA/IG1lc3NhZ2VTdHJpbmdcbiAgICAgICAgOiBKU09OLnN0cmluZ2lmeShtZXNzYWdlKTtcblxuICAgICAgdGhpcy5lcnJvckZ1bmN0aW9uKGVycm9yTWVzc2FnZSwgXCLQntGI0LjQsdC60LBcIik7XG4gICAgfSBlbHNlIGlmIChibG9ja2luZ0Vycm9yTWVzc2FnZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGJsb2NraW5nRXJyb3JNZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCe0LHRkdGA0YLQutCwINC00LvRjyDQt9Cw0L/RgNC+0YHQvtCyINC6IEFQSS5cbiAgICogQHBhcmFtIHJlcXVlc3RQYXRoIHtzdHJpbmd9INCd0LDQt9Cy0LDQvdC40LUg0LzQtdGC0L7QtNCwIEFQSS5cbiAgICogQHBhcmFtIHJlcXVlc3RCb2R5IHtvYmplY3R9INCf0LDRgNCw0LzQtdGC0YDRiyDQt9Cw0L/RgNC+0YHQsC5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgcmVxdWVzdCh7IHJlcXVlc3RQYXRoLCByZXF1ZXN0Qm9keSB9KSB7XG4gICAgY29uc3QgcmVxdWVzdERlZmF1bHRzID0ge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIG1vZGU6IFwic2FtZS1vcmlnaW5cIixcbiAgICAgIGNyZWRlbnRpYWxzOiBcInNhbWUtb3JpZ2luXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBcIlgtQ1NSRlRva2VuXCI6IHRoaXMudG9rZW5cbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSlcbiAgICB9O1xuXG4gICAgcmV0dXJuIGZldGNoKGAvYXBpL3YyL3Zpc2lvbi8ke3JlcXVlc3RQYXRofS9gLCByZXF1ZXN0RGVmYXVsdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqINCS0YvQs9GA0YPQt9C60LAg0LLRgdC10YUg0YTQvtGC0L7Qs9GA0LDRhNC40Lkg0YEg0L/QvtGA0YLQsNC70LAgVmlzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIGdldFBob3RvcygpIHtcbiAgICBjb25zdCBlbXBsb3llZSA9IHt9O1xuXG4gICAgaWYgKHRoaXMuZW1wbG95ZWVJZCAmJiAhdGhpcy52aXNpb25QZXJzb25JZCkge1xuICAgICAgZW1wbG95ZWUuZW1wbG95ZWVJZCA9IHRoaXMuZW1wbG95ZWVJZDtcbiAgICB9IGVsc2UgaWYgKHRoaXMudmlzaW9uUGVyc29uSWQpIHtcbiAgICAgIGVtcGxveWVlLnZpc2lvbl9wZXJzb25faWQgPSB0aGlzLnZpc2lvblBlcnNvbklkO1xuICAgIH0gZWxzZSBpZiAodGhpcy5wZXJzb25JZCkge1xuICAgICAgZW1wbG95ZWUucGVyc29uSWQgPSB0aGlzLnBlcnNvbklkO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgcmVxdWVzdFBhdGg6IFwiZ2V0X3Bob3Rvc1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgLi4uZW1wbG95ZWUsXG4gICAgICAgIG1hc3RlckFsYnVtOiB0aGlzLm1hc3RlckFsYnVtXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0JfQsNC/0YDQvtGBINC90LAg0LTQvtCx0LDQstC70LXQvdC40LUgKNC30LDQs9GA0YPQt9C60YMpINGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gaW1hZ2Uge0J1ZmZlckVuY29kaW5nfSDQpNC+0YLQvtCz0YDQsNGE0LjQuCDQsiDRhNC+0YDQvNCw0YLQtSBCYXNlNjQuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINGBINGA0LXQt9GD0LvRjNGC0LDRgtC+0Lwg0LLRi9C/0L7Qu9C90LXQvdC40Y8g0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgYWRkUGhvdG8oaW1hZ2UpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiBcImFkZF9waG90b1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgZW1wbG95ZWVJZDogdGhpcy5lbXBsb3llZUlkLFxuICAgICAgICBpbWFnZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCX0LDQv9GA0L7RgSDQvdCwINGD0LTQsNC70LXQvdC40LUg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwaG90b0lkIHtOdW1iZXJ9IElEINGE0L7RgtC+0LPRgNCw0YTQuNC4INC90LAg0L/QvtGA0YLQsNC70LUgVmlzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIGRlbGV0ZVBob3RvKHBob3RvSWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiBcImRlbGV0ZV9waG90b1wiLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgcGhvdG9faWQ6IHBob3RvSWRcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDQvtCx0L3QvtCy0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHBhcmFtIHBob3RvSWQge051bWJlcn0gSUQg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0L3QsCDQv9C+0YDRgtCw0LvQtSBWaXNpb24uXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINGBINGA0LXQt9GD0LvRjNGC0LDRgtC+0Lwg0LLRi9C/0L7Qu9C90LXQvdC40Y8g0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgdXBkYXRlUGhvdG8ocGhvdG9JZCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgcmVxdWVzdFBhdGg6IFwidXBkYXRlX3Bob3RvXCIsXG4gICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICBlbXBsb3llZUlkOiB0aGlzLmVtcGxveWVlSWQsXG4gICAgICAgIHBob3RvX2lkOiBwaG90b0lkXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0JfQsNC/0YDQvtGBINC90LAg0YPRgdGC0LDQvdC+0LLQutGDINGE0L7RgtC+0LPRgNCw0YTQuNC4INC60LDQuiDQvtGB0L3QvtCy0L3QvtC5INC00LvRjyDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICogQHBhcmFtIHBob3RvSWQge051bWJlcn0gSUQg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0L3QsCDQv9C+0YDRgtCw0LvQtSBWaXNpb24uXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINGBINGA0LXQt9GD0LvRjNGC0LDRgtC+0Lwg0LLRi9C/0L7Qu9C90LXQvdC40Y8g0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgc2V0QXNNYWluUGhvdG8ocGhvdG9JZCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgcmVxdWVzdFBhdGg6IFwic2V0X21haW5fcGhvdG9cIixcbiAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgIGVtcGxveWVlSWQ6IHRoaXMuZW1wbG95ZWVJZCxcbiAgICAgICAgcGhvdG9JZDogcGhvdG9JZFxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCe0YLRgNC40YHQvtCy0LrQsCBET00g0LPQsNC70LXRgNC10LjQuC5cbiAgICovXG4gIHN0YXRpYyBkcmF3KCkge1xuICAgIGNvbnN0IHJvb3RFbGVtZW50ID0gdGhpcy5yb290RWxlbWVudDtcblxuICAgIHJvb3RFbGVtZW50LmlubmVySFRNTCA9IGBcbiAgICAgIDxkaXYgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeSB2aXNpb24tcGhvdG8tZ2FsbGVyeS0tbWVzc2FnZVwiIGRhdGEtbWVzc2FnZT1cItCX0LDQs9GA0YPQt9C60LAuLi5cIj5cbiAgICAgICAgPGlucHV0IHR5cGU9XCJmaWxlXCIgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9fZmlsZS1maWVsZFwiIHRhYmluZGV4PVwiLTFcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X19pdGVtIHZpc2lvbi1waG90by1nYWxsZXJ5X19pdGVtLS1tYWluXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInZnLW1haW4tcGhvdG9cIj48L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9faXRlbVwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2Zy1nYWxsZXJ5XCI+PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgYDtcblxuICAgIGNvbnN0IGdhbGxlcnlDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnZpc2lvbi1waG90by1nYWxsZXJ5XCIpO1xuICAgIGNvbnN0IG1haW5QaG90b0NvbnRhaW5lciA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmctbWFpbi1waG90b1wiKTtcbiAgICBjb25zdCBnYWxsZXJ5ID0gcm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi52Zy1nYWxsZXJ5XCIpO1xuICAgIGNvbnN0IHsgdXBsb2FkIH0gPSB0aGlzLmNvbnRyb2xzO1xuXG4gICAgdGhpcy5nZXRQaG90b3MoKVxuICAgICAgLnRoZW4oXG4gICAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgICBtYWluUGhvdG9Db250YWluZXIuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQoe1xuICAgICAgICAgICAgbWFpbjogdHJ1ZSxcbiAgICAgICAgICAgIGVtcHR5OiB0cnVlLFxuICAgICAgICAgICAgcGhvdG9JZDogbnVsbFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKHVwbG9hZCkge1xuICAgICAgICAgICAgZ2FsbGVyeS5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudCh7XG4gICAgICAgICAgICAgIG1haW46IGZhbHNlLFxuICAgICAgICAgICAgICBlbXB0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgcGhvdG9JZDogbnVsbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtYWluUGhvdG9Db250YWluZXIuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVOb1Bob3RvRWxlbWVudCgpO1xuXG4gICAgICAgICAgICBnYWxsZXJ5Q29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJ2aXNpb24tcGhvdG8tZ2FsbGVyeS0tbWVzc2FnZVwiKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgICB9XG4gICAgICApXG4gICAgICAudGhlbihcbiAgICAgICAgcmVzcG9uc2VKc29uID0+IHtcbiAgICAgICAgICBpZiAoIXJlc3BvbnNlSnNvbiB8fCAhcmVzcG9uc2VKc29uLmxlbmd0aCkge1xuICAgICAgICAgICAgbWFpblBob3RvQ29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMuY3JlYXRlTm9QaG90b0VsZW1lbnQoKTtcbiAgICAgICAgICAgIGdhbGxlcnkucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgZ2FsbGVyeUNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwidmlzaW9uLXBob3RvLWdhbGxlcnktLW1lc3NhZ2VcIik7XG5cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBtYWluUGhvdG9EYXRhID0gcmVzcG9uc2VKc29uLmZpbmQoKHsgbWFpbiB9KSA9PiBtYWluKTtcbiAgICAgICAgICBjb25zdCBnYWxsZXJ5UGhvdG9zRGF0YSA9IHJlc3BvbnNlSnNvbi5maWx0ZXIoKHsgbWFpbiB9KSA9PiAhbWFpbik7XG5cbiAgICAgICAgICBpZiAoISFtYWluUGhvdG9EYXRhKSB7XG4gICAgICAgICAgICBtYWluUGhvdG9Db250YWluZXIuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQoXG4gICAgICAgICAgICAgIG1haW5QaG90b0RhdGFcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGdhbGxlcnlQaG90b3NEYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IGdhbGxlcnlQaG90b3NIdG1sID0gXCJcIjtcblxuICAgICAgICAgICAgZ2FsbGVyeVBob3Rvc0RhdGEuZm9yRWFjaChcbiAgICAgICAgICAgICAgcGhvdG9EYXRhID0+XG4gICAgICAgICAgICAgICAgKGdhbGxlcnlQaG90b3NIdG1sICs9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHBob3RvRGF0YSkpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAodXBsb2FkKSB7XG4gICAgICAgICAgICAgIGdhbGxlcnlQaG90b3NIdG1sICs9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHtcbiAgICAgICAgICAgICAgICBtYWluOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbXB0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwaG90b0lkOiBudWxsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBnYWxsZXJ5LmlubmVySFRNTCA9IGdhbGxlcnlQaG90b3NIdG1sO1xuICAgICAgICAgIH0gZWxzZSBpZiAoIXVwbG9hZCkge1xuICAgICAgICAgICAgZ2FsbGVyeS5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgICAgICAgZ2FsbGVyeUNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwidmlzaW9uLXBob3RvLWdhbGxlcnktLW1lc3NhZ2VcIik7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVFcnJvcih7XG4gICAgICAgICAgbWVzc2FnZTogZXJyb3JcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgICAgfSk7XG5cbiAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQo9C90LjQstC10YDRgdCw0LvRjNC90YvQuSDQvNC10YLQvtC0INC00LvRjyDRgdC+0LfQtNCw0L3QuNGPINGN0LvQtdC80LXQvdGC0LAg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwYXJhbXMucGhvdG9JZCB7bnVtYmVyfSBJRCDRhNC+0YLQvtCz0YDQsNGE0LjQuCDQvdCwINC/0L7RgNGC0LDQu9C1IFZpc2lvbi5cbiAgICogQHBhcmFtIHBhcmFtcy5tYWluIHtib29sZWFufSAg0KTQu9Cw0LMg0L7RgdC90L7QstC90L7Qs9C+INGE0L7RgtC+LlxuICAgKiBAcGFyYW0gcGFyYW1zLmVtcHR5IHtib29sZWFufSDQpNC70LDQsyBcItC/0YPRgdGC0L7Qs9C+XCIg0YTQvtGC0L4sINC40YHQv9C+0LvRjNC30YPQtdGC0YHRjyDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQutC90L7Qv9C60Lgg0LfQsNCz0YDRg9C30LrQuC5cbiAgICogQHBhcmFtIHBhcmFtcy5wYXRoIHtzdHJpbmd9INCf0YPRgtGMINC6INGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gcGFyYW1zLmF2YXRhclVybCB7c3RyaW5nfSDQn9GD0YLRjCDQuiDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHJldHVybnMge3N0cmluZ30g0K3Qu9C10LzQtdC90YIg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0LIg0LLQuNC00LUg0YHRgtGA0L7QutC4LlxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZVBob3RvRWxlbWVudChwYXJhbXMpIHtcbiAgICBjb25zdCB7IHBob3RvSWQsIG1haW4sIGVtcHR5LCBwYXRoLCBhdmF0YXJVcmwgfSA9IHBhcmFtcztcbiAgICBjb25zdCB7IGRpc2FibGVBbGwsIHVwbG9hZCwgdXBkYXRlLCByZW1vdmUgfSA9IHRoaXMuY29udHJvbHM7XG4gICAgbGV0IGJ1dHRvbnMgPSBcIlwiO1xuICAgIGxldCBlbGVtZW50Q2xhc3NlcyA9IFwiXCI7XG4gICAgbGV0IGJhY2tncm91bmRJbWFnZSA9IFwiXCI7XG4gICAgbGV0IG1haW5BdHRyaWJ1dGUgPSBcIlwiO1xuXG4gICAgaWYgKCFhdmF0YXJVcmwgJiYgcGF0aCkge1xuICAgICAgYmFja2dyb3VuZEltYWdlID0gYHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7cGF0aH0pXCJgO1xuICAgIH1cblxuICAgIGlmIChhdmF0YXJVcmwpIHtcbiAgICAgIGJhY2tncm91bmRJbWFnZSA9IGBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgke2F2YXRhclVybH0pXCJgO1xuICAgIH1cblxuICAgIGlmIChtYWluKSB7XG4gICAgICBtYWluQXR0cmlidXRlID0gYGRhdGEtbWFpbj1cIiR7bWFpbn1cImA7XG5cbiAgICAgIGlmIChlbXB0eSkge1xuICAgICAgICBlbGVtZW50Q2xhc3NlcyA9IFwidmctcGhvdG8gdmctcGhvdG8tLW1haW5cIjtcbiAgICAgICAgYnV0dG9ucyA9IFZpc2lvblBob3RvR2FsbGVyeS5nZXRQaG90b0J1dHRvbnMoe1xuICAgICAgICAgIHVwbG9hZFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnRDbGFzc2VzID0gXCJ2Zy1waG90byB2Zy1waG90by0tbWFpblwiO1xuICAgICAgICBidXR0b25zID0gVmlzaW9uUGhvdG9HYWxsZXJ5LmdldFBob3RvQnV0dG9ucyh7XG4gICAgICAgICAgcmVtb3ZlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoZW1wdHkpIHtcbiAgICAgICAgZWxlbWVudENsYXNzZXMgPSBcInZnLWdhbGxlcnlfX2l0ZW0gdmctcGhvdG8gdmctcGhvdG8tLXVwbG9hZFwiO1xuICAgICAgICBidXR0b25zID0gVmlzaW9uUGhvdG9HYWxsZXJ5LmdldFBob3RvQnV0dG9ucyh7XG4gICAgICAgICAgdXBsb2FkSWNvbjogdXBsb2FkXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWxlbWVudENsYXNzZXMgPSBcInZnLWdhbGxlcnlfX2l0ZW0gdmctcGhvdG9cIjtcbiAgICAgICAgYnV0dG9ucyA9IFZpc2lvblBob3RvR2FsbGVyeS5nZXRQaG90b0J1dHRvbnMoe1xuICAgICAgICAgIHVwZGF0ZSxcbiAgICAgICAgICByZW1vdmVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGBcbiAgICAgIDxkaXYgY2xhc3M9XCIke2VsZW1lbnRDbGFzc2VzfVwiXG4gICAgICAgICR7YmFja2dyb3VuZEltYWdlfVxuICAgICAgICBkYXRhLXBob3RvLWlkPVwiJHtwaG90b0lkfVwiXG4gICAgICAgICR7bWFpbkF0dHJpYnV0ZX0+XG4gICAgICAgICR7ZGlzYWJsZUFsbCA/IFZpc2lvblBob3RvR2FsbGVyeS5wcm90b3R5cGUubm9QaG90b1N2ZyA6IGJ1dHRvbnN9XG4gICAgICAgIDwvZGl2PlxuICAgICAgYDtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVOb1Bob3RvRWxlbWVudCgpIHtcbiAgICByZXR1cm4gYFxuICAgICAgPGRpdiBjbGFzcz1cInZnLXBob3RvIHZnLXBob3RvLS1tYWluXCI+XG4gICAgICAgIDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHZpZXdCb3g9XCItMjU2IC0yNTYgMTAyNCAxMDI0XCI+XG4gICAgICAgICAgPHBhdGggZmlsbD1cIiM0YTUyNjZcIlxuICAgICAgICAgICAgZD1cIk00MzcgMzEwLjhjLTI4LjQtMjguNC02Mi4yLTQ5LjItOTkuMS02MS43IDM0LjEtMjUuMiA1Ni4yLTY1LjYgNTYuMi0xMTEuMUMzOTQuMSA2MS45IDMzMi4xIDAgMjU2IDBTMTE3LjkgNjEuOSAxMTcuOSAxMzguMWMwIDQ1LjUgMjIuMSA4NS45IDU2LjIgMTExLjEgLTM2LjkgMTIuNC03MC44IDMzLjMtOTkuMSA2MS43QzI2LjYgMzU5LjIgMCA0MjMuNSAwIDQ5MS44IDAgNTAzIDkgNTEyIDIwLjIgNTEyaDQ3MS43YzExLjEgMCAyMC4yLTkgMjAuMi0yMC4yQzUxMiA0MjMuNSA0ODUuNCAzNTkuMiA0MzcgMzEwLjh6TTE1OC4yIDEzOC4xYzAtNTMuOSA0My45LTk3LjggOTcuOC05Ny44IDUzLjkgMCA5Ny44IDQzLjkgOTcuOCA5Ny44IDAgNTMuOS00My45IDk3LjgtOTcuOCA5Ny44QzIwMi4xIDIzNS44IDE1OC4yIDE5MiAxNTguMiAxMzguMXpNNDEuMiA0NzEuN0M1MS40IDM2Mi4yIDE0My45IDI3Ni4yIDI1NiAyNzYuMnMyMDQuNiA4NiAyMTQuOCAxOTUuNUg0MS4yelwiLz5cbiAgICAgICAgPC9zdmc+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0Ywg0LrQvdC+0L/QutGDINC/0L4g0L/QtdGA0LXQtNCw0LLQsNC10LzRi9C8INC/0LDRgNCw0LzQtdGC0YDQsNC8LlxuICAgKiBAcGFyYW0gcGFyYW1zLmRpc2FibGVBbGwge2Jvb2xlYW59INCe0YLQutC70Y7Rh9C40YLRjCDQstGB0LUg0LrQvdC+0L/QutC4LlxuICAgKiBAcGFyYW0gcGFyYW1zLnJlbW92ZSB7Ym9vbGVhbn0g0JrQvdC+0L/QutCwINGD0LTQsNC70LXQvdC40Y8uXG4gICAqIEBwYXJhbSBwYXJhbXMudXBsb2FkIHtib29sZWFufSDQmtC90L7Qv9C60LAg0LfQsNCz0YDRg9C30LrQuC5cbiAgICogQHBhcmFtIHBhcmFtcy51cGxvYWRJY29uIHtib29sZWFufSDQmtC90L7Qv9C60LAg0LfQsNCz0YDRg9C30LrQuCDQsiDQstC40LTQtSDQuNC60L7QvdC60LguXG4gICAqIEBwYXJhbSBwYXJhbXMuc2VsZWN0IHtib29sZWFufSDQmtC90L7Qv9C60LAg0LLRi9Cx0L7RgNCwINGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKi9cbiAgc3RhdGljIGdldFBob3RvQnV0dG9ucyhwYXJhbXMpIHtcbiAgICBpZiAocGFyYW1zLmRpc2FibGVBbGwpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cblxuICAgIGNvbnN0IGJ1dHRvbnMgPSB7XG4gICAgICByZW1vdmU6IGA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS1yZWRcIiBkYXRhLWFjdGlvbj1cInJlbW92ZS1waG90b1wiPtCj0LTQsNC70LjRgtGMPC9idXR0b24+YCxcbiAgICAgIHVwbG9hZDogYDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvblwiIGRhdGEtYWN0aW9uPVwidXBsb2FkLXBob3RvXCI+0JfQsNCz0YDRg9C30LjRgtGMPC9idXR0b24+YCxcbiAgICAgIHVwbG9hZEljb246IGA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS11cGxvYWRcIiBkYXRhLWFjdGlvbj1cInVwbG9hZC1waG90b1wiPiYjNDM7PC9idXR0b24+YCxcbiAgICAgIHVwZGF0ZTogYDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvbiB2Zy1idXR0b24tLWdyZWVuXCIgZGF0YS1hY3Rpb249XCJ1cGRhdGUtcGhvdG9cIj7QktGL0LHRgNCw0YLRjDwvYnV0dG9uPmBcbiAgICB9O1xuXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHBhcmFtcykucmVkdWNlKChidXR0b25zU3RyaW5nLCBrZXkpID0+IHtcbiAgICAgIGlmIChwYXJhbXNba2V5XSkge1xuICAgICAgICBidXR0b25zU3RyaW5nICs9IGJ1dHRvbnNba2V5XTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGJ1dHRvbnNTdHJpbmc7XG4gICAgfSwgXCJcIik7XG4gIH1cblxuICAvKipcbiAgICog0JjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0YHQvtCx0YvRgtC40Lkg0LTQu9GPINC60L3QvtC/0L7QuiDQs9Cw0LvQtdGA0LXQuC5cbiAgICovXG4gIHN0YXRpYyBpbml0RXZlbnRzKCkge1xuICAgIGNvbnN0IHsgcm9vdEVsZW1lbnQgfSA9IHRoaXM7XG4gICAgY29uc3QgYnV0dG9ucyA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJidXR0b25cIik7XG5cbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICBcImNsaWNrXCIsXG4gICAgICAgIHRoaXMucm91dGVyW2J1dHRvbi5kYXRhc2V0LmFjdGlvbl0sXG4gICAgICAgIGZhbHNlXG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCg0L7Rg9GC0LXRgC5cbiAgICogQHR5cGUge3tcInJlbW92ZS1waG90b1wiOiBmdW5jdGlvbigqKTogdm9pZCwgXCJmaWxlLWlucHV0LWNoYW5nZWRcIjogZnVuY3Rpb24oKik6IHZvaWQsIFwidXBsb2FkLXBob3RvXCI6IGZ1bmN0aW9uKCopOiB2b2lkLCBcInVwZGF0ZS1waG90b1wiOiBmdW5jdGlvbigqKTogdm9pZH19XG4gICAqL1xuICBzdGF0aWMgcm91dGVyID0ge1xuICAgIC8qKlxuICAgICAqINCX0LDQs9GA0YPQt9C60LAg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAgICogQHBhcmFtIGUge0V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICBcInVwbG9hZC1waG90b1wiOiBlID0+IHtcbiAgICAgIGNvbnN0IGZpbGVJbnB1dCA9IHRoaXMucm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1cImZpbGVcIl0nKTtcblxuICAgICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgdGhpcy5yb3V0ZXJbXCJmaWxlLWlucHV0LWNoYW5nZWRcIl0pO1xuICAgICAgZmlsZUlucHV0LmNsaWNrKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDQodC70YPRiNCw0YLQtdC70Ywg0YHQvtCx0YvRgtC40Y8g0LjQt9C80LXQvdC10L3QuNGPINGE0LDQudC70L7QstC+0LPQviDQv9C+0LvRjyDQstCy0L7QtNCwLlxuICAgICAqIEBwYXJhbSBlIHtldmVudH0g0KHQvtCx0YvRgtC40LUuXG4gICAgICovXG4gICAgXCJmaWxlLWlucHV0LWNoYW5nZWRcIjogZSA9PiB7XG4gICAgICBjb25zdCBmaWxlID0gZS50YXJnZXQuZmlsZXNbMF07XG4gICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcblxuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5hZGRQaG90byhyZWFkZXIucmVzdWx0KS50aGVuKFxuICAgICAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfTtcblxuICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgIG1lc3NhZ2U6IHJlYWRlci5lcnJvcixcbiAgICAgICAgICBibG9ja2luZ0Vycm9yTWVzc2FnZTogYNCe0YjQuNCx0LrQsCDQt9Cw0LPRgNGD0LfQutC4INGE0L7RgtC+0LPRgNCw0YTQuNC4ICgt0LjQuSk6ICR7cmVhZGVyLmVycm9yfWBcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH0sXG4gICAgLyoqXG4gICAgICog0JfQsNC/0YDQvtGBINC90LAg0YPQtNCw0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICAgKiBAcGFyYW0gZSB7RXZlbnR9INCh0L7QsdGL0YLQuNC1LlxuICAgICAqL1xuICAgIFwicmVtb3ZlLXBob3RvXCI6IGUgPT4ge1xuICAgICAgY29uc3QgcGhvdG9FbGVtZW50ID0gZS50YXJnZXQuY2xvc2VzdChcIi52Zy1waG90b1wiKTtcbiAgICAgIGNvbnN0IHsgcGhvdG9JZCB9ID0gcGhvdG9FbGVtZW50LmRhdGFzZXQ7XG5cbiAgICAgIGlmICghIXBob3RvSWQpIHtcbiAgICAgICAgdGhpcy5kZWxldGVQaG90bygrcGhvdG9JZCkudGhlbihcbiAgICAgICAgICByZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICAqINCX0LDQv9GA0L7RgSDQvdCwINC+0LHQvdC+0LLQu9C10L3QuNC1INGE0L7RgtC+0LPRgNCw0YTQuNC4INGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgICAqIEBwYXJhbSBlIHtFdmVudH0g0KHQvtCx0YvRgtC40LUuXG4gICAgICovXG4gICAgXCJ1cGRhdGUtcGhvdG9cIjogZSA9PiB7XG4gICAgICBjb25zdCBwaG90b0VsZW1lbnQgPSBlLnRhcmdldC5jbG9zZXN0KFwiLnZnLXBob3RvXCIpO1xuICAgICAgY29uc3QgeyBwaG90b0lkIH0gPSBwaG90b0VsZW1lbnQuZGF0YXNldDtcblxuICAgICAgaWYgKCEhcGhvdG9JZCkge1xuICAgICAgICB0aGlzLnNldEFzTWFpblBob3RvKCtwaG90b0lkKS50aGVuKFxuICAgICAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=