!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VisionPhotoGallery=e():t.VisionPhotoGallery=e()}(this,(function(){return function(){"use strict";var t={946:function(t,e,o){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}o.d(e,{default:function(){return a}});var a=function(){function t(e){var o=e.root,n=e.employeeId,r=e.token;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!o)throw new Error("Не указан ID корневого элемента для галереи!");var i=document.getElementById(o);if(!i)throw new Error("Проверьте указанный ID корневого элемента для галереи!");if(this.constructor.rootElement=i,!n)throw new Error("Не указан ID пользователя на портале Vision");this.employeeId=n,this.token=r,this.constructor.draw()}var e,o,i;return e=t,i=[{key:"update",value:function(t){var e=t.employeeId,o=t.token;this.employeeId=e,this.token=o,this.draw()}},{key:"handleError",value:function(t){var e=t.message,o=t.blockingErrorMessage;if(this.errorFunction){var r="";"object"===n(e)&&Object.keys(e).reverse().forEach((function(t){r+="".concat(e[t],"<br/>")}));var i=r.length?r:JSON.stringify(e);this.errorFunction(i,"Ошибка")}else{if(o)throw new Error(o);console.log(e)}}},{key:"request",value:function(t){var e=t.requestPath,o=t.requestBody,n={method:"POST",mode:"same-origin",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":this.token},body:JSON.stringify(o)};return fetch("/api/v2/vision/".concat(e,"/"),n)}},{key:"getPhotos",value:function(){return this.request({requestPath:"get_photos",requestBody:{employeeId:this.employeeId,masterAlbum:!0}})}},{key:"addPhoto",value:function(t){return this.request({requestPath:"add_photo",requestBody:{employeeId:this.employeeId,image:t}})}},{key:"deletePhoto",value:function(t){return this.request({requestPath:"delete_photo",requestBody:{employeeId:this.employeeId,photoIds:[t],masterAlbum:!0}})}},{key:"updatePhoto",value:function(t){return this.request({requestPath:"update_photo",requestBody:{employeeId:this.employeeId,photo_id:t}})}},{key:"draw",value:function(){var t=this,e=this.rootElement;e.innerHTML='\n            <div class="vision-photo-gallery">\n                <input type="file" class="vision-photo-gallery__file-field" tabindex="-1">\n                <div class="vision-photo-gallery__item vision-photo-gallery__item--main">\n                    <h4 class="vision-photo-gallery__title">Основная фотография</h4>\n                    <div class="vg-main-photo"></div>\n                </div>\n                <div class="vision-photo-gallery__item">\n                    <h4 class="vision-photo-gallery__title">Галерея</h4>\n                    <div class="vg-gallery"></div>\n                </div>\n            </div>\n        ';var o=e.querySelector(".vg-main-photo"),n=e.querySelector(".vg-gallery");this.getPhotos().then((function(e){if(o.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null}),n.innerHTML=t.createPhotoElement({main:!1,empty:!0,photoId:null}),e.ok)return e.json();o.innerHTML=t.createPhotoElement({main:!0,empty:!0,photoId:null}),t.initEvents()})).then((function(e){if(e){var r=e.find((function(t){return!0===t.main})),i=e.filter((function(t){return!0!==t.main}));if(r?o.innerHTML=t.createPhotoElement(r):o.parentElement.classList.add("hidden"),i.length){var a="";i.forEach((function(e){return a+=t.createPhotoElement(e)})),a+=t.createPhotoElement({main:!1,empty:!0,photoId:null}),n.innerHTML=a}t.initEvents()}})).catch((function(e){t.handleError({message:e}),t.initEvents()})),this.initEvents()}},{key:"createPhotoElement",value:function(t){var e=t.photoId,o=t.main,n=t.empty,r=t.path,i=t.avatarUrl,a="",u="",s="",l="";return r&&(s='style="background-image: url('.concat(r,')"')),i&&(s='style="background-image: url('.concat(i,')"')),o&&(l='data-main="'.concat(o,'"')),o&&!n?(u="vg-photo vg-photo--main",a='\n        <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n      '):o&&n?(u="vg-photo vg-photo--main",a='\n        <button class="vg-photo__button vg-button" data-action="upload-photo">Загрузить</button>\n      '):!o&&n?(u="vg-gallery__item vg-photo vg-photo--upload",a='\n        <button class="vg-photo__button vg-button vg-button--upload" data-action="upload-photo">&#43;</button>\n      '):(u="vg-gallery__item vg-photo",a='\n        <button class="vg-photo__button vg-button vg-button--green" data-action="update-photo">Выбрать</button>\n        <button class="vg-photo__button vg-button vg-button--red" data-action="remove-photo">Удалить</button>\n      '),'\n      <div class="'.concat(u,'"\n        ').concat(s,'\n        data-photo-id="').concat(e,'"\n        ').concat(l,">\n        ").concat(a,"\n        </div>\n      ")}},{key:"initEvents",value:function(){var t=this;this.rootElement.querySelectorAll("button").forEach((function(e){e.addEventListener("click",t.router[e.dataset.action],!1)}))}}],(o=[{key:"errorFunction",get:function(){return this.constructor.errorFunction},set:function(t){t&&(this.constructor.errorFunction=t)}},{key:"employeeId",get:function(){return this.constructor.employeeId},set:function(t){t&&(this.constructor.employeeId=t)}},{key:"rootElement",get:function(){return this.constructor.rootElement}},{key:"token",get:function(){return this.constructor.token},set:function(t){t&&(this.constructor.token=t)}}])&&r(e.prototype,o),i&&r(e,i),t}();i(a,"employeeId",null),i(a,"rootElement",null),i(a,"token",null),i(a,"errorFunction",null),i(a,"router",{"upload-photo":function(t){var e=a.rootElement.querySelector('input[type="file"]');e.addEventListener("change",a.router["file-input-changed"]),e.click()},"file-input-changed":function(t){var e=t.target.files[0],o=new FileReader;o.readAsDataURL(e),o.onload=function(){a.addPhoto(o.result).then((function(t){if(t.ok)a.draw();else if(200!==t.status)return t.json()})).then((function(t){200!==t.status&&a.handleError({message:t})}))},o.onerror=function(){a.handleError({message:o.error,blockingErrorMessage:"Ошибка загрузки фотографии (-ий): ".concat(o.error)})}},"remove-photo":function(t){var e=t.target.closest(".vg-photo").dataset.photoId;e&&a.deletePhoto(+e).then((function(t){if(t.ok)a.draw();else if(200!==t.status)return t.json()})).then((function(t){200!==t.status&&a.handleError({message:t})}))},"update-photo":function(t){var e=t.target.closest(".vg-photo").dataset.photoId;e&&a.updatePhoto(+e).then((function(t){if(t.ok)a.draw();else if(200!==t.status)return t.json()})).then((function(t){200!==t.status&&a.handleError({message:t})}))}})}},e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={exports:{}};return t[n](r,r.exports,o),r.exports}return o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o(946)}().default}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS8uL1Zpc2lvblBob3RvR2FsbGVyeS9pbmRleC5qcyIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vVmlzaW9uUGhvdG9HYWxsZXJ5L3dlYnBhY2svc3RhcnR1cCIsIndlYnBhY2s6Ly9WaXNpb25QaG90b0dhbGxlcnkvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL1Zpc2lvblBob3RvR2FsbGVyeS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInRoaXMiLCJWaXNpb25QaG90b0dhbGxlcnkiLCJlbXBsb3llZUlkIiwidG9rZW4iLCJFcnJvciIsInJvb3RFbGVtZW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNvbnN0cnVjdG9yIiwiZHJhdyIsInBhcmFtcyIsIm1lc3NhZ2UiLCJibG9ja2luZ0Vycm9yTWVzc2FnZSIsImVycm9yRnVuY3Rpb24iLCJtZXNzYWdlU3RyaW5nIiwiT2JqZWN0Iiwia2V5cyIsInJldmVyc2UiLCJmb3JFYWNoIiwia2V5IiwiZXJyb3JNZXNzYWdlIiwibGVuZ3RoIiwiSlNPTiIsInN0cmluZ2lmeSIsImNvbnNvbGUiLCJsb2ciLCJyZXF1ZXN0UGF0aCIsInJlcXVlc3RCb2R5IiwicmVxdWVzdERlZmF1bHRzIiwibWV0aG9kIiwibW9kZSIsImNyZWRlbnRpYWxzIiwiaGVhZGVycyIsImJvZHkiLCJmZXRjaCIsInJlcXVlc3QiLCJtYXN0ZXJBbGJ1bSIsImltYWdlIiwicGhvdG9JZCIsInBob3RvSWRzIiwicGhvdG9faWQiLCJpbm5lckhUTUwiLCJtYWluUGhvdG9Db250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiZ2FsbGVyeSIsImdldFBob3RvcyIsInRoZW4iLCJyZXNwb25zZSIsImNyZWF0ZVBob3RvRWxlbWVudCIsIm1haW4iLCJlbXB0eSIsIm9rIiwianNvbiIsImluaXRFdmVudHMiLCJyZXNwb25zZUpzb24iLCJtYWluUGhvdG9EYXRhIiwiZmluZCIsImdhbGxlcnlQaG90b3NEYXRhIiwiZmlsdGVyIiwicGFyZW50RWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImdhbGxlcnlQaG90b3NIdG1sIiwicGhvdG9EYXRhIiwiY2F0Y2giLCJlcnJvciIsImhhbmRsZUVycm9yIiwicGF0aCIsImF2YXRhclVybCIsImJ1dHRvbnMiLCJlbGVtZW50Q2xhc3NlcyIsImJhY2tncm91bmRJbWFnZSIsIm1haW5BdHRyaWJ1dGUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiYnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJvdXRlciIsImRhdGFzZXQiLCJhY3Rpb24iLCJlIiwiZmlsZUlucHV0IiwiY2xpY2siLCJmaWxlIiwidGFyZ2V0IiwiZmlsZXMiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwicmVhZEFzRGF0YVVSTCIsIm9ubG9hZCIsImFkZFBob3RvIiwicmVzdWx0Iiwic3RhdHVzIiwib25lcnJvciIsImNsb3Nlc3QiLCJkZWxldGVQaG90byIsInVwZGF0ZVBob3RvIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImQiLCJkZWZpbml0aW9uIiwibyIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiXSwibWFwcGluZ3MiOiJDQUFBLFNBQTJDQSxFQUFNQyxHQUMxQixpQkFBWkMsU0FBMEMsaUJBQVhDLE9BQ3hD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QUVELEVBQVlsRixLQUFTOEUsRUFBb0JLLEVBQUUxRyxFQUFTdUIsSUFDNUVKLE9BQU93RixlQUFlM0csRUFBU3VCLEVBQUssQ0FBRXFGLFlBQVksRUFBTUMsSUFBS0osRUFBV2xGLE1DSjNFOEUsRUFBb0JLLEVBQUksU0FBU0ksRUFBS0MsR0FBUSxPQUFPNUYsT0FBTzZGLFVBQVVDLGVBQWVDLEtBQUtKLEVBQUtDLElGR3hGVixFQUFvQixLIiwiZmlsZSI6IlZpc2lvblBob3RvR2FsbGVyeS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIlZpc2lvblBob3RvR2FsbGVyeVwiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJWaXNpb25QaG90b0dhbGxlcnlcIl0gPSBmYWN0b3J5KCk7XG59KSh0aGlzLCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCIndXNlIHN0cmljdCc7XG5cbmltcG9ydCAnLi9hcHAuc2Nzcyc7XG5cbi8qKlxuICog0JrQu9Cw0YHRgSDQs9Cw0LvQtdGA0LXQuC5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmlzaW9uUGhvdG9HYWxsZXJ5IHtcbiAgc3RhdGljIGVtcGxveWVlSWQgPSBudWxsO1xuICBzdGF0aWMgcm9vdEVsZW1lbnQgPSBudWxsO1xuICBzdGF0aWMgdG9rZW4gPSBudWxsO1xuXG4gIC8qKlxuICAgKiDQmtC+0L3RgdGC0YDRg9C60YLQvtGAINGN0LrQt9C10LzQv9C70Y/RgNCwINC60LvQsNGB0YHQsCDQs9Cw0LvQtdGA0LXQuC5cbiAgICogQHBhcmFtIHJvb3Qge3N0cmluZ30gSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAsINC60YPQtNCwINCx0YPQtNC10YIg0YDQtdC90LTQtdGA0LjRgtGM0YHRjyDQs9Cw0LvQtdGA0LXRjy5cbiAgICogQHBhcmFtIGVtcGxveWVlSWQge251bWJlcnxzdHJpbmd9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcGFyYW0gdG9rZW4ge3N0cmluZ30gQ1NSRi3RgtC+0LrQtdC9INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHtyb290LCBlbXBsb3llZUlkLCB0b2tlbn0pIHtcbiAgICBpZiAoIXJvb3QpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign0J3QtSDRg9C60LDQt9Cw0L0gSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAg0LTQu9GPINCz0LDQu9C10YDQtdC4IScpO1xuICAgIH1cblxuICAgIGNvbnN0IHJvb3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocm9vdCk7XG5cbiAgICBpZiAoISFyb290RWxlbWVudCkge1xuICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5yb290RWxlbWVudCA9IHJvb3RFbGVtZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ9Cf0YDQvtCy0LXRgNGM0YLQtSDRg9C60LDQt9Cw0L3QvdGL0LkgSUQg0LrQvtGA0L3QtdCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAg0LTQu9GPINCz0LDQu9C10YDQtdC4IScpO1xuICAgIH1cblxuICAgIGlmICghZW1wbG95ZWVJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfQndC1INGD0LrQsNC30LDQvSBJRCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8g0L3QsCDQv9C+0YDRgtCw0LvQtSBWaXNpb24nKTtcbiAgICB9XG5cbiAgICB0aGlzLmVtcGxveWVlSWQgPSBlbXBsb3llZUlkO1xuICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcblxuICAgIHRoaXMuY29uc3RydWN0b3IuZHJhdygpO1xuICB9XG5cbiAgLyoqXG4gICAqINCd0LDQt9C90LDRh9Cw0LXQvNGL0Lkg0LzQtdGC0L7QtCDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqIEB0eXBlIHtudWxsfEZ1bmN0aW9ufSDQpNGD0L3QutGG0LjRjyDQvtCx0YDQsNCx0L7RgtGH0LjQuiDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICovXG4gIHN0YXRpYyBlcnJvckZ1bmN0aW9uID0gbnVsbDtcblxuICAvKipcbiAgICog0J/QvtC70YPRh9C10L3QuNC1INC80LXRgtC+0LTQsCDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQvtGI0LjQsdC+0LouXG4gICAqIEB0eXBlIHtudWxsfEZ1bmN0aW9ufSDQpNGD0L3QutGG0LjRjyDQvtCx0YDQsNCx0L7RgtGH0LjQuiDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICovXG4gIGdldCBlcnJvckZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLmVycm9yRnVuY3Rpb247XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LXQvdC40LUg0LzQtdGC0L7QtNCwINC00LvRjyDQvtGC0L7QsdGA0LDQttC10L3QuNGPINC+0YjQuNCx0L7Qui5cbiAgICogQHBhcmFtIGVycm9yRnVuY3Rpb24ge251bGx8RnVuY3Rpb259INCk0YPQvdC60YbQuNGPINC+0LHRgNCw0LHQvtGC0YfQuNC6INC+0YLQvtCx0YDQsNC20LXQvdC40Y8g0L7RiNC40LHQvtC6LlxuICAgKi9cbiAgc2V0IGVycm9yRnVuY3Rpb24oZXJyb3JGdW5jdGlvbikge1xuICAgIGlmIChlcnJvckZ1bmN0aW9uKSB7XG4gICAgICB0aGlzLmNvbnN0cnVjdG9yLmVycm9yRnVuY3Rpb24gPSBlcnJvckZ1bmN0aW9uO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQntCx0L3QvtCy0LvQtdC90LjQtSDQv9Cw0YDQsNC80LXRgtGA0L7QsiDQs9Cw0LvQtdGA0LXQuC5cbiAgICogQHBhcmFtIGVtcGxveWVlSWQge251bWJlcnxudW1iZXJ9IElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcGFyYW0gdG9rZW4ge3N0cmluZ30gQ1NSRi3RgtC+0LrQtdC9INGB0LXRgdGB0Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPLlxuICAgKi9cbiAgc3RhdGljIHVwZGF0ZSh7ZW1wbG95ZWVJZCwgdG9rZW59KSB7XG4gICAgdGhpcy5lbXBsb3llZUlkID0gZW1wbG95ZWVJZDtcbiAgICB0aGlzLnRva2VuID0gdG9rZW47XG5cbiAgICB0aGlzLmRyYXcoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQn9C+0LvRg9GH0LjRgtGMIElEINGB0L7RgtGA0YPQtNC90LjQutCwLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICovXG4gIGdldCBlbXBsb3llZUlkKCkge1xuICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLmVtcGxveWVlSWQ7XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LXQvdC40LUg0Y3QutC30LXQvNC/0LvRj9GA0YMg0LPQsNC70LXRgNC10LggSUQg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAqIEBwYXJhbSBlbXBsb3llZUlkIHtudW1iZXJ8c3RyaW5nfSBJRCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICovXG4gIHNldCBlbXBsb3llZUlkKGVtcGxveWVlSWQpIHtcbiAgICBpZiAoZW1wbG95ZWVJZCkge1xuICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5lbXBsb3llZUlkID0gZW1wbG95ZWVJZDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog0JrQvtGA0L3QtdCy0L7QuSDRjdC70LXQvNC10L3Rgiwg0LIg0LrQvtGC0L7RgNGL0Lkg0LHRg9C00LXRgiDRgNC10L3QtNC10YDQuNGC0YzRgdGPINCz0LDQu9C10YDQtdGPLlxuICAgKiBAcmV0dXJuIHtudWxsfEVsZW1lbnR9INCa0L7RgNC90LXQstC+0Lkg0Y3Qu9C10LzQtdC90YIg0LTQu9GPINGA0LXQvdC00LXRgNCwLlxuICAgKi9cbiAgZ2V0IHJvb3RFbGVtZW50KCkge1xuICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnJvb3RFbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqINCf0L7Qu9GD0YfQuNGC0YwgQ1NSRi3RgtC+0LrQtdC9INGB0LXRgdGB0LjQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8uXG4gICAqIEByZXR1cm4ge251bGx9XG4gICAqL1xuICBnZXQgdG9rZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9rZW47XG4gIH1cblxuICAvKipcbiAgICog0J3QsNC30L3QsNGH0LjRgtGMIENTUkYt0YLQvtC60LXQvSDRgdC10YHRgdC40Lgg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPLlxuICAgKiBAcGFyYW0gdG9rZW5cbiAgICovXG4gIHNldCB0b2tlbih0b2tlbikge1xuICAgIGlmICh0b2tlbikge1xuICAgICAgdGhpcy5jb25zdHJ1Y3Rvci50b2tlbiA9IHRva2VuO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDQntCx0YDQsNCx0L7RgtGH0LjQuiDQvtGI0LjQsdC+0LouXG4gICAqIEBwYXJhbSBwYXJhbXMubWVzc2FnZSB7c3RyaW5nfSDQodC+0L7QsdGJ0LXQvdC40LUg0L7QsSDQvtGI0LjQsdC60LUuXG4gICAqIEBwYXJhbSBwYXJhbXMuYmxvY2tpbmdFcnJvck1lc3NhZ2Uge3N0cmluZ30g0JHQu9C+0LrQuNGA0YPRjtGJ0LXQtSDQv9C+0YLQvtC6INGB0L7QvtCx0YnQtdC90LjQtSDQvtCxINC+0YjQuNCx0LrQtS5cbiAgICovXG4gIHN0YXRpYyBoYW5kbGVFcnJvcihwYXJhbXMpIHtcbiAgICBjb25zdCB7bWVzc2FnZSwgYmxvY2tpbmdFcnJvck1lc3NhZ2V9ID0gcGFyYW1zO1xuXG4gICAgaWYgKHRoaXMuZXJyb3JGdW5jdGlvbikge1xuICAgICAgbGV0IG1lc3NhZ2VTdHJpbmcgPSAnJztcblxuICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlID09PSAnb2JqZWN0Jykge1xuICAgICAgICBPYmplY3Qua2V5cyhtZXNzYWdlKS5yZXZlcnNlKCkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgIG1lc3NhZ2VTdHJpbmcgKz0gYCR7bWVzc2FnZVtrZXldfTxici8+YDtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IG1lc3NhZ2VTdHJpbmcubGVuZ3RoID8gbWVzc2FnZVN0cmluZyA6IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpO1xuXG4gICAgICB0aGlzLmVycm9yRnVuY3Rpb24oZXJyb3JNZXNzYWdlLCAn0J7RiNC40LHQutCwJyk7XG4gICAgfSBlbHNlIGlmIChibG9ja2luZ0Vycm9yTWVzc2FnZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGJsb2NraW5nRXJyb3JNZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINCe0LHRkdGA0YLQutCwINC00LvRjyDQt9Cw0L/RgNC+0YHQvtCyINC6IEFQSS5cbiAgICogQHBhcmFtIHJlcXVlc3RQYXRoIHtzdHJpbmd9INCd0LDQt9Cy0LDQvdC40LUg0LzQtdGC0L7QtNCwIEFQSS5cbiAgICogQHBhcmFtIHJlcXVlc3RCb2R5IHtvYmplY3R9INCf0LDRgNCw0LzQtdGC0YDRiyDQt9Cw0L/RgNC+0YHQsC5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgcmVxdWVzdCh7cmVxdWVzdFBhdGgsIHJlcXVlc3RCb2R5fSkge1xuICAgIGNvbnN0IHJlcXVlc3REZWZhdWx0cyA9IHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgbW9kZTogJ3NhbWUtb3JpZ2luJyxcbiAgICAgIGNyZWRlbnRpYWxzOiAnc2FtZS1vcmlnaW4nLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAnWC1DU1JGVG9rZW4nOiB0aGlzLnRva2VuLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIGZldGNoKGAvYXBpL3YyL3Zpc2lvbi8ke3JlcXVlc3RQYXRofS9gLCByZXF1ZXN0RGVmYXVsdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqINCS0YvQs9GA0YPQt9C60LAg0LLRgdC10YUg0YTQvtGC0L7Qs9GA0LDRhNC40Lkg0YEg0L/QvtGA0YLQsNC70LAgVmlzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIGdldFBob3RvcygpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgIHJlcXVlc3RQYXRoOiAnZ2V0X3Bob3RvcycsXG4gICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICBlbXBsb3llZUlkOiB0aGlzLmVtcGxveWVlSWQsXG4gICAgICAgIG1hc3RlckFsYnVtOiB0cnVlLFxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCX0LDQv9GA0L7RgSDQvdCwINC00L7QsdCw0LLQu9C10L3QuNC1ICjQt9Cw0LPRgNGD0LfQutGDKSDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHBhcmFtIGltYWdlIHtCdWZmZXJFbmNvZGluZ30g0KTQvtGC0L7Qs9GA0LDRhNC40Lgg0LIg0YTQvtGA0LzQsNGC0LUgQmFzZTY0LlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59INCf0YDQvtC80LjRgSDRgSDRgNC10LfRg9C70YzRgtCw0YLQvtC8INCy0YvQv9C+0LvQvdC10L3QuNGPINC30LDQv9GA0L7RgdCwLlxuICAgKi9cbiAgc3RhdGljIGFkZFBob3RvKGltYWdlKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh7XG4gICAgICByZXF1ZXN0UGF0aDogJ2FkZF9waG90bycsXG4gICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICBlbXBsb3llZUlkOiB0aGlzLmVtcGxveWVlSWQsXG4gICAgICAgIGltYWdlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDRg9C00LDQu9C10L3QuNC1INGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gcGhvdG9JZCB7TnVtYmVyfSBJRCDRhNC+0YLQvtCz0YDQsNGE0LjQuCDQvdCwINC/0L7RgNGC0LDQu9C1IFZpc2lvbi5cbiAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSDQn9GA0L7QvNC40YEg0YEg0YDQtdC30YPQu9GM0YLQsNGC0L7QvCDQstGL0L/QvtC70L3QtdC90LjRjyDQt9Cw0L/RgNC+0YHQsC5cbiAgICovXG4gIHN0YXRpYyBkZWxldGVQaG90byhwaG90b0lkKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCh7XG4gICAgICByZXF1ZXN0UGF0aDogJ2RlbGV0ZV9waG90bycsXG4gICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICBlbXBsb3llZUlkOiB0aGlzLmVtcGxveWVlSWQsXG4gICAgICAgIHBob3RvSWRzOiBbcGhvdG9JZF0sXG4gICAgICAgIG1hc3RlckFsYnVtOiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDQvtCx0L3QvtCy0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHBhcmFtIHBob3RvSWQge051bWJlcn0gSUQg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0L3QsCDQv9C+0YDRgtCw0LvQtSBWaXNpb24uXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0g0J/RgNC+0LzQuNGBINGBINGA0LXQt9GD0LvRjNGC0LDRgtC+0Lwg0LLRi9C/0L7Qu9C90LXQvdC40Y8g0LfQsNC/0YDQvtGB0LAuXG4gICAqL1xuICBzdGF0aWMgdXBkYXRlUGhvdG8ocGhvdG9JZCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgcmVxdWVzdFBhdGg6ICd1cGRhdGVfcGhvdG8nLFxuICAgICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgICAgZW1wbG95ZWVJZDogdGhpcy5lbXBsb3llZUlkLFxuICAgICAgICBwaG90b19pZDogcGhvdG9JZCxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog0J7RgtGA0LjRgdC+0LLQutCwIERPTSDQs9Cw0LvQtdGA0LXQuNC4LlxuICAgKi9cbiAgc3RhdGljIGRyYXcoKSB7XG4gICAgY29uc3Qgcm9vdEVsZW1lbnQgPSB0aGlzLnJvb3RFbGVtZW50O1xuXG4gICAgcm9vdEVsZW1lbnQuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5XCI+XG4gICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJmaWxlXCIgY2xhc3M9XCJ2aXNpb24tcGhvdG8tZ2FsbGVyeV9fZmlsZS1maWVsZFwiIHRhYmluZGV4PVwiLTFcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX2l0ZW0gdmlzaW9uLXBob3RvLWdhbGxlcnlfX2l0ZW0tLW1haW5cIj5cbiAgICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzPVwidmlzaW9uLXBob3RvLWdhbGxlcnlfX3RpdGxlXCI+0J7RgdC90L7QstC90LDRjyDRhNC+0YLQvtCz0YDQsNGE0LjRjzwvaDQ+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2Zy1tYWluLXBob3RvXCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X19pdGVtXCI+XG4gICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzcz1cInZpc2lvbi1waG90by1nYWxsZXJ5X190aXRsZVwiPtCT0LDQu9C10YDQtdGPPC9oND5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInZnLWdhbGxlcnlcIj48L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuXG4gICAgY29uc3QgbWFpblBob3RvQ29udGFpbmVyID0gcm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcignLnZnLW1haW4tcGhvdG8nKTtcbiAgICBjb25zdCBnYWxsZXJ5ID0gcm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcignLnZnLWdhbGxlcnknKTtcblxuICAgIHRoaXMuZ2V0UGhvdG9zKCkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICBtYWluUGhvdG9Db250YWluZXIuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQoe1xuICAgICAgICBtYWluOiB0cnVlLFxuICAgICAgICBlbXB0eTogdHJ1ZSxcbiAgICAgICAgcGhvdG9JZDogbnVsbFxuICAgICAgfSk7XG5cbiAgICAgIGdhbGxlcnkuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQoe1xuICAgICAgICBtYWluOiBmYWxzZSxcbiAgICAgICAgZW1wdHk6IHRydWUsXG4gICAgICAgIHBob3RvSWQ6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtYWluUGhvdG9Db250YWluZXIuaW5uZXJIVE1MID0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQoe21haW46IHRydWUsIGVtcHR5OiB0cnVlLCBwaG90b0lkOiBudWxsfSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaW5pdEV2ZW50cygpO1xuICAgIH0pLnRoZW4ocmVzcG9uc2VKc29uID0+IHtcbiAgICAgIGlmICghcmVzcG9uc2VKc29uKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbWFpblBob3RvRGF0YSA9IHJlc3BvbnNlSnNvbi5maW5kKCh7bWFpbn0pID0+IG1haW4gPT09IHRydWUpO1xuICAgICAgY29uc3QgZ2FsbGVyeVBob3Rvc0RhdGEgPSByZXNwb25zZUpzb24uZmlsdGVyKCh7bWFpbn0pID0+IG1haW4gIT09IHRydWUpO1xuXG4gICAgICBpZiAoISFtYWluUGhvdG9EYXRhKSB7XG4gICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLmNyZWF0ZVBob3RvRWxlbWVudChtYWluUGhvdG9EYXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1haW5QaG90b0NvbnRhaW5lci5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZ2FsbGVyeVBob3Rvc0RhdGEubGVuZ3RoKSB7XG4gICAgICAgIGxldCBnYWxsZXJ5UGhvdG9zSHRtbCA9ICcnO1xuXG4gICAgICAgIGdhbGxlcnlQaG90b3NEYXRhLmZvckVhY2goKHBob3RvRGF0YSkgPT4gZ2FsbGVyeVBob3Rvc0h0bWwgKz0gdGhpcy5jcmVhdGVQaG90b0VsZW1lbnQocGhvdG9EYXRhKSk7XG4gICAgICAgIGdhbGxlcnlQaG90b3NIdG1sICs9IHRoaXMuY3JlYXRlUGhvdG9FbGVtZW50KHttYWluOiBmYWxzZSwgZW1wdHk6IHRydWUsIHBob3RvSWQ6IG51bGx9KTtcbiAgICAgICAgZ2FsbGVyeS5pbm5lckhUTUwgPSBnYWxsZXJ5UGhvdG9zSHRtbFxuICAgICAgfVxuXG4gICAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICB0aGlzLmhhbmRsZUVycm9yKHtcbiAgICAgICAgbWVzc2FnZTogZXJyb3IsXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDQo9C90LjQstC10YDRgdCw0LvRjNC90YvQuSDQvNC10YLQvtC0INC00LvRjyDRgdC+0LfQtNCw0L3QuNGPINGN0LvQtdC80LXQvdGC0LAg0YTQvtGC0L7Qs9GA0LDRhNC40LguXG4gICAqIEBwYXJhbSBwYXJhbXMucGhvdG9JZCB7TnVtYmVyfSBJRCDRhNC+0YLQvtCz0YDQsNGE0LjQuCDQvdCwINC/0L7RgNGC0LDQu9C1IFZpc2lvbi5cbiAgICogQHBhcmFtIHBhcmFtcy5tYWluIHtCb29sZWFufSAg0KTQu9Cw0LMg0L7RgdC90L7QstC90L7Qs9C+INGE0L7RgtC+LlxuICAgKiBAcGFyYW0gcGFyYW1zLmVtcHR5IHtCb29sZWFufSDQpNC70LDQsyBcItC/0YPRgdGC0L7Qs9C+XCIg0YTQvtGC0L4sINC40YHQv9C+0LvRjNC30YPQtdGC0YHRjyDQtNC70Y8g0L7RgtC+0LHRgNCw0LbQtdC90LjRjyDQutC90L7Qv9C60Lgg0LfQsNCz0YDRg9C30LrQuC5cbiAgICogQHBhcmFtIHBhcmFtcy5wYXRoIHtTdHJpbmd9INCf0YPRgtGMINC6INGE0L7RgtC+0LPRgNCw0YTQuNC4LlxuICAgKiBAcGFyYW0gcGFyYW1zLmF2YXRhclVybCB7U3RyaW5nfSDQn9GD0YLRjCDQuiDRhNC+0YLQvtCz0YDQsNGE0LjQuC5cbiAgICogQHJldHVybnMge3N0cmluZ30g0K3Qu9C10LzQtdC90YIg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0LIg0LLQuNC00LUg0YHRgtGA0L7QutC4LlxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZVBob3RvRWxlbWVudChwYXJhbXMpIHtcbiAgICBjb25zdCB7cGhvdG9JZCwgbWFpbiwgZW1wdHksIHBhdGgsIGF2YXRhclVybH0gPSBwYXJhbXM7XG4gICAgbGV0IGJ1dHRvbnMgPSAnJztcbiAgICBsZXQgZWxlbWVudENsYXNzZXMgPSAnJztcbiAgICBsZXQgYmFja2dyb3VuZEltYWdlID0gJyc7XG4gICAgbGV0IG1haW5BdHRyaWJ1dGUgPSAnJztcblxuICAgIGlmIChwYXRoKSB7XG4gICAgICBiYWNrZ3JvdW5kSW1hZ2UgPSBgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHtwYXRofSlcImA7XG4gICAgfVxuXG4gICAgaWYgKGF2YXRhclVybCkge1xuICAgICAgYmFja2dyb3VuZEltYWdlID0gYHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7YXZhdGFyVXJsfSlcImA7XG4gICAgfVxuXG4gICAgaWYgKG1haW4pIHtcbiAgICAgIG1haW5BdHRyaWJ1dGUgPSBgZGF0YS1tYWluPVwiJHttYWlufVwiYDtcbiAgICB9XG5cbiAgICBpZiAobWFpbiAmJiAhZW1wdHkpIHtcbiAgICAgIGVsZW1lbnRDbGFzc2VzID0gJ3ZnLXBob3RvIHZnLXBob3RvLS1tYWluJztcbiAgICAgIGJ1dHRvbnMgPSBgXG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJ2Zy1waG90b19fYnV0dG9uIHZnLWJ1dHRvbiB2Zy1idXR0b24tLXJlZFwiIGRhdGEtYWN0aW9uPVwicmVtb3ZlLXBob3RvXCI+0KPQtNCw0LvQuNGC0Yw8L2J1dHRvbj5cbiAgICAgIGA7XG4gICAgfSBlbHNlIGlmIChtYWluICYmIGVtcHR5KSB7XG4gICAgICBlbGVtZW50Q2xhc3NlcyA9ICd2Zy1waG90byB2Zy1waG90by0tbWFpbic7XG4gICAgICBidXR0b25zID0gYFxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b25cIiBkYXRhLWFjdGlvbj1cInVwbG9hZC1waG90b1wiPtCX0LDQs9GA0YPQt9C40YLRjDwvYnV0dG9uPlxuICAgICAgYDtcbiAgICB9IGVsc2UgaWYgKCFtYWluICYmIGVtcHR5KSB7XG4gICAgICBlbGVtZW50Q2xhc3NlcyA9ICd2Zy1nYWxsZXJ5X19pdGVtIHZnLXBob3RvIHZnLXBob3RvLS11cGxvYWQnO1xuICAgICAgYnV0dG9ucyA9IGBcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uIHZnLWJ1dHRvbi0tdXBsb2FkXCIgZGF0YS1hY3Rpb249XCJ1cGxvYWQtcGhvdG9cIj4mIzQzOzwvYnV0dG9uPlxuICAgICAgYDtcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbWVudENsYXNzZXMgPSAndmctZ2FsbGVyeV9faXRlbSB2Zy1waG90byc7XG4gICAgICBidXR0b25zID0gYFxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwidmctcGhvdG9fX2J1dHRvbiB2Zy1idXR0b24gdmctYnV0dG9uLS1ncmVlblwiIGRhdGEtYWN0aW9uPVwidXBkYXRlLXBob3RvXCI+0JLRi9Cx0YDQsNGC0Yw8L2J1dHRvbj5cbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInZnLXBob3RvX19idXR0b24gdmctYnV0dG9uIHZnLWJ1dHRvbi0tcmVkXCIgZGF0YS1hY3Rpb249XCJyZW1vdmUtcGhvdG9cIj7Qo9C00LDQu9C40YLRjDwvYnV0dG9uPlxuICAgICAgYDtcbiAgICB9XG5cbiAgICByZXR1cm4gYFxuICAgICAgPGRpdiBjbGFzcz1cIiR7ZWxlbWVudENsYXNzZXN9XCJcbiAgICAgICAgJHtiYWNrZ3JvdW5kSW1hZ2V9XG4gICAgICAgIGRhdGEtcGhvdG8taWQ9XCIke3Bob3RvSWR9XCJcbiAgICAgICAgJHttYWluQXR0cmlidXRlfT5cbiAgICAgICAgJHtidXR0b25zfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIGA7XG4gIH1cblxuICAvKipcbiAgICog0JjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0YHQvtCx0YvRgtC40Lkg0LTQu9GPINC60L3QvtC/0L7QuiDQs9Cw0LvQtdGA0LXQuC5cbiAgICovXG4gIHN0YXRpYyBpbml0RXZlbnRzKCkge1xuICAgIGNvbnN0IHtyb290RWxlbWVudH0gPSB0aGlzO1xuICAgIGNvbnN0IGJ1dHRvbnMgPSByb290RWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24nKTtcblxuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4ge1xuICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5yb3V0ZXJbYnV0dG9uLmRhdGFzZXQuYWN0aW9uXSwgZmFsc2UpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqINCg0L7Rg9GC0LXRgC5cbiAgICogQHR5cGUge3tcInJlbW92ZS1waG90b1wiOiBmdW5jdGlvbigqKTogdm9pZCwgXCJmaWxlLWlucHV0LWNoYW5nZWRcIjogZnVuY3Rpb24oKik6IHZvaWQsIFwidXBsb2FkLXBob3RvXCI6IGZ1bmN0aW9uKCopOiB2b2lkLCBcInVwZGF0ZS1waG90b1wiOiBmdW5jdGlvbigqKTogdm9pZH19XG4gICAqL1xuICBzdGF0aWMgcm91dGVyID0ge1xuICAgIC8qKlxuICAgICAqINCX0LDQs9GA0YPQt9C60LAg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0YHQvtGC0YDRg9C00L3QuNC60LAuXG4gICAgICogQHBhcmFtIGUge0V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICAndXBsb2FkLXBob3RvJzogKGUpID0+IHtcbiAgICAgIGNvbnN0IGZpbGVJbnB1dCA9IHRoaXMucm9vdEVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1cImZpbGVcIl0nKTtcblxuICAgICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHRoaXMucm91dGVyWydmaWxlLWlucHV0LWNoYW5nZWQnXSk7XG4gICAgICBmaWxlSW5wdXQuY2xpY2soKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqINCh0LvRg9GI0LDRgtC10LvRjCDRgdC+0LHRi9GC0LjRjyDQuNC30LzQtdC90LXQvdC40Y8g0YTQsNC50LvQvtCy0L7Qs9C+INC/0L7Qu9GPINCy0LLQvtC00LAuXG4gICAgICogQHBhcmFtIGUge2V2ZW50fSDQodC+0LHRi9GC0LjQtS5cbiAgICAgKi9cbiAgICAnZmlsZS1pbnB1dC1jaGFuZ2VkJzogKGUpID0+IHtcbiAgICAgIGNvbnN0IGZpbGUgPSBlLnRhcmdldC5maWxlc1swXTtcbiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuXG4gICAgICByZWFkZXIub25sb2FkID0gKCkgPT4ge1xuICAgICAgICB0aGlzLmFkZFBob3RvKHJlYWRlci5yZXN1bHQpXG4gICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlRXJyb3Ioe1xuICAgICAgICAgIG1lc3NhZ2U6IHJlYWRlci5lcnJvcixcbiAgICAgICAgICBibG9ja2luZ0Vycm9yTWVzc2FnZTogYNCe0YjQuNCx0LrQsCDQt9Cw0LPRgNGD0LfQutC4INGE0L7RgtC+0LPRgNCw0YTQuNC4ICgt0LjQuSk6ICR7cmVhZGVyLmVycm9yfWAsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgLyoqXG4gICAgICog0JfQsNC/0YDQvtGBINC90LAg0YPQtNCw0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICAgKiBAcGFyYW0gZSB7RXZlbnR9INCh0L7QsdGL0YLQuNC1LlxuICAgICAqL1xuICAgICdyZW1vdmUtcGhvdG8nOiAoZSkgPT4ge1xuICAgICAgY29uc3QgcGhvdG9FbGVtZW50ID0gZS50YXJnZXQuY2xvc2VzdCgnLnZnLXBob3RvJyk7XG4gICAgICBjb25zdCB7cGhvdG9JZH0gPSBwaG90b0VsZW1lbnQuZGF0YXNldDtcblxuICAgICAgaWYgKCEhcGhvdG9JZCkge1xuICAgICAgICB0aGlzLmRlbGV0ZVBob3RvKCtwaG90b0lkKVxuICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXNwb25zZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDQl9Cw0L/RgNC+0YEg0L3QsCDQvtCx0L3QvtCy0LvQtdC90LjQtSDRhNC+0YLQvtCz0YDQsNGE0LjQuCDRgdC+0YLRgNGD0LTQvdC40LrQsC5cbiAgICAgKiBAcGFyYW0gZSB7RXZlbnR9INCh0L7QsdGL0YLQuNC1LlxuICAgICAqL1xuICAgICd1cGRhdGUtcGhvdG8nOiAoZSkgPT4ge1xuICAgICAgY29uc3QgcGhvdG9FbGVtZW50ID0gZS50YXJnZXQuY2xvc2VzdCgnLnZnLXBob3RvJyk7XG4gICAgICBjb25zdCB7cGhvdG9JZH0gPSBwaG90b0VsZW1lbnQuZGF0YXNldDtcblxuICAgICAgaWYgKCEhcGhvdG9JZCkge1xuICAgICAgICB0aGlzLnVwZGF0ZVBob3RvKCtwaG90b0lkKVxuICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXNwb25zZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgfVxufSIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdGlmKF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0pIHtcblx0XHRyZXR1cm4gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gbW9kdWxlIGV4cG9ydHMgbXVzdCBiZSByZXR1cm5lZCBmcm9tIHJ1bnRpbWUgc28gZW50cnkgaW5saW5pbmcgaXMgZGlzYWJsZWRcbi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xucmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oOTQ2KTtcbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIGRlZmluaXRpb24pIHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqLCBwcm9wKSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsgfSJdLCJzb3VyY2VSb290IjoiIn0=